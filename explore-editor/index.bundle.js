!function(){"use strict";var t={name:"align",display:"submenu",add:function(t,e){const i=t.icons,n=t.context;n.align={targetButton:e,alignList:null,currentAlign:"",defaultDir:t.options.rtl?"right":"left",icons:{justify:i.align_justify,left:i.align_left,right:i.align_right,center:i.align_center}};let l=this.setSubmenu(t),o=l.querySelector("ul");o.addEventListener("click",this.pickup.bind(t)),n.align.alignList=o.querySelectorAll("li button"),t.initMenuTarget(this.name,e,l),l=null,o=null},setSubmenu:function(t){const e=t.lang,i=t.icons,n=t.util.createElement("DIV"),l="left"===t.context.align.defaultDir,o='<li><button type="button" class="meta-btn-list meta-btn-align" data-command="justifyleft" data-value="left" title="'+e.toolbar.alignLeft+'"><span class="meta-list-icon">'+i.align_left+"</span>"+e.toolbar.alignLeft+"</button></li>",s='<li><button type="button" class="meta-btn-list meta-btn-align" data-command="justifyright" data-value="right" title="'+e.toolbar.alignRight+'"><span class="meta-list-icon">'+i.align_right+"</span>"+e.toolbar.alignRight+"</button></li>";return n.className="meta-submenu meta-list-layer meta-list-align",n.innerHTML='<div class="meta-list-inner"><ul class="meta-list-basic">'+(l?o:s)+'<li><button type="button" class="meta-btn-list meta-btn-align" data-command="justifycenter" data-value="center" title="'+e.toolbar.alignCenter+'"><span class="meta-list-icon">'+i.align_center+"</span>"+e.toolbar.alignCenter+"</button></li>"+(l?s:o)+'<li><button type="button" class="meta-btn-list meta-btn-align" data-command="justifyfull" data-value="justify" title="'+e.toolbar.alignJustify+'"><span class="meta-list-icon">'+i.align_justify+"</span>"+e.toolbar.alignJustify+"</button></li></ul></div>",n},active:function(t){const e=this.context.align,i=e.targetButton,n=i.firstElementChild;if(t){if(this.util.isFormatElement(t)){const l=t.style.textAlign;if(l)return this.util.changeElement(n,e.icons[l]||e.icons[e.defaultDir]),i.setAttribute("data-focus",l),!0}}else this.util.changeElement(n,e.icons[e.defaultDir]),i.removeAttribute("data-focus");return!1},on:function(){const t=this.context.align,e=t.alignList,i=t.targetButton.getAttribute("data-focus")||t.defaultDir;if(i!==t.currentAlign){for(let t=0,n=e.length;t<n;t++)i===e[t].getAttribute("data-value")?this.util.addClass(e[t],"active"):this.util.removeClass(e[t],"active");t.currentAlign=i}},pickup(t){t.preventDefault(),t.stopPropagation();let e=t.target,i=null;for(;!i&&!/UL/i.test(e.tagName);)i=e.getAttribute("data-value"),e=e.parentNode;if(!i)return;const n=this.context.align.defaultDir,l=this.getSelectedElements();for(let o=0,s=l.length;o<s;o++)this.util.setStyle(l[o],"textAlign",i===n?"":i);this.effectNode=null,this.submenuOff(),this.focus(),this.history.push(!1)}},e={name:"font",display:"submenu",add:function(t,e){const i=t.context,n=t.icons;i.font={targetText:e.querySelector(".txt"),targetTooltip:e.parentNode.querySelector(".meta-tooltip-text"),fontList:null,currentFont:"",icon:n.font};let l=this.setSubmenu(t);l.querySelector(".meta-list-inner").addEventListener("click",this.pickup.bind(t)),i.font.fontList=l.querySelectorAll("ul li button"),t.initMenuTarget(this.name,e,l),l=null},setSubmenu:function(t){const e=t.options,i=t.lang,n=t.util.createElement("DIV");let l,o,s,a;n.className="meta-submenu meta-list-layer meta-list-font-family";const r=e.font?e.font:["Arial","Comic Sans MS","Courier New","Impact","Georgia","tahoma","Trebuchet MS","Verdana"];let c='<div class="meta-list-inner"><ul class="meta-list-basic"><li><button type="button" class="default_value meta-btn-list" title="'+i.toolbar.default+'">('+i.toolbar.default+")</button></li>";for(s=0,a=r.length;s<a;s++)l=r[s],o=l.split(",")[0],c+='<li><button type="button" class="meta-btn-list" data-value="'+l+'" data-txt="'+o+'" title="'+o+'" style="font-family:'+l+';">'+o+"</button></li>";return c+="</ul></div>",n.innerHTML=c,n},active:function(t){const e=this.context.font.targetText.firstElementChild,i=this.context.font.targetTooltip,n=this.context.font.icon;if(t){if(t.style&&t.style.fontFamily.length>0){const n=t.style.fontFamily.replace(/["']/g,"");return this.util.changeElement(e,`<span>${n}</span>`),this.util.changeTxt(i,this.lang.toolbar.font+" ("+n+")"),!0}}else{const t=this.hasFocus?this.wwComputedStyle.fontFamily?`<span>${this.util.isJsonStr(this.wwComputedStyle.fontFamily)?JSON.parse(this.wwComputedStyle.fontFamily):this.wwComputedStyle.fontFamily}</span>`:"":n;this.util.changeElement(e,t);const l=this.hasFocus?this.wwComputedStyle.fontFamily&&this.util.isJsonStr(this.wwComputedStyle.fontFamil)?JSON.parse(this.wwComputedStyle.fontFamily):this.wwComputedStyle.fontFamil||"":this.lang.toolbar.font;this.util.changeTxt(i,this.hasFocus?this.lang.toolbar.font+" ("+l+")":l)}return!1},on:function(){const t=this.context.font,e=t.fontList,i=t.targetText.textContent;if(i!==t.currentFont){for(let t=0,n=e.length;t<n;t++)i===e[t].getAttribute("data-value")?this.util.addClass(e[t],"active"):this.util.removeClass(e[t],"active");t.currentFont=i}},pickup:function(t){if(!/^BUTTON$/i.test(t.target.tagName))return!1;t.preventDefault(),t.stopPropagation();const e=t.target.getAttribute("data-value");if(e){const t=this.util.createElement("SPAN");t.style.fontFamily=e,this.nodeChange(t,["font-family"],null,null)}else this.nodeChange(null,["font-family"],["span"],!0);this.submenuOff()}},i={name:"colorPicker",add:function(t){const e=t.context;e.colorPicker={colorListHTML:"",colorInput:"",defaultColor:"#000",styleProperty:"color",currentColor:"",colorList:[]},e.colorPicker.colorListHTML=this.createColorList(t,this.makeColorList)},createColorList:function(t,e){const i=t.options,n=t.lang,l=i.colorList&&0!==i.colorList.length?i.colorList:["#ff0000","#ff5e00","#ffe400","#abf200","#00d8ff","#0055ff","#6600ff","#ff00dd","#000000","#ffd8d8","#fae0d4","#faf4c0","#e4f7ba","#d4f4fa","#d9e5ff","#e8d9ff","#ffd9fa","#f1f1f1","#ffa7a7","#ffc19e","#faed7d","#cef279","#b2ebf4","#b2ccff","#d1b2ff","#ffb2f5","#bdbdbd","#f15f5f","#f29661","#e5d85c","#bce55c","#5cd1e5","#6699ff","#a366ff","#f261df","#8c8c8c","#980000","#993800","#998a00","#6b9900","#008299","#003399","#3d0099","#990085","#353535","#670000","#662500","#665c00","#476600","#005766","#002266","#290066","#660058","#222222"];let o=[],s='<div class="meta-list-inner">';for(let a,r=0,c=l.length;r<c;r++)a=l[r],a&&("string"===typeof a&&(o.push(a),r<c-1)||(o.length>0&&(s+='<div class="meta-selector-color">'+e(o)+"</div>",o=[]),"object"===typeof a&&(s+='<div class="meta-selector-color">'+e(a)+"</div>")));return s+='<form class="meta-submenu-form-group"><input type="text" maxlength="9" class="_meta_color_picker_input meta-color-input"/><button type="submit" class="meta-btn-primary _meta_color_picker_submit" title="'+n.dialogBox.submitButton+'">'+t.icons.checked+'</button><button type="button" class="meta-btn _meta_color_picker_remove" title="'+n.toolbar.removeFormat+'">'+t.icons.erase+"</button></form></div>",s},makeColorList:function(t){let e="";e+='<ul class="meta-color-pallet">';for(let i,n=0,l=t.length;n<l;n++)i=t[n],"string"===typeof i&&(e+='<li><button type="button" data-value="'+i+'" title="'+i+'" style="background-color:'+i+';"></button></li>');return e+="</ul>",e},init:function(t,e){const i=this.plugins.colorPicker;let n=e||(i.getColorInNode.call(this,t)||this.context.colorPicker.defaultColor);n=i.isHexColor(n)?n:i.rgb2hex(n)||n;const l=this.context.colorPicker.colorList;if(l)for(let o=0,s=l.length;o<s;o++)n.toLowerCase()===l[o].getAttribute("data-value").toLowerCase()?this.util.addClass(l[o],"active"):this.util.removeClass(l[o],"active");i.setInputText.call(this,i.colorName2hex.call(this,n))},setCurrentColor:function(t){this.context.colorPicker.currentColor=t,this.context.colorPicker.colorInput.style.borderColor=t},setInputText:function(t){t=/^#/.test(t)?t:"#"+t,this.context.colorPicker.colorInput.value=t,this.plugins.colorPicker.setCurrentColor.call(this,t)},getColorInNode:function(t){let e="";const i=this.context.colorPicker.styleProperty;for(;t&&!this.util.isWysiwygDiv(t)&&0===e.length;)1===t.nodeType&&t.style[i]&&(e=t.style[i]),t=t.parentNode;return e},isHexColor:function(t){return/^#[0-9a-f]{3}(?:[0-9a-f]{3})?$/i.test(t)},rgb2hex:function(t){const e=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return e&&4===e.length?"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2):""},colorName2hex:function(t){if(/^#/.test(t))return t;const e=this.util.createElement("div");e.style.display="none",e.style.color=t;const i=this._window.getComputedStyle(this._document.body.appendChild(e)).color.match(/\d+/g).map((function(t){return parseInt(t,10)}));return this.util.removeItem(e),i.length>=3&&"#"+((1<<24)+(i[0]<<16)+(i[1]<<8)+i[2]).toString(16).substr(1)}},n={name:"fontColor",display:"submenu",add:function(t,e){t.addModule([i]);const n=t.context;n.fontColor={previewEl:null,colorInput:null,colorList:null};let l=this.setSubmenu(t);n.fontColor.colorInput=l.querySelector("._meta_color_picker_input"),n.fontColor.colorInput.addEventListener("keyup",this.onChangeInput.bind(t)),l.querySelector("._meta_color_picker_submit").addEventListener("click",this.submit.bind(t)),l.querySelector("._meta_color_picker_remove").addEventListener("click",this.remove.bind(t)),l.addEventListener("click",this.pickup.bind(t)),n.fontColor.colorList=l.querySelectorAll("li button"),t.initMenuTarget(this.name,e,l),l=null},setSubmenu:function(t){const e=t.context.colorPicker.colorListHTML,i=t.util.createElement("DIV");return i.className="meta-submenu meta-list-layer",i.innerHTML=e,i},on:function(){const t=this.context.colorPicker,e=this.context.fontColor;t.colorInput=e.colorInput;const i=this.wwComputedStyle.color;t.defaultColor=i?this.plugins.colorPicker.isHexColor(i)?i:this.plugins.colorPicker.rgb2hex(i):"#333333",t.styleProperty="color",t.colorList=e.colorList,this.plugins.colorPicker.init.call(this,this.getSelectionNode(),null)},onChangeInput:function(t){this.plugins.colorPicker.setCurrentColor.call(this,t.target.value)},submit:function(){this.plugins.fontColor.applyColor.call(this,this.context.colorPicker.currentColor)},pickup:function(t){t.preventDefault(),t.stopPropagation(),this.plugins.fontColor.applyColor.call(this,t.target.getAttribute("data-value"))},remove:function(){this.nodeChange(null,["color"],["span"],!0),this.submenuOff()},applyColor:function(t){if(!t)return;const e=this.util.createElement("SPAN");e.style.color=t,this.nodeChange(e,["color"],null,null),this.submenuOff()}},l={name:"hiliteColor",display:"submenu",add:function(t,e){t.addModule([i]);const n=t.context;n.hiliteColor={previewEl:null,colorInput:null,colorList:null};let l=this.setSubmenu(t);n.hiliteColor.colorInput=l.querySelector("._meta_color_picker_input"),n.hiliteColor.colorInput.addEventListener("keyup",this.onChangeInput.bind(t)),l.querySelector("._meta_color_picker_submit").addEventListener("click",this.submit.bind(t)),l.querySelector("._meta_color_picker_remove").addEventListener("click",this.remove.bind(t)),l.addEventListener("click",this.pickup.bind(t)),n.hiliteColor.colorList=l.querySelectorAll("li button"),t.initMenuTarget(this.name,e,l),l=null},setSubmenu:function(t){const e=t.context.colorPicker.colorListHTML,i=t.util.createElement("DIV");return i.className="meta-submenu meta-list-layer",i.innerHTML=e,i},on:function(){const t=this.context.colorPicker,e=this.context.hiliteColor;t.colorInput=e.colorInput;const i=this.wwComputedStyle.backgroundColor;t.defaultColor=i?this.plugins.colorPicker.isHexColor(i)?i:this.plugins.colorPicker.rgb2hex(i):"#ffffff",t.styleProperty="backgroundColor",t.colorList=e.colorList,this.plugins.colorPicker.init.call(this,this.getSelectionNode(),null)},onChangeInput:function(t){this.plugins.colorPicker.setCurrentColor.call(this,t.target.value)},submit:function(){this.plugins.hiliteColor.applyColor.call(this,this.context.colorPicker.currentColor)},pickup:function(t){t.preventDefault(),t.stopPropagation(),this.plugins.hiliteColor.applyColor.call(this,t.target.getAttribute("data-value"))},remove:function(){this.nodeChange(null,["background-color"],["span"],!0),this.submenuOff()},applyColor:function(t){if(!t)return;const e=this.util.createElement("SPAN");e.style.backgroundColor=t,this.nodeChange(e,["background-color"],null,null),this.submenuOff()}},o={name:"list",display:"submenu",add:function(t,e){const i=t.context;i.list={targetButton:e,list:null,currentList:"",icons:{bullets:t.icons.list_bullets,number:t.icons.list_number}};let n=this.setSubmenu(t),l=n.querySelector("ul");l.addEventListener("click",this.pickup.bind(t)),i.list.list=l.querySelectorAll("li button"),t.initMenuTarget(this.name,e,n),n=null,l=null},setSubmenu:function(t){const e=t.lang,i=t.util.createElement("DIV");return i.className="meta-submenu meta-list-layer",i.innerHTML='<div class="meta-list-inner"><ul class="meta-list-basic"><li><button type="button" class="meta-btn-list meta-tooltip" data-command="OL" title="'+e.toolbar.orderList+'">'+t.icons.list_number+'</button></li><li><button type="button" class="meta-btn-list meta-tooltip" data-command="UL" title="'+e.toolbar.unorderList+'">'+t.icons.list_bullets+"</button></li></ul></div>",i},active:function(t){const e=this.context.list.targetButton,i=e.firstElementChild,n=this.util;if(t){if(n.isList(t)){const l=t.nodeName;return e.setAttribute("data-focus",l),n.addClass(e,"active"),/UL/i.test(l)?n.changeElement(i,this.context.list.icons.bullets):n.changeElement(i,this.context.list.icons.number),!0}}else e.removeAttribute("data-focus"),n.changeElement(i,this.context.list.icons.number),n.removeClass(e,"active");return!1},on:function(){const t=this.context.list,e=t.list,i=t.targetButton.getAttribute("data-focus")||"";if(i!==t.currentList){for(let t=0,n=e.length;t<n;t++)i===e[t].getAttribute("data-command")?this.util.addClass(e[t],"active"):this.util.removeClass(e[t],"active");t.currentList=i}},editList(t,e,i){let n=this.getRange(),l=e||this.getSelectedElementsAndComponents(!1);if(0===l.length){if(e)return;if(n=this.getRange_addLine(n,null),l=this.getSelectedElementsAndComponents(!1),0===l.length)return}const o=this.util;o.sortByDepth(l,!0);const s=l[0],a=l[l.length-1];let r=!o.isListCell(s)&&!o.isComponent(s)||s.previousElementSibling?s.previousElementSibling:s.parentNode.previousElementSibling,c=!o.isListCell(a)&&!o.isComponent(a)||a.nextElementSibling?a.nextElementSibling:a.parentNode.nextElementSibling;const u={sc:n.startContainer,so:n.startOffset,ec:n.endContainer,eo:n.endOffset};let d=!0;for(let h=0,m=l.length;h<m;h++)if(!o.isList(o.getRangeFormatElement(l[h],function(t){return this.getRangeFormatElement(t)&&t!==l[h]}.bind(o)))){d=!1;break}if(!d||r&&s.tagName===r.tagName&&t===r.tagName.toUpperCase()||c&&a.tagName===c.tagName&&t===c.tagName.toUpperCase()){const e=r?r.parentNode:r,i=c?c.parentNode:c;r=e&&!o.isWysiwygDiv(e)&&e.nodeName===t?e:r,c=i&&!o.isWysiwygDiv(i)&&i.nodeName===t?i:c;const n=r&&r.tagName===t,s=c&&c.tagName===t;let a=n?r:o.createElement(t),u=null,d=null;const h=function(t){return!this.isComponent(t)&&!this.isList(t)}.bind(o);for(let r,c,m,p,g,f,b,v,y,x=0,_=l.length;x<_;x++)if(c=l[x],0!==c.childNodes.length||o.isIgnoreNodeChange(c)){if(p=l[x+1],g=c.parentNode,f=p?p.parentNode:null,m=o.isListCell(c),y=o.isRangeFormatElement(g)?g:null,b=m&&!o.isWysiwygDiv(g)?g.parentNode:g,v=m&&!o.isWysiwygDiv(g)?!p||o.isListCell(b)?g:g.nextSibling:c.nextSibling,r=o.createElement("LI"),o.copyFormatAttributes(r,c),o.isComponent(c)){const t=/^HR$/i.test(c.nodeName);t||(r.innerHTML="<br>"),r.innerHTML+=c.outerHTML,t&&(r.innerHTML+="<br>")}else{const t=c.childNodes;for(;t[0];)r.appendChild(t[0])}a.appendChild(r),p&&b===f&&!o.isRangeFormatElement(v)||(u||(u=a),n&&p&&b===f||p&&o.isList(f)&&f===g||a.parentNode!==b&&b.insertBefore(a,v)),o.removeItem(c),n&&null===d&&(d=a.children.length-1),p&&(o.getRangeFormatElement(f,h)!==o.getRangeFormatElement(g,h)||o.isList(f)&&o.isList(g)&&o.getElementDepth(f)!==o.getElementDepth(g))&&(a=o.createElement(t)),y&&0===y.children.length&&o.removeItem(y)}else o.removeItem(c);d&&(u=u.children[d]),s&&(a.innerHTML+=c.innerHTML,o.removeItem(c))}else{if(i)for(let t=0,i=l.length;t<i;t++)for(let e=t-1;e>=0;e--)if(l[e].contains(l[t])){l.splice(t,1),t--,i--;break}const e=o.getRangeFormatElement(s),n=e&&e.tagName===t;let a,r;const c=function(t){return!this.isComponent(t)}.bind(o);n||(r=o.createElement(t));for(let s,u,d=0,h=l.length;d<h;d++)u=o.getRangeFormatElement(l[d],c),u&&o.isList(u)&&(s?s!==u?(i&&o.isListCell(u.parentNode)?this.plugins.list.detachNested.call(this,a.f):this.detachRangeFormatElement(a.f[0].parentNode,a.f,r,!1,!0),u=l[d].parentNode,n||(r=o.createElement(t)),s=u,a={r:s,f:[o.getParentElement(l[d],"LI")]}):a.f.push(o.getParentElement(l[d],"LI")):(s=u,a={r:s,f:[o.getParentElement(l[d],"LI")]}),d===h-1&&(i&&o.isListCell(u.parentNode)?this.plugins.list.detachNested.call(this,a.f):this.detachRangeFormatElement(a.f[0].parentNode,a.f,r,!1,!0)))}return this.effectNode=null,u},detachNested:function(t){const e=t[0],i=t[t.length-1],n=i.nextElementSibling,l=e.parentNode,o=l.parentNode.nextElementSibling,s=l.parentNode.parentNode;for(let r=0,c=t.length;r<c;r++)s.insertBefore(t[r],o);if(n&&l.children.length>0){const t=l.cloneNode(!1),e=l.childNodes,o=this.util.getPositionIndex(n);for(;e[o];)t.appendChild(e[o]);i.appendChild(t)}0===l.children.length&&this.util.removeItem(l),this.util.mergeSameTags(s);const a=this.util.getEdgeChildNodes(e,i);return{cc:e.parentNode,sc:a.sc,ec:a.ec}},editInsideList:function(t,e){const i=(e=e||this.getSelectedElements().filter(function(t){return this.isListCell(t)}.bind(this.util))).length;if(0===i||!t&&!this.util.isListCell(e[0].previousElementSibling)&&!this.util.isListCell(e[i-1].nextElementSibling))return{sc:e[0],so:0,ec:e[i-1],eo:1};let n=e[0].parentNode,l=e[i-1],o=null;if(t){if(n!==l.parentNode&&this.util.isList(l.parentNode.parentNode)&&l.nextElementSibling)for(l=l.nextElementSibling;l;)e.push(l),l=l.nextElementSibling;o=this.plugins.list.editList.call(this,n.nodeName.toUpperCase(),e,!0)}else{let t=this.util.createElement(n.nodeName),s=e[0].previousElementSibling,a=l.nextElementSibling;const r={s:null,e:null,sl:n,el:n};for(let l,o=0,d=i;o<d;o++)l=e[o],l.parentNode!==n&&(this.plugins.list.insiedList.call(this,n,t,s,a,r),n=l.parentNode,t=this.util.createElement(n.nodeName)),s=l.previousElementSibling,a=l.nextElementSibling,t.appendChild(l);this.plugins.list.insiedList.call(this,n,t,s,a,r);const c=this.util.getNodeFromPath(r.s,r.sl),u=this.util.getNodeFromPath(r.e,r.el);o={sc:c,so:0,ec:u,eo:u.textContent.length}}return o},insiedList:function(t,e,i,n,l){let o=!1;if(i&&e.tagName===i.tagName){const t=e.children;for(;t[0];)i.appendChild(t[0]);e=i,o=!0}if(n&&e.tagName===n.tagName){const t=n.children;for(;t[0];)e.appendChild(t[0]);const i=n.nextElementSibling;n.parentNode.removeChild(n),n=i}if(!o){this.util.isListCell(i)&&(t=i,n=null),t.insertBefore(e,n),l.s||(l.s=this.util.getNodePath(e.firstElementChild.firstChild,t,null),l.sl=t);const o=t.contains(l.sl)?this.util.getNodePath(l.sl,t):null;l.e=this.util.getNodePath(e.lastElementChild.firstChild,t,null),l.el=t,this.util.mergeSameTags(t,[l.s,l.e,o],!1),this.util.mergeNestedTags(t),o&&(l.sl=this.util.getNodeFromPath(o,t))}return e},pickup:function(t){t.preventDefault(),t.stopPropagation();let e=t.target,i="";for(;!i&&!/^UL$/i.test(e.tagName);)i=e.getAttribute("data-command"),e=e.parentNode;if(!i)return;const n=this.plugins.list.editList.call(this,i,null,!1);n&&this.setRange(n.sc,n.so,n.ec,n.eo),this.submenuOff(),this.history.push(!1)}},s={name:"table",display:"submenu",init:function(){const t=this.context.table,e=this.plugins.table;if(e.removeEvents.call(this),e.selectedTable){const t=e.selectedTable.querySelectorAll(".meta-table-selected-cell");for(let e=0,i=t.length;e<i;e++)this.util.removeClass(t[e],"meta-table-selected-cell")}e.toggleEditor.call(this,!0),t.element=null,t.tdElement=null,t.trElement=null,t.trElements=null,t.tableXY=[],t.maxWidth=!0,t.fixedColumn=!1,t.physical_cellCnt=0,t.logical_cellCnt=0,t.rowCnt=0,t.rowIndex=0,t.physical_cellIndex=0,t.logical_cellIndex=0,t.current_colSpan=0,t.current_rowSpan=0,e.shift=!1,e.selectedCells=null,e.selectedTable=null,e.ref=null,e.fixedCell=null,e.selectedCell=null,e.fixedCellName=null},add:function(t,e){const i=t.context;let n=i.table={element:null,tdElement:null,trElement:null,trElements:null,tableXY:[],maxWidth:!0,fixedColumn:!1,rtl:t.options.rtl,cellControllerTop:"top"===t.options.tableCellControllerPosition,resizeText:null,headerButton:null,mergeButton:null,splitButton:null,splitMenu:null,maxText:t.lang.controller.maxSize,minText:t.lang.controller.minSize,physical_cellCnt:0,logical_cellCnt:0,rowCnt:0,rowIndex:0,physical_cellIndex:0,logical_cellIndex:0,current_colSpan:0,current_rowSpan:0,icons:{expansion:t.icons.expansion,reduction:t.icons.reduction}},l=this.setSubmenu(t),o=l.querySelector(".meta-controller-table-picker");n.tableHighlight=l.querySelector(".meta-table-size-highlighted"),n.tableUnHighlight=l.querySelector(".meta-table-size-unhighlighted"),n.tableDisplay=l.querySelector(".meta-table-size-display"),t.options.rtl&&(n.tableHighlight.style.left="167px");let s=this.setController_table(t);n.tableController=s,n.resizeButton=s.querySelector("._meta_table_resize"),n.resizeText=s.querySelector("._meta_table_resize > span > span"),n.columnFixedButton=s.querySelector("._meta_table_fixed_column"),n.headerButton=s.querySelector("._meta_table_header");let a=this.setController_tableEditor(t,n.cellControllerTop);n.resizeDiv=a,n.splitMenu=a.querySelector(".meta-btn-group-sub"),n.mergeButton=a.querySelector("._meta_table_merge_button"),n.splitButton=a.querySelector("._meta_table_split_button"),n.insertRowAboveButton=a.querySelector("._meta_table_insert_row_a"),n.insertRowBelowButton=a.querySelector("._meta_table_insert_row_b"),o.addEventListener("mousemove",this.onMouseMove_tablePicker.bind(t,n)),o.addEventListener("click",this.appendTable.bind(t)),a.addEventListener("click",this.onClick_tableController.bind(t)),s.addEventListener("click",this.onClick_tableController.bind(t)),t.initMenuTarget(this.name,e,l),i.element.relative.appendChild(a),i.element.relative.appendChild(s),l=null,o=null,a=null,s=null,n=null},setSubmenu:function(t){const e=t.util.createElement("DIV");return e.className="meta-submenu meta-selector-table",e.innerHTML='<div class="meta-table-size"><div class="meta-table-size-picker meta-controller-table-picker"></div><div class="meta-table-size-highlighted"></div><div class="meta-table-size-unhighlighted"></div></div><div class="meta-table-size-display">1 x 1</div>',e},setController_table:function(t){const e=t.lang,i=t.icons,n=t.util.createElement("DIV");return n.className="meta-controller meta-controller-table",n.innerHTML='<div><div class="meta-btn-group"><button type="button" data-command="resize" class="meta-btn meta-tooltip _meta_table_resize">'+i.expansion+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.controller.maxSize+'</span></span></button><button type="button" data-command="layout" class="meta-btn meta-tooltip _meta_table_fixed_column">'+i.fixed_column_width+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.controller.fixedColumnWidth+'</span></span></button><button type="button" data-command="header" class="meta-btn meta-tooltip _meta_table_header">'+i.table_header+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.controller.tableHeader+'</span></span></button><button type="button" data-command="remove" class="meta-btn meta-tooltip">'+i.delete+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.controller.remove+"</span></span></button></div></div>",n},setController_tableEditor:function(t,e){const i=t.lang,n=t.icons,l=t.util.createElement("DIV");return l.className="meta-controller meta-controller-table-cell",l.innerHTML=(e?"":'<div class="meta-arrow meta-arrow-up"></div>')+'<div class="meta-btn-group"><button type="button" data-command="insert" data-value="row" data-option="up" class="meta-btn meta-tooltip _meta_table_insert_row_a">'+n.insert_row_above+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+i.controller.insertRowAbove+'</span></span></button><button type="button" data-command="insert" data-value="row" data-option="down" class="meta-btn meta-tooltip _meta_table_insert_row_b">'+n.insert_row_below+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+i.controller.insertRowBelow+'</span></span></button><button type="button" data-command="delete" data-value="row" class="meta-btn meta-tooltip">'+n.delete_row+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+i.controller.deleteRow+'</span></span></button><button type="button" data-command="merge" class="_meta_table_merge_button meta-btn meta-tooltip" disabled>'+n.merge_cell+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+i.controller.mergeCells+'</span></span></button></div><div class="meta-btn-group" style="padding-top: 0;"><button type="button" data-command="insert" data-value="cell" data-option="left" class="meta-btn meta-tooltip">'+n.insert_column_left+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+i.controller.insertColumnBefore+'</span></span></button><button type="button" data-command="insert" data-value="cell" data-option="right" class="meta-btn meta-tooltip">'+n.insert_column_right+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+i.controller.insertColumnAfter+'</span></span></button><button type="button" data-command="delete" data-value="cell" class="meta-btn meta-tooltip">'+n.delete_column+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+i.controller.deleteColumn+'</span></span></button><button type="button" data-command="onsplit" class="_meta_table_split_button meta-btn meta-tooltip">'+n.split_cell+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+i.controller.splitCells+'</span></span></button><div class="meta-btn-group-sub meta-common meta-list-layer meta-table-split"><div class="meta-list-inner"><ul class="meta-list-basic"><li class="meta-btn-list" data-command="split" data-value="vertical" style="line-height:32px;" title="'+i.controller.VerticalSplit+'">'+i.controller.VerticalSplit+'</li><li class="meta-btn-list" data-command="split" data-value="horizontal" style="line-height:32px;" title="'+i.controller.HorizontalSplit+'">'+i.controller.HorizontalSplit+"</li></ul></div></div></div>",l},appendTable:function(){const t=this.util.createElement("TABLE"),e=this.plugins.table.createCells,i=this.context.table.tableXY[0];let n=this.context.table.tableXY[1],l="<tbody>";for(;n>0;)l+="<tr>"+e.call(this,"td",i)+"</tr>",--n;l+="</tbody>",t.innerHTML=l;if(this.insertComponent(t,!1,!0,!1)){const e=t.querySelector("td div");this.setRange(e,0,e,0),this.plugins.table.reset_table_picker.call(this)}},createCells:function(t,e,i){if(t=t.toLowerCase(),i){const e=this.util.createElement(t);return e.innerHTML="<div><br></div>",e}{let i="";for(;e>0;)i+="<"+t+"><div><br></div></"+t+">",e--;return i}},onMouseMove_tablePicker:function(t,e){e.stopPropagation();let i=this._window.Math.ceil(e.offsetX/18),n=this._window.Math.ceil(e.offsetY/18);i=i<1?1:i,n=n<1?1:n,t.rtl&&(t.tableHighlight.style.left=18*i-13+"px",i=11-i),t.tableHighlight.style.width=i+"em",t.tableHighlight.style.height=n+"em",this.util.changeTxt(t.tableDisplay,i+" x "+n),t.tableXY=[i,n]},reset_table_picker:function(){if(!this.context.table.tableHighlight)return;const t=this.context.table.tableHighlight.style,e=this.context.table.tableUnHighlight.style;t.width="1em",t.height="1em",e.width="10em",e.height="10em",this.util.changeTxt(this.context.table.tableDisplay,"1 x 1"),this.submenuOff()},call_controller_tableEdit:function(t){const e=this.plugins.table,i=this.context.table;if(!this.getSelection().isCollapsed&&!e.selectedCell)return this.controllersOff(),void this.util.removeClass(t,"meta-table-selected-cell");const n=i.element||this.plugins.table.selectedTable||this.util.getParentElement(t,"TABLE");i.maxWidth=this.util.hasClass(n,"meta-table-size-100")||"100%"===n.style.width||!n.style.width&&!this.util.hasClass(n,"meta-table-size-auto"),i.fixedColumn=this.util.hasClass(n,"meta-table-layout-fixed")||"fixed"===n.style.tableLayout,e.setTableStyle.call(this,i.maxWidth?"width|column":"width"),e.setPositionControllerTop.call(this,n),e.setPositionControllerDiv.call(this,t,e.shift),e.shift||this.controllersOn(i.resizeDiv,i.tableController,e.init.bind(this),t,"table")},setPositionControllerTop:function(t){this.setControllerPosition(this.context.table.tableController,t,"top",{left:0,top:0})},setPositionControllerDiv:function(t,e){const i=this.context.table,n=i.resizeDiv;this.plugins.table.setCellInfo.call(this,t,e),i.cellControllerTop?this.setControllerPosition(n,i.element,"top",{left:i.tableController.offsetWidth,top:0}):this.setControllerPosition(n,t,"bottom",{left:0,top:0})},setCellInfo:function(t,e){const i=this.context.table,n=i.element=this.plugins.table.selectedTable||this.util.getParentElement(t,"TABLE");if(/THEAD/i.test(n.firstElementChild.nodeName)?this.util.addClass(i.headerButton,"active"):this.util.removeClass(i.headerButton,"active"),e||0===i.physical_cellCnt){i.tdElement!==t&&(i.tdElement=t,i.trElement=t.parentNode);const e=i.trElements=n.rows,l=t.cellIndex;let o=0;for(let t=0,i=e[0].cells,n=e[0].cells.length;t<n;t++)o+=i[t].colSpan;const s=i.rowIndex=i.trElement.rowIndex;i.rowCnt=e.length,i.physical_cellCnt=i.trElement.cells.length,i.logical_cellCnt=o,i.physical_cellIndex=l,i.current_colSpan=i.tdElement.colSpan-1,i.current_rowSpan,i.trElement.cells[l].rowSpan;let a=[],r=[];for(let t,n,c=0;c<=s;c++){t=e[c].cells,n=0;for(let e,o,u,d,h=0,m=t.length;h<m;h++){if(e=t[h],o=e.colSpan-1,u=e.rowSpan-1,d=h+n,r.length>0)for(let t,e=0;e<r.length;e++)t=r[e],t.row>c||(d>=t.index?(n+=t.cs,d+=t.cs,t.rs-=1,t.row=c+1,t.rs<1&&(r.splice(e,1),e--)):h===m-1&&(t.rs-=1,t.row=c+1,t.rs<1&&(r.splice(e,1),e--)));if(c===s&&h===l){i.logical_cellIndex=d;break}u>0&&a.push({index:d,cs:o+1,rs:u,row:-1}),n+=o}r=r.concat(a).sort((function(t,e){return t.index-e.index})),a=[]}a=null,r=null}},editTable:function(t,e){const i=this.plugins.table,n=this.context.table,l=n.element,o="row"===t;if(o){const t=n.trElement.parentNode;if(/^THEAD$/i.test(t.nodeName)){if("up"===e)return;if(!t.nextElementSibling||!/^TBODY$/i.test(t.nextElementSibling.nodeName))return void(l.innerHTML+="<tbody><tr>"+i.createCells.call(this,"td",n.logical_cellCnt,!1)+"</tr></tbody>")}}if(i.ref){const t=n.tdElement,l=i.selectedCells;if(o)if(e)i.setCellInfo.call(this,"up"===e?l[0]:l[l.length-1],!0),i.editRow.call(this,e,t);else{let t=l[0].parentNode;const n=[l[0]];for(let e,i=1,o=l.length;i<o;i++)e=l[i],t!==e.parentNode&&(n.push(e),t=e.parentNode);for(let l=0,o=n.length;l<o;l++)i.setCellInfo.call(this,n[l],!0),i.editRow.call(this,e)}else{const n=l[0].parentNode;if(e){let o=null;for(let t=0,e=l.length-1;t<e;t++)if(n!==l[t+1].parentNode){o=l[t];break}i.setCellInfo.call(this,"left"===e?l[0]:o||l[0],!0),i.editCell.call(this,e,t)}else{const t=[l[0]];for(let e,i=1,o=l.length;i<o&&(e=l[i],n===e.parentNode);i++)t.push(e);for(let n=0,l=t.length;n<l;n++)i.setCellInfo.call(this,t[n],!0),i.editCell.call(this,e)}}e||i.init.call(this)}else i[o?"editRow":"editCell"].call(this,e);if(!e){const t=l.children;for(let e=0;e<t.length;e++)0===t[e].children.length&&(this.util.removeItem(t[e]),e--);0===l.children.length&&this.util.removeItem(l)}},editRow:function(t,e){const i=this.context.table,n=!t,l="up"===t,o=i.rowIndex,s=n||l?o:o+i.current_rowSpan+1,a=n?-1:1,r=i.trElements;let c=i.logical_cellCnt;for(let u,d=0,h=o+(n?-1:0);d<=h;d++){if(u=r[d].cells,0===u.length)return;for(let t,e,i=0,n=u.length;i<n;i++)t=u[i].rowSpan,e=u[i].colSpan,t<2&&e<2||t+d>s&&s>d&&(u[i].rowSpan=t+a,c-=e)}if(n){const t=r[o+1];if(t){const e=[];let i=r[o].cells,n=0;for(let t,l,o=0,s=i.length;o<s;o++)t=i[o],l=o+n,n+=t.colSpan-1,t.rowSpan>1&&(t.rowSpan-=1,e.push({cell:t.cloneNode(!1),index:l}));if(e.length>0){let l=e.shift();i=t.cells,n=0;for(let o,s,a=0,r=i.length;a<r&&(o=i[a],s=a+n,n+=o.colSpan-1,!(s>=l.index)||(a--,n--,n+=l.cell.colSpan-1,t.insertBefore(l.cell,o),l=e.shift(),l));a++);if(l){t.appendChild(l.cell);for(let i=0,n=e.length;i<n;i++)t.appendChild(e[i].cell)}}}i.element.deleteRow(s)}else{i.element.insertRow(s).innerHTML=this.plugins.table.createCells.call(this,"td",c,!1)}n?this.controllersOff():this.plugins.table.setPositionControllerDiv.call(this,e||i.tdElement,!0)},editCell:function(t,e){const i=this.context.table,n=this.util,l=!t,o="left"===t,s=i.current_colSpan,a=l||o?i.logical_cellIndex:i.logical_cellIndex+s+1,r=i.trElements;let c=[],u=[],d=0;const h=[],m=[];for(let p,g,f,b,v,y,x=0,_=i.rowCnt;x<_;x++){p=r[x],g=a,v=!1,f=p.cells,y=0;for(let t,e,i,o,r=0,p=f.length;r<p&&(t=f[r],t);r++)if(e=t.rowSpan-1,i=t.colSpan-1,l){if(o=r+y,u.length>0){const t=!f[r+1];for(let e,i=0;i<u.length;i++)e=u[i],e.row>x||(o>=e.index?(y+=e.cs,o=r+y,e.rs-=1,e.row=x+1,e.rs<1&&(u.splice(i,1),i--)):t&&(e.rs-=1,e.row=x+1,e.rs<1&&(u.splice(i,1),i--)))}e>0&&c.push({rs:e,cs:i+1,index:o,row:-1}),o>=g&&o+i<=g+s?h.push(t):o<=g+s&&o+i>=g?t.colSpan-=n.getOverlapRangeAtIndex(a,a+s,o,o+i):e>0&&(o<g||o+i>g+s)&&m.push({cell:t,i:x,rs:x+e}),y+=i}else{if(r>=g)break;if(i>0){if(d<1&&i+r>=g){t.colSpan+=1,g=null,d=e+1;break}g-=i}if(!v){for(let t,e=0;e<u.length;e++)t=u[e],g-=t.cs,t.rs-=1,t.rs<1&&(u.splice(e,1),e--);v=!0}}if(u=u.concat(c).sort((function(t,e){return t.index-e.index})),c=[],!l){if(d>0){d-=1;continue}null!==g&&f.length>0&&(b=this.plugins.table.createCells.call(this,f[0].nodeName,0,!0),b=p.insertBefore(b,f[g]))}}if(l){let t,e;for(let i,l=0,o=h.length;l<o;l++)i=h[l].parentNode,n.removeItem(h[l]),0===i.cells.length&&(t||(t=n.getArrayIndex(r,i)),e=n.getArrayIndex(r,i),n.removeItem(i));for(let i,l=0,o=m.length;l<o;l++)i=m[l],i.cell.rowSpan=n.getOverlapRangeAtIndex(t,e,i.i,i.rs);this.controllersOff()}else this.plugins.table.setPositionControllerDiv.call(this,e||i.tdElement,!0)},closeSplitMenu:null,openSplitMenu:function(){this.util.addClass(this.context.table.splitButton,"on"),this.context.table.splitMenu.style.display="inline-table",this.plugins.table.closeSplitMenu=function(){this.util.removeClass(this.context.table.splitButton,"on"),this.context.table.splitMenu.style.display="none",this.removeDocEvent("click",this.plugins.table.closeSplitMenu),this.plugins.table.closeSplitMenu=null}.bind(this),this.addDocEvent("click",this.plugins.table.closeSplitMenu)},splitCells:function(t){const e=this.util,i="vertical"===t,n=this.context.table,l=n.tdElement,o=n.trElements,s=n.trElement,a=n.logical_cellIndex,r=n.rowIndex,c=this.plugins.table.createCells.call(this,l.nodeName,0,!0);if(i){const t=l.colSpan;if(c.rowSpan=l.rowSpan,t>1)c.colSpan=this._window.Math.floor(t/2),l.colSpan=t-c.colSpan,s.insertBefore(c,l.nextElementSibling);else{let e=[],i=[];for(let s,r,c=0,u=n.rowCnt;c<u;c++){s=o[c].cells,r=0;for(let n,o,u,d,h=0,m=s.length;h<m;h++){if(n=s[h],o=n.colSpan-1,u=n.rowSpan-1,d=h+r,i.length>0)for(let t,e=0;e<i.length;e++)t=i[e],t.row>c||(d>=t.index?(r+=t.cs,d+=t.cs,t.rs-=1,t.row=c+1,t.rs<1&&(i.splice(e,1),e--)):h===m-1&&(t.rs-=1,t.row=c+1,t.rs<1&&(i.splice(e,1),e--)));if(d<=a&&u>0&&e.push({index:d,cs:o+1,rs:u,row:-1}),n!==l&&d<=a&&d+o>=a+t-1){n.colSpan+=1;break}if(d>a)break;r+=o}i=i.concat(e).sort((function(t,e){return t.index-e.index})),e=[]}s.insertBefore(c,l.nextElementSibling)}}else{const t=l.rowSpan;if(c.colSpan=l.colSpan,t>1){c.rowSpan=this._window.Math.floor(t/2);const i=t-c.rowSpan,n=[],r=e.getArrayIndex(o,s)+i;for(let t,e,l=0;l<r;l++){t=o[l].cells,e=0;for(let i,o,s,c=0,u=t.length;c<u&&(s=c+e,!(s>=a));c++)i=t[c],o=i.rowSpan-1,o>0&&o+l>=r&&s<a&&n.push({index:s,cs:i.colSpan}),e+=i.colSpan-1}const u=o[r],d=u.cells;let h=n.shift();for(let t,e,l,o,s=0,m=d.length,p=0;s<m;s++){if(l=s+p,t=d[s],e=t.colSpan-1,o=l+e+1,h&&o>=h.index&&(p+=h.cs,o+=h.cs,h=n.shift()),o>=a||s===m-1){u.insertBefore(c,t.nextElementSibling);break}p+=e}l.rowSpan=i}else{c.rowSpan=l.rowSpan;const t=e.createElement("TR");t.appendChild(c);for(let e,n=0;n<r;n++){if(e=o[n].cells,0===e.length)return;for(let t=0,i=e.length;t<i;t++)n+e[t].rowSpan-1>=r&&(e[t].rowSpan+=1)}const i=n.physical_cellIndex,a=s.cells;for(let e=0,n=a.length;e<n;e++)e!==i&&(a[e].rowSpan+=1);s.parentNode.insertBefore(t,s.nextElementSibling)}}this.focusEdge(l),this.plugins.table.setPositionControllerDiv.call(this,l,!0)},mergeCells:function(){const t=this.plugins.table,e=this.context.table,i=this.util,n=t.ref,l=t.selectedCells,o=l[0];let s=null,a=null;const r=n.ce-n.cs+1;let c=n.re-n.rs+1,u="",d=null;for(let h,m,p=1,g=l.length;p<g;p++){h=l[p],d!==h.parentNode&&(d=h.parentNode),m=h.children;for(let t=0,e=m.length;t<e;t++)i.isFormatElement(m[t])&&i.onlyZeroWidthSpace(m[t].textContent)&&i.removeItem(m[t]);u+=h.innerHTML,i.removeItem(h),0===d.cells.length&&(s?a=d:s=d,c-=1)}if(s){const t=e.trElements,n=i.getArrayIndex(t,s),l=i.getArrayIndex(t,a||s),o=[];for(let e,s=0;s<=l;s++)if(e=t[s].cells,0!==e.length)for(let t,o,a=0,r=e.length;a<r;a++)t=e[a],o=t.rowSpan-1,o>0&&s+o>=n&&(t.rowSpan-=i.getOverlapRangeAtIndex(n,l,s,s+o));else o.push(t[s]);for(let e=0,s=o.length;e<s;e++)i.removeItem(o[e])}o.innerHTML+=u,o.colSpan=r,o.rowSpan=c,this.controllersOff(),t.setActiveButton.call(this,!0,!1),t.call_controller_tableEdit.call(this,o),i.addClass(o,"meta-table-selected-cell"),this.focusEdge(o)},toggleHeader:function(){const t=this.util,e=this.context.table.headerButton,i=t.hasClass(e,"active"),n=this.context.table.element;if(i)t.removeItem(n.querySelector("thead"));else{const e=t.createElement("THEAD");e.innerHTML="<tr>"+this.plugins.table.createCells.call(this,"th",this.context.table.logical_cellCnt,!1)+"</tr>",n.insertBefore(e,n.firstElementChild)}t.toggleClass(e,"active"),/TH/i.test(this.context.table.tdElement.nodeName)?this.controllersOff():this.plugins.table.setPositionControllerDiv.call(this,this.context.table.tdElement,!1)},setTableStyle:function(t){const e=this.context.table,i=e.element;let n,l,o,s;t.indexOf("width")>-1&&(n=e.resizeButton.firstElementChild,l=e.resizeText,e.maxWidth?(o=e.icons.reduction,s=e.minText,e.columnFixedButton.style.display="block",this.util.removeClass(i,"meta-table-size-auto"),this.util.addClass(i,"meta-table-size-100")):(o=e.icons.expansion,s=e.maxText,e.columnFixedButton.style.display="none",this.util.removeClass(i,"meta-table-size-100"),this.util.addClass(i,"meta-table-size-auto")),this.util.changeElement(n,o),this.util.changeTxt(l,s)),t.indexOf("column")>-1&&(e.fixedColumn?(this.util.removeClass(i,"meta-table-layout-auto"),this.util.addClass(i,"meta-table-layout-fixed"),this.util.addClass(e.columnFixedButton,"active")):(this.util.removeClass(i,"meta-table-layout-fixed"),this.util.addClass(i,"meta-table-layout-auto"),this.util.removeClass(e.columnFixedButton,"active")))},setActiveButton:function(t,e){const i=this.context.table;/^TH$/i.test(t.nodeName)?(i.insertRowAboveButton.setAttribute("disabled",!0),i.insertRowBelowButton.setAttribute("disabled",!0)):(i.insertRowAboveButton.removeAttribute("disabled"),i.insertRowBelowButton.removeAttribute("disabled")),e&&t!==e?(i.splitButton.setAttribute("disabled",!0),i.mergeButton.removeAttribute("disabled")):(i.splitButton.removeAttribute("disabled"),i.mergeButton.setAttribute("disabled",!0))},bindOnSelect:null,bindOffSelect:null,bindOffShift:null,selectedCells:null,shift:!1,fixedCell:null,fixedCellName:null,selectedCell:null,selectedTable:null,ref:null,toggleEditor:function(t){this.context.element.wysiwyg.setAttribute("contenteditable",t),t?this.util.removeClass(this.context.element.wysiwyg,"meta-disabled"):this.util.addClass(this.context.element.wysiwyg,"meta-disabled")},offCellMultiSelect:function(t){t.stopPropagation();const e=this.plugins.table;e.shift?e.initBind&&(this._iframeDocument.removeEventListener("touchmove",e.initBind),e.initBind=null):(e.removeEvents.call(this),e.toggleEditor.call(this,!0)),e.fixedCell&&e.selectedTable&&(e.setActiveButton.call(this,e.fixedCell,e.selectedCell),e.call_controller_tableEdit.call(this,e.selectedCell||e.fixedCell),e.selectedCells=e.selectedTable.querySelectorAll(".meta-table-selected-cell"),e.selectedCell&&e.fixedCell&&this.focusEdge(e.selectedCell),e.shift||(e.fixedCell=null,e.selectedCell=null,e.fixedCellName=null))},onCellMultiSelect(t){this.antiBlur=!0;const e=this.plugins.table,i=this.util.getParentElement(t.target,this.util.isCell);if(e.shift)i===e.fixedCell?e.toggleEditor.call(this,!0):e.toggleEditor.call(this,!1);else if(!e.ref){if(i===e.fixedCell)return;e.toggleEditor.call(this,!1)}i&&i!==e.selectedCell&&e.fixedCellName===i.nodeName&&e.selectedTable===this.util.getParentElement(i,"TABLE")&&(e.selectedCell=i,e.setMultiCells.call(this,e.fixedCell,i))},setMultiCells:function(t,e){const i=this.plugins.table,n=i.selectedTable.rows,l=this.util,o=i.selectedTable.querySelectorAll(".meta-table-selected-cell");for(let u=0,d=o.length;u<d;u++)l.removeClass(o[u],"meta-table-selected-cell");if(t===e&&(l.addClass(t,"meta-table-selected-cell"),!i.shift))return;let s=!0,a=[],r=[];const c=i.ref={_i:0,cs:null,ce:null,rs:null,re:null};for(let u,d,h=0,m=n.length;h<m;h++){u=n[h].cells,d=0;for(let i,n,o,m,p=0,g=u.length;p<g;p++){if(i=u[p],o=i.colSpan-1,m=i.rowSpan-1,n=p+d,a.length>0)for(let t,e=0;e<a.length;e++)t=a[e],t.row>h||(n>=t.index?(d+=t.cs,n+=t.cs,t.rs-=1,t.row=h+1,t.rs<1&&(a.splice(e,1),e--)):p===g-1&&(t.rs-=1,t.row=h+1,t.rs<1&&(a.splice(e,1),e--)));if(s){if(i!==t&&i!==e||(c.cs=null!==c.cs&&c.cs<n?c.cs:n,c.ce=null!==c.ce&&c.ce>n+o?c.ce:n+o,c.rs=null!==c.rs&&c.rs<h?c.rs:h,c.re=null!==c.re&&c.re>h+m?c.re:h+m,c._i+=1),2===c._i){s=!1,a=[],r=[],h=-1;break}}else if(l.getOverlapRangeAtIndex(c.cs,c.ce,n,n+o)&&l.getOverlapRangeAtIndex(c.rs,c.re,h,h+m)){const t=c.cs<n?c.cs:n,e=c.ce>n+o?c.ce:n+o,s=c.rs<h?c.rs:h,u=c.re>h+m?c.re:h+m;if(c.cs!==t||c.ce!==e||c.rs!==s||c.re!==u){c.cs=t,c.ce=e,c.rs=s,c.re=u,h=-1,a=[],r=[];break}l.addClass(i,"meta-table-selected-cell")}m>0&&r.push({index:n,cs:o+1,rs:m,row:-1}),d+=i.colSpan-1}a=a.concat(r).sort((function(t,e){return t.index-e.index})),r=[]}},removeEvents:function(){const t=this.plugins.table;t.initBind&&(this._iframeDocument.removeEventListener("touchmove",t.initBind),t.initBind=null),t.bindOnSelect&&(this._iframeDocument.removeEventListener("mousedown",t.bindOnSelect),this._iframeDocument.removeEventListener("mousemove",t.bindOnSelect),t.bindOnSelect=null),t.bindOffSelect&&(this._iframeDocument.removeEventListener("mouseup",t.bindOffSelect),t.bindOffSelect=null),t.bindOffShift&&(this._iframeDocument.removeEventListener("keyup",t.bindOffShift),t.bindOffShift=null)},initBind:null,onTableCellMultiSelect:function(t,e){const i=this.plugins.table;i.removeEvents.call(this),this.controllersOff(),i.shift=e,i.fixedCell=t,i.fixedCellName=t.nodeName,i.selectedTable=this.util.getParentElement(t,"TABLE");const n=i.selectedTable.querySelectorAll(".meta-table-selected-cell");for(let l=0,o=n.length;l<o;l++)this.util.removeClass(n[l],"meta-table-selected-cell");this.util.addClass(t,"meta-table-selected-cell"),i.bindOnSelect=i.onCellMultiSelect.bind(this),i.bindOffSelect=i.offCellMultiSelect.bind(this),e?(i.bindOffShift=function(){this.controllersOn(this.context.table.resizeDiv,this.context.table.tableController,this.plugins.table.init.bind(this),t,"table"),i.ref||this.controllersOff()}.bind(this),this._iframeDocument.addEventListener("keyup",i.bindOffShift,!1),this._iframeDocument.addEventListener("mousedown",i.bindOnSelect,!1)):this._iframeDocument.addEventListener("mousemove",i.bindOnSelect,!1),this._iframeDocument.addEventListener("mouseup",i.bindOffSelect,!1),i.initBind=i.init.bind(this),this._iframeDocument.addEventListener("touchmove",i.initBind,!1)},onClick_tableController:function(t){t.stopPropagation();const e=t.target.getAttribute("data-command")?t.target:t.target.parentNode;if(e.getAttribute("disabled"))return;const i=e.getAttribute("data-command"),n=e.getAttribute("data-value"),l=e.getAttribute("data-option"),o=this.plugins.table;if("function"===typeof o.closeSplitMenu&&(o.closeSplitMenu(),"onsplit"===i))return;if(!i)return;t.preventDefault();const s=this.context.table;switch(i){case"insert":case"delete":o.editTable.call(this,n,l);break;case"header":o.toggleHeader.call(this);break;case"onsplit":o.openSplitMenu.call(this);break;case"split":o.splitCells.call(this,n);break;case"merge":o.mergeCells.call(this);break;case"resize":s.maxWidth=!s.maxWidth,o.setTableStyle.call(this,"width"),o.setPositionControllerTop.call(this,s.element),o.setPositionControllerDiv.call(this,s.tdElement,o.shift);break;case"layout":s.fixedColumn=!s.fixedColumn,o.setTableStyle.call(this,"column"),o.setPositionControllerTop.call(this,s.element),o.setPositionControllerDiv.call(this,s.tdElement,o.shift);break;case"remove":const t=s.element.parentNode;this.util.removeItem(s.element),this.controllersOff(),t!==this.context.element.wysiwyg&&this.util.removeItemAllParents(t,(function(t){return 0===t.childNodes.length}),null),this.focus()}this.history.push(!1)}},a={name:"template",display:"submenu",add:function(t,e){t.context.template={};let i=this.setSubmenu(t);i.querySelector("ul").addEventListener("click",this.pickup.bind(t)),t.initMenuTarget(this.name,e,i),i=null},setSubmenu:function(t){const e=t.options.templates;if(!e||0===e.length)throw Error('[ExploreEditor.plugins.template.fail] To use the "template" plugin, please define the "templates" option.');const i=t.util.createElement("DIV");i.className="meta-list-layer";let n='<div class="meta-submenu meta-list-inner"><ul class="meta-list-basic">';for(let l,o=0,s=e.length;o<s;o++)l=e[o],n+='<li><button type="button" class="meta-btn-list" data-value="'+o+'" title="'+l.name+'">'+l.name+"</button></li>";return n+="</ul></div>",i.innerHTML=n,i},pickup:function(t){if(!/^BUTTON$/i.test(t.target.tagName))return!1;t.preventDefault(),t.stopPropagation();const e=this.options.templates[t.target.getAttribute("data-value")];if(!e.html)throw this.submenuOff(),Error('[ExploreEditor.template.fail] cause : "templates[i].html not found"');this.setContents(e.html),this.submenuOff()}};const r={_window:window,_document:window.document,isIE:navigator.userAgent.indexOf("Trident")>-1,isIE_Edge:navigator.userAgent.indexOf("Trident")>-1||navigator.appVersion.indexOf("Edge")>-1,isOSX_IOS:/(Mac|iPhone|iPod|iPad)/.test(navigator.platform),allowedEmptyNodeList:".meta-component, pre, blockquote, hr, li, table, img, iframe, video, audio, canvas",typeOf:function(t){return{"[object String]":"string","[object Number]":"number","[object Boolean]":"boolean","[object Array]":"array","[object Object]":"object","[object Function]":"function","[object Undefined]":"undefined","[object Null]":"null","[object Date]":"date","[object Symbol]":"symbol","[object RegExp]":"regExp","[object Error]":"error","[object HTMLDocument]":"document","[object Window]":"window"}[Object.prototype.toString.call(t)]},getXMLHttpRequest:function(){if(!this._window.ActiveXObject)return this._window.XMLHttpRequest?new XMLHttpRequest:null;try{return new this._window.ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{return new this._window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){return null}}},createElement:function(t){return this._document.createElement(t)},createTextNode:function(t){return this._document.createTextNode(t||"")},HTMLEncoder:function(t){const e={"<":"$lt;",">":"$gt;"};return t.replace(/<|>/g,(function(t){return"string"===typeof e[t]?e[t]:t}))},HTMLDecoder:function(t){const e={"$lt;":"<","$gt;":">"};return t.replace(/\$lt;|\$gt;/g,(function(t){return"string"===typeof e[t]?e[t]:t}))},HTMLConvertor:function(t){const e={"&":"&amp;","\xa0":"&nbsp;","'":"&apos;",'"':"&quot;","<":"&lt;",">":"&gt;"};return t.replace(/&|\u00A0|'|"|<|>/g,(function(t){return"string"===typeof e[t]?e[t]:t}))},zeroWidthSpace:String.fromCharCode(8203),zeroWidthRegExp:new RegExp(String.fromCharCode(8203),"g"),onlyZeroWidthRegExp:new RegExp("^"+String.fromCharCode(8203)+"+$"),onlyZeroWidthSpace:function(t){return"string"!==typeof t&&(t=t.textContent),""===t||this.onlyZeroWidthRegExp.test(t)},hasOwn:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},getIncludePath:function(t,e){let i="";const n=[],l="js"===e?"script":"link",o="js"===e?"src":"href";let s="(:";for(let c=0,u=t.length;c<u;c++)s+=t[c]+(c<u-1?"|":")");const a=new this._window.RegExp("(^|.*[\\/])"+s+"(\\.[^\\/]+)?."+e+"(:\\?.*|;.*)?$","i"),r=new this._window.RegExp(".+\\."+e+"(:\\?.*|;.*)?$","i");for(let c=this._document.getElementsByTagName(l),u=0;u<c.length;u++)r.test(c[u][o])&&n.push(c[u]);for(let c=0;c<n.length;c++){let t=n[c][o].match(a);if(t){i=t[0];break}}if(""===i&&(i=n.length>0?n[0][o]:""),-1===i.indexOf(":/")&&"//"!==i.slice(0,2)&&(i=0===i.indexOf("/")?location.href.match(/^.*:\/\/[^\/]*/)[0]+i:location.href.match(/^[^\?]*\/(:)/)[0]+i),!i)throw"[ExploreEditor.util.getIncludePath.fail] The ExploreEditor installation path could not be automatically detected. (name: +"+name+", extension: "+e+")";return i},getPageStyle:function(t){let e="";const i=(t||this._document).styleSheets;for(let l,o=0,s=i.length;o<s;o++){try{l=i[o].cssRules}catch(n){continue}if(l)for(let t=0,i=l.length;t<i;t++)e+=l[t].cssText}return e},getIframeDocument:function(t){let e=t.contentWindow||t.contentDocument;return e.document&&(e=e.document),e},getAttributesToString:function(t,e){if(!t.attributes)return"";const i=t.attributes;let n="";for(let l=0,o=i.length;l<o;l++)e&&e.indexOf(i[l].name)>-1||(n+=i[l].name+'="'+i[l].value+'" ');return n},getByteLength:function(t){if(!t||!t.toString)return 0;t=t.toString();const e=this._window.encodeURIComponent;let i,n;return this.isIE_Edge?(n=this._window.unescape(e(t)).length,i=0,null!==e(t).match(/(%0A|%0D)/gi)&&(i=e(t).match(/(%0A|%0D)/gi).length),n+i):(n=new this._window.TextEncoder("utf-8").encode(t).length,i=0,null!==e(t).match(/(%0A|%0D)/gi)&&(i=e(t).match(/(%0A|%0D)/gi).length),n+i)},isWysiwygDiv:function(t){return t&&1===t.nodeType&&(this.hasClass(t,"meta-wrapper-wysiwyg")||/^BODY$/i.test(t.nodeName))},isNonEditable:function(t){return t&&1===t.nodeType&&"false"===t.getAttribute("contenteditable")},isTextStyleElement:function(t){return t&&3!==t.nodeType&&/^(strong|span|font|b|var|i|em|u|ins|s|strike|del|sub|sup|mark|a|label|code)$/i.test(t.nodeName)},isFormatElement:function(t){return t&&1===t.nodeType&&(/^(P|DIV|H[1-6]|PRE|LI|TH|TD)$/i.test(t.nodeName)||this.hasClass(t,"(\\s|^)__meta__format__replace_.+(\\s|$)|(\\s|^)__meta__format__free_.+(\\s|$)"))&&!this.isComponent(t)&&!this.isWysiwygDiv(t)},isRangeFormatElement:function(t){return t&&1===t.nodeType&&(/^(BLOCKQUOTE|OL|UL|FIGCAPTION|TABLE|THEAD|TBODY|TR|TH|TD)$/i.test(t.nodeName)||this.hasClass(t,"(\\s|^)__meta__format__range_.+(\\s|$)"))},isClosureRangeFormatElement:function(t){return t&&1===t.nodeType&&(/^(TH|TD)$/i.test(t.nodeName)||this.hasClass(t,"(\\s|^)__meta__format__range__closure_.+(\\s|$)"))},isFreeFormatElement:function(t){return t&&1===t.nodeType&&(/^PRE$/i.test(t.nodeName)||this.hasClass(t,"(\\s|^)__meta__format__free_.+(\\s|$)"))&&!this.isComponent(t)&&!this.isWysiwygDiv(t)},isClosureFreeFormatElement:function(t){return t&&1===t.nodeType&&this.hasClass(t,"(\\s|^)__meta__format__free__closure_.+(\\s|$)")},isComponent:function(t){return t&&(/meta-component/.test(t.className)||/^(TABLE|HR)$/.test(t.nodeName))},isUneditableComponent:function(t){return t&&this.hasClass(t,"__meta__uneditable")},isMediaComponent:function(t){return t&&/meta-component/.test(t.className)},isNotCheckingNode:function(t){return t&&/katex|__meta__tag/.test(t.className)},getFormatElement:function(t,e){if(!t)return null;for(e||(e=function(){return!0});t;){if(this.isWysiwygDiv(t))return null;if(this.isRangeFormatElement(t)&&t.firstElementChild,this.isFormatElement(t)&&e(t))return t;t=t.parentNode}return null},getRangeFormatElement:function(t,e){if(!t)return null;for(e||(e=function(){return!0});t;){if(this.isWysiwygDiv(t))return null;if(this.isRangeFormatElement(t)&&!/^(THEAD|TBODY|TR)$/i.test(t.nodeName)&&e(t))return t;t=t.parentNode}return null},getFreeFormatElement:function(t,e){if(!t)return null;for(e||(e=function(){return!0});t;){if(this.isWysiwygDiv(t))return null;if(this.isFreeFormatElement(t)&&e(t))return t;t=t.parentNode}return null},getClosureFreeFormatElement:function(t,e){if(!t)return null;for(e||(e=function(){return!0});t;){if(this.isWysiwygDiv(t))return null;if(this.isClosureFreeFormatElement(t)&&e(t))return t;t=t.parentNode}return null},copyTagAttributes:function(t,e){e.style.cssText&&(t.style.cssText+=e.style.cssText);const i=e.classList;for(let n=0,l=i.length;n<l;n++)this.addClass(t,i[n]);t.style.cssText||t.removeAttribute("style"),t.className.trim()||t.removeAttribute("class")},copyFormatAttributes:function(t,e){(e=e.cloneNode(!1)).className=e.className.replace(/(\s|^)__meta__format__[^\s]+/g,""),this.copyTagAttributes(t,e)},getArrayItem:function(t,e,i){if(!t||0===t.length)return null;e=e||function(){return!0};const n=[];for(let l,o=0,s=t.length;o<s;o++)if(l=t[o],e(l)){if(!i)return l;n.push(l)}return i?n:null},getArrayIndex:function(t,e){let i=-1;for(let n=0,l=t.length;n<l;n++)if(t[n]===e){i=n;break}return i},nextIdx:function(t,e){let i=this.getArrayIndex(t,e);return-1===i?-1:i+1},prevIdx:function(t,e){let i=this.getArrayIndex(t,e);return-1===i?-1:i-1},getPositionIndex:function(t){let e=0;for(;t=t.previousSibling;)e+=1;return e},getNodePath:function(t,e,i){const n=[];let l=!0;return this.getParentElement(t,function(t){if(t===e&&(l=!1),l&&!this.isWysiwygDiv(t)){if(i&&3===t.nodeType){let e=null,n=null;i.s=i.e=0;let l=t.previousSibling;for(;l&&3===l.nodeType;)n=l.textContent.replace(this.zeroWidthRegExp,""),i.s+=n.length,t.textContent=n+t.textContent,e=l,l=l.previousSibling,this.removeItem(e);let o=t.nextSibling;for(;o&&3===o.nodeType;)n=o.textContent.replace(this.zeroWidthRegExp,""),i.e+=n.length,t.textContent+=n,e=o,o=o.nextSibling,this.removeItem(e)}n.push(t)}return!1}.bind(this)),n.map((t=>this.getPositionIndex(t))).reverse()},getNodeFromPath:function(t,e){let i,n=e;for(let l=0,o=t.length;l<o&&(i=n.childNodes,0!==i.length);l++)n=i.length<=t[l]?i[i.length-1]:i[t[l]];return n},isSameAttributes:function(t,e){if(3===t.nodeType&&3===e.nodeType)return!0;if(3===t.nodeType||3===e.nodeType)return!1;const i=t.style,n=e.style;let l=0;for(let c=0,u=i.length;c<u;c++)i[i[c]]===n[i[c]]&&l++;const o=t.classList,s=e.classList,a=this._window.RegExp;let r=0;for(let c=0,u=o.length;c<u;c++)a("(s|^)"+o[c]+"(s|$)").test(s.value)&&r++;return l===n.length&&l===i.length&&r===s.length&&r===o.length},isEmptyLine:function(t){return!t||!t.parentNode||!t.querySelector("IMG, IFRAME, AUDIO, VIDEO, CANVAS, TABLE")&&this.onlyZeroWidthSpace(t.textContent)},isList:function(t){return t&&/^(OL|UL)$/i.test("string"===typeof t?t:t.nodeName)},isListCell:function(t){return t&&/^LI$/i.test("string"===typeof t?t:t.nodeName)},isTable:function(t){return t&&/^(TABLE|THEAD|TBODY|TR|TH|TD)$/i.test("string"===typeof t?t:t.nodeName)},isCell:function(t){return t&&/^(TD|TH)$/i.test("string"===typeof t?t:t.nodeName)},isBreak:function(t){return t&&/^BR$/i.test("string"===typeof t?t:t.nodeName)},isAnchor:function(t){return t&&/^A$/i.test("string"===typeof t?t:t.nodeName)},isMedia:function(t){return t&&/^(IMG|IFRAME|AUDIO|VIDEO|CANVAS)$/i.test("string"===typeof t?t:t.nodeName)},isNumber:function(t){return!!t&&/^-?\d+(\.\d+)?$/.test(t+"")},getNumber:function(t,e){if(!t)return 0;let i=(t+"").match(/-?\d+(\.\d+)?/);if(!i||!i[0])return 0;let n=Number(i[0]);return e<0?1*n:0===e?this._window.Math.round(1*n):(1*n).toFixed(e)},getListChildren:function(t,e){const i=[];return t&&t.children&&0!==t.children.length?(e=e||function(){return!0},function n(l){if(t!==l&&e(l)&&i.push(l),l.children)for(let t=0,e=l.children.length;t<e;t++)n(l.children[t])}(t),i):i},getListChildNodes:function(t,e){const i=[];return t&&0!==t.childNodes.length?(e=e||function(){return!0},function n(l){t!==l&&e(l)&&i.push(l);for(let t=0,e=l.childNodes.length;t<e;t++)n(l.childNodes[t])}(t),i):i},getElementDepth:function(t){if(!t||this.isWysiwygDiv(t))return-1;let e=0;for(t=t.parentNode;t&&!this.isWysiwygDiv(t);)e+=1,t=t.parentNode;return e},compareElements:function(t,e){let i=t,n=e;for(;i&&n&&i.parentNode!==n.parentNode;)i=i.parentNode,n=n.parentNode;if(!i||!n)return{ancestor:null,a:t,b:e,result:0};const l=i.parentNode.childNodes,o=this.getArrayIndex(l,i),s=this.getArrayIndex(l,n);return{ancestor:i.parentNode,a:i,b:n,result:o>s?1:o<s?-1:0}},getParentElement:function(t,e){let i;if("function"===typeof e)i=e;else{let t;/^\./.test(e)?(t="className",e=e.split(".")[1]):/^#/.test(e)?(t="id",e="^"+e.split("#")[1]+"$"):/^:/.test(e)?(t="name",e="^"+e.split(":")[1]+"$"):(t="nodeName",e="^"+e+"$");const n=new this._window.RegExp(e,"i");i=function(e){return n.test(e[t])}}for(;t&&!i(t);){if(this.isWysiwygDiv(t))return null;t=t.parentNode}return t},getChildElement:function(t,e,i){let n;if("function"===typeof e)n=e;else{let t;/^\./.test(e)?(t="className",e=e.split(".")[1]):/^#/.test(e)?(t="id",e="^"+e.split("#")[1]+"$"):/^:/.test(e)?(t="name",e="^"+e.split(":")[1]+"$"):(t="nodeName",e="^"+("text"===e?"#"+e:e)+"$");const i=new this._window.RegExp(e,"i");n=function(e){return i.test(e[t])}}const l=this.getListChildNodes(t,(function(t){return n(t)}));return l[i?l.length-1:0]},getEdgeChildNodes:function(t,e){if(t){for(e||(e=t);t&&1===t.nodeType&&t.childNodes.length>0&&!this.isBreak(t);)t=t.firstChild;for(;e&&1===e.nodeType&&e.childNodes.length>0&&!this.isBreak(e);)e=e.lastChild;return{sc:t,ec:e||t}}},getOffset:function(t,e){let i=0,n=0,l=3===t.nodeType?t.parentElement:t;const o=this.getParentElement(t,this.isWysiwygDiv.bind(this));for(;l&&!this.hasClass(l,"meta-container")&&l!==o;)i+=l.offsetLeft,n+=l.offsetTop,l=l.offsetParent;const s=e&&/iframe/i.test(e.nodeName);return{left:i+(s?e.parentElement.offsetLeft:0),top:n-(o?o.scrollTop:0)+(s?e.parentElement.offsetTop:0)}},getOverlapRangeAtIndex:function(t,e,i,n){if(t<=n?e<i:e>i)return 0;const l=(t>i?t:i)-(e<n?e:n);return(l<0?-1*l:l)+1},changeTxt:function(t,e){t&&e&&(t.textContent=e)},changeElement:function(t,e){if("string"===typeof e)if(t.outerHTML)t.outerHTML=e;else{const i=this.createElement("DIV");i.innerHTML=e,t.parentNode.replaceChild(i.firstChild,t)}else 1===e.nodeType&&t.parentNode.replaceChild(e,t)},setStyle:function(t,e,i){t.style[e]=i,i||t.style.cssText||t.removeAttribute("style")},hasClass:function(t,e){if(t)return new this._window.RegExp(e).test(t.className)},addClass:function(t,e){if(!t)return;new this._window.RegExp("(\\s|^)"+e+"(\\s|$)").test(t.className)||(t.className+=(t.className.length>0?" ":"")+e)},removeClass:function(t,e){if(!t)return;const i=new this._window.RegExp("(\\s|^)"+e+"(\\s|$)");t.className=t.className.replace(i," ").trim(),t.className.trim()||t.removeAttribute("class")},toggleClass:function(t,e){if(!t)return;let i=!1;const n=new this._window.RegExp("(\\s|^)"+e+"(\\s|$)");return n.test(t.className)?t.className=t.className.replace(n," ").trim():(t.className+=" "+e,i=!0),t.className.trim()||t.removeAttribute("class"),i},setDisabledButtons:function(t,e){for(let i=0,n=e.length;i<n;i++)e[i].disabled=t},removeItem:function(t){t&&("function"===typeof t.remove?t.remove():t.parentNode&&t.parentNode.removeChild(t))},removeItemAllParents:function(t,e,i){if(!t)return null;let n=null;return e||(e=function(t){if(t===i||this.isComponent(t))return!1;const e=t.textContent.trim();return 0===e.length||/^(\n|\u200B)+$/.test(e)}.bind(this)),function t(i){if(!r.isWysiwygDiv(i)){const l=i.parentNode;l&&e(i)&&(n={sc:i.previousElementSibling,ec:i.nextElementSibling},r.removeItem(i),t(l))}}(t),n},detachNestedList:function(t,e){const i=this.deleteNestedList(t);let n,l,o;if(i){n=i.cloneNode(!1),l=i.childNodes;const e=this.getPositionIndex(t);for(;l[e];)n.appendChild(l[e])}else n=t;if(e)o=this.getListChildren(n,function(t){return this.isListCell(t)&&!t.previousElementSibling}.bind(this));else{const e=this.getElementDepth(t)+2;o=this.getListChildren(t,function(t){return this.isListCell(t)&&!t.previousElementSibling&&this.getElementDepth(t)===e}.bind(this))}for(let s=0,a=o.length;s<a;s++)this.deleteNestedList(o[s]);return i&&(i.parentNode.insertBefore(n,i.nextSibling),l&&0===l.length&&this.removeItem(i)),n===t?n.parentNode:n},deleteNestedList:function(t){const e=t.parentNode;let i,n,l,o,s,a=e,r=a.parentNode;for(;this.isListCell(r);){for(o=this.getPositionIndex(t),i=r.nextElementSibling,n=r.parentNode,l=a;l;){if(a=a.nextSibling,this.isList(l)){for(s=l.childNodes;s[o];)n.insertBefore(s[o],i);0===s.length&&this.removeItem(l)}else n.appendChild(l);l=a}a=n,r=n.parentNode}return 0===e.children.length&&this.removeItem(e),n},splitElement:function(t,e,i){const n=t.parentNode;let l,o,s,a=0,c=!0;if((!i||i<0)&&(i=0),3===t.nodeType){if(a=this.getPositionIndex(t),e>=0){t.splitText(e);const i=this.getNodeFromPath([a+1],n);this.onlyZeroWidthSpace(i)&&(i.data=this.zeroWidthSpace)}}else 1===t.nodeType&&(t.previousSibling?t=t.previousSibling:this.getElementDepth(t)===i&&(c=!1));let u=t;for(;this.getElementDepth(u)>i;)for(a=this.getPositionIndex(u)+1,u=u.parentNode,s=l,l=u.cloneNode(!1),o=u.childNodes,s&&(this.isListCell(l)&&this.isList(s)&&s.firstElementChild?(l.innerHTML=s.firstElementChild.innerHTML,r.removeItem(s.firstElementChild),s.children.length>0&&l.appendChild(s)):l.appendChild(s));o[a];)l.appendChild(o[a]);u.childNodes.length<=1&&(!u.firstChild||0===u.firstChild.textContent.length)&&(u.innerHTML="<br>");const d=u.parentNode;return c&&(u=u.nextSibling),l?(this.mergeSameTags(l,null,!1),this.mergeNestedTags(l,function(t){return this.isList(t)}.bind(this)),l.childNodes.length>0?d.insertBefore(l,u):l=u,0===n.childNodes.length&&this.removeItem(n),l):u},mergeSameTags:function(t,e,i){const n=this,l=e?e.length:0;let o=null;return l&&(o=n._window.Array.apply(null,new n._window.Array(l)).map(n._window.Number.prototype.valueOf,0)),function t(s,a,r){const c=s.childNodes;for(let u,d,h=0,m=c.length;h<m&&(u=c[h],d=c[h+1],u);h++)if(i&&n.isIgnoreNodeChange(u)||!i&&(n.isTable(u)||n.isListCell(u)||n.isFormatElement(u)&&!n.isFreeFormatElement(u)))(n.isTable(u)||n.isListCell(u))&&t(u,a+1,h);else{if(1===m&&s.nodeName===u.nodeName&&s.parentNode){if(l){let t,i,o,r,c;for(let d=0;d<l;d++)if(t=e[d],t&&t[a]===h){for(i=u,o=s,r=a,c=!0;r>=0;){if(n.getArrayIndex(o.childNodes,i)!==t[r]){c=!1;break}i=u.parentNode,o=i.parentNode,r--}c&&(t.splice(a,1),t[a]=h)}}n.copyTagAttributes(u,s),s.parentNode.insertBefore(u,s),n.removeItem(s)}if(!d){1===u.nodeType&&t(u,a+1,h);break}if(u.nodeName===d.nodeName&&n.isSameAttributes(u,d)&&u.href===d.href){const t=u.childNodes;let i=0;for(let e=0,n=t.length;e<n;e++)t[e].textContent.length>0&&i++;const s=u.lastChild,c=d.firstChild;let m=0;if(s&&c){const t=3===s.nodeType&&3===c.nodeType;m=s.textContent.length;let n=s.previousSibling;for(;n&&3===n.nodeType;)m+=n.textContent.length,n=n.previousSibling;if(i>0&&3===s.nodeType&&3===c.nodeType&&(s.textContent.length>0||c.textContent.length>0)&&i--,l){let n=null;for(let u=0;u<l;u++)if(n=e[u],n&&n[a]>h){if(a>0&&n[a-1]!==r)continue;n[a]-=1,n[a+1]>=0&&n[a]===h&&(n[a+1]+=i,t&&s&&3===s.nodeType&&c&&3===c.nodeType&&(o[u]+=m))}}}if(3===u.nodeType){if(m=u.textContent.length,u.textContent+=d.textContent,l){let t=null;for(let n=0;n<l;n++)if(t=e[n],t&&t[a]>h){if(a>0&&t[a-1]!==r)continue;t[a]-=1,t[a+1]>=0&&t[a]===h&&(t[a+1]+=i,o[n]+=m)}}}else u.innerHTML+=d.innerHTML;n.removeItem(d),h--}else 1===u.nodeType&&t(u,a+1,h)}}(t,0,0),o},mergeNestedTags:function(t,e){"string"===typeof e?e=function(t){return this.test(t.tagName)}.bind(new this._window.RegExp("^("+(e||".+")+")$","i")):"function"!==typeof e&&(e=function(){return!0}),function t(i){let n=i.children,l="function"!==typeof e||e(i);if(1===n.length&&n[0].nodeName===i.nodeName&&l){const t=n[0];for(n=t.children;n[0];)i.appendChild(n[0]);i.removeChild(t)}for(let e=0,o=i.children.length;e<o;e++)t(i.children[e])}(t)},removeEmptyNode:function(t,e){const i=this;e&&(e=i.getParentElement(e,(function(e){return t===e.parentElement}))),function n(l){if(i.notTextNode(l)||l===e||i.isNonEditable(l))return 0;if(l===t||!i.onlyZeroWidthSpace(l.textContent)||l.firstChild&&i.isBreak(l.firstChild)||l.querySelector(i.allowedEmptyNodeList)){const t=l.children;for(let e=0,l=t.length,o=0;e<l;e++)t[e+o]&&!i.isComponent(t[e+o])&&(o+=n(t[e+o]))}else if(l.parentNode)return l.parentNode.removeChild(l),-1;return 0}(t),0===t.childNodes.length&&(t.innerHTML="<br>")},htmlRemoveWhiteSpace:function(t){return t?t.trim().replace(/<\/?(?!strong|span|font|b|var|i|em|u|ins|s|strike|del|sub|sup|mark|a|label|code)[^>^<]+>\s+(?=<)/gi,(function(t){return t.trim()})):""},sortByDepth:function(t,e){const i=e?1:-1,n=-1*i;t.sort(function(t,e){return this.isListCell(t)&&this.isListCell(e)?(t=this.getElementDepth(t))>(e=this.getElementDepth(e))?i:t<e?n:0:0}.bind(this))},isIgnoreNodeChange:function(t){return t&&3!==t.nodeType&&(this.isNonEditable(t)||!this.isTextStyleElement(t))},isMaintainedNode:function(t){return t&&3!==t.nodeType&&/^(a|label|code)$/i.test("string"===typeof t?t:t.nodeName)},isSizeNode:function(t){return t&&3!==t.nodeType&&this.isTextStyleElement(t)&&!!t.style.fontSize},notTextNode:function(t){return t&&3!==t.nodeType&&(this.isComponent(t)||/^(br|input|select|canvas|img|iframe|audio|video)$/i.test("string"===typeof t?t:t.nodeName))},disallowedTags:function(t){return/^(meta|script|link|style|[a-z]+\:[a-z]+)$/i.test(t.nodeName)},createTagsWhitelist:function(t){return new RegExp("<\\/?\\b(?!\\b"+t.replace(/\|/g,"\\b|\\b")+"\\b)[^>]*>","gi")},consistencyCheckOfHTML:function(t,e){const i=[],n=[],l=[],o=[],s=this.getListChildNodes(t,function(s){if(1!==s.nodeType)return!1;if(!e.test(s.nodeName)&&0===s.childNodes.length&&this.isNotCheckingNode(s))return i.push(s),!1;const a=!this.getParentElement(s,this.isNotCheckingNode);if(!this.isTable(s)&&!this.isListCell(s)&&(this.isFormatElement(s)||this.isRangeFormatElement(s)||this.isTextStyleElement(s))&&0===s.childNodes.length&&a)return n.push(s),!1;if(this.isList(s.parentNode)&&!this.isList(s)&&!this.isListCell(s))return l.push(s),!1;if(this.isCell(s)){const t=s.firstElementChild;if(!this.isFormatElement(t)&&!this.isRangeFormatElement(t)&&!this.isComponent(t))return o.push(s),!1}return s.parentNode!==t&&(this.isFormatElement(s)||this.isComponent(s)||this.isList(s))&&!this.isRangeFormatElement(s.parentNode)&&!this.isListCell(s.parentNode)&&!this.getParentElement(s,this.isComponent)&&a}.bind(this));for(let r=0,c=i.length;r<c;r++)this.removeItem(i[r]);const a=[];for(let r,c,u=0,d=s.length;u<d;u++)r=s[u],c=r.parentNode,c&&c.parentNode&&(c.parentNode.insertBefore(r,c),a.push(c));for(let r,c=0,u=a.length;c<u;c++)r=a[c],this.onlyZeroWidthSpace(r.textContent.trim())&&this.removeItem(r);for(let r=0,c=n.length;r<c;r++)this.removeItem(n[r]);for(let r,c,u,d,h=0,m=l.length;h<m;h++){for(r=l[h],c=this.createElement("LI"),u=r.childNodes;u[0];)c.appendChild(u[0]);d=r.parentNode,d&&(d.insertBefore(c,r),this.removeItem(r))}for(let r,c,u=0,d=o.length;u<d;u++)r=o[u],c=this.createElement("DIV"),c.innerHTML=0===r.textContent.trim().length&&0===r.children.length?"<br>":r.innerHTML,r.innerHTML=c.outerHTML},setDefaultOptionStyle:function(t,e){let i="";t.height&&(i+="height:"+t.height+";"),t.minHeight&&(i+="min-height:"+t.minHeight+";"),t.maxHeight&&(i+="max-height:"+t.maxHeight+";"),t.position&&(i+="position:"+t.position+";"),t.width&&(i+="width:"+t.width+";"),t.minWidth&&(i+="min-width:"+t.minWidth+";"),t.maxWidth&&(i+="max-width:"+t.maxWidth+";");let n="",l="",o="";const s=(e=i+e).split(";");for(let a,r=0,c=s.length;r<c;r++)a=s[r].trim(),a&&(/^(min-|max-)?width\s*:/.test(a)||/^(z-index|position)\s*:/.test(a)?n+=a+";":/^(min-|max-)?height\s*:/.test(a)?(/^height/.test(a)&&"auto"===a.split(":")[1].trim()&&(t.height="auto"),l+=a+";"):o+=a+";");return{top:n,frame:l,editor:o}},setIframeDocument:function(t,e){t.setAttribute("scrolling","auto"),t.contentDocument.head.innerHTML='<meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1">'+this.setIframeCssTags(e),t.contentDocument.body.className=e.editableClass,t.contentDocument.body.setAttribute("contenteditable",!0)},setIframeCssTags:function(t){const e=t.iframeCSSFileName,i=this._window.RegExp;let n="";for(let l,o=0,s=e.length;o<s;o++){if(l=[],/(^https:\/\/)|(^data:text\/css,)/.test(e[o]))l.push(e[o]);else{const t=new i("(^|.*[\\/])"+e[o]+"(\\..+)?\\.css(:\\?.*|;.*)?$","i");for(let e,i=document.getElementsByTagName("link"),n=0,o=i.length;n<o;n++)e=i[n].href.match(t),e&&l.push(e[0])}if(!l||0===l.length)throw'[ExploreEditor.constructor.iframe.fail] The ExploreEditor CSS files installation path could not be automatically detected. Please set the option property "iframeCSSFileName" before creating editor instances.';for(let t=0,e=l.length;t<e;t++)n+='<link href="'+l[t]+'" rel="stylesheet">'}return n+("auto"===t.height?"<style>\n/** Iframe height auto */\nbody{height: min-content; overflow: hidden;}\n</style>":"")},isJsonStr:function(t){let e=!0;try{JSON.parse(t)}catch(i){e=!1}return e}};var c=r,u={name:"dialog",util:c,add:function(t){const e=t.context;e.dialog={kind:"",updateModal:!1,closeSignal:!1};let i=t.util.createElement("DIV");i.className="meta-dialog meta-common";let n=t.util.createElement("DIV");n.className="meta-dialog-back",n.style.display="none";let l=t.util.createElement("DIV");l.className="meta-dialog-inner",l.style.display="none",i.appendChild(n),i.appendChild(l),e.dialog.modalArea=i,e.dialog.back=n,e.dialog.modal=l,e.dialog.modal.addEventListener("mousedown",this.onMouseDown_dialog.bind(t)),e.dialog.modal.addEventListener("click",this.onClick_dialog.bind(t)),e.element.relative.appendChild(i),i=null,n=null,l=null},onMouseDown_dialog:function(t){/meta-dialog-inner/.test(t.target.className)?this.context.dialog.closeSignal=!0:this.context.dialog.closeSignal=!1},onClick_dialog:function(t){t.stopPropagation(),(/close/.test(t.target.getAttribute("data-command"))||this.context.dialog.closeSignal)&&this.plugins.dialog.close.call(this)},open(t,e){if(this.modalForm)return!1;this.plugins.dialog.bindClose&&(this._document.removeEventListener("keydown",this.plugins.dialog.bindClose),this.plugins.dialog.bindClose=null),this.plugins.dialog.bindClose=function(t){/27/.test(t.keyCode)&&this.plugins.dialog.close.call(this)}.bind(this),this._document.addEventListener("keydown",this.plugins.dialog.bindClose),this.context.dialog.updateModal=e,"full"===this.context.options.popupDisplay?this.context.dialog.modalArea.style.position="fixed":this.context.dialog.modalArea.style.position="absolute",this.context.dialog.kind=t,this.modalForm=this.context[t].modal;const i=this.context[t].focusElement;"function"===typeof this.plugins[t].on&&this.plugins[t].on.call(this,e),c.addClass(this.context.dialog.modalArea,"dialog--open"),c.addClass(document.body,"disable-scroll"),this.context.dialog.modalArea.style.display="block",this.context.dialog.back.style.display="block",this.context.dialog.modal.style.display="block",this.modalForm.style.display="block",i&&i.focus()},bindClose:null,close(){this.plugins.dialog.bindClose&&(this._document.removeEventListener("keydown",this.plugins.dialog.bindClose),this.plugins.dialog.bindClose=null);const t=this.context.dialog,e=this.context.dialog.kind;c.removeClass(t.modalArea,"dialog--open"),c.addClass(t.modalArea,"dialog--close"),c.removeClass(document.body,"disable-scroll"),setTimeout((()=>{c.removeClass(t.modalArea,"dialog--close"),t.back.style.display="none",t.modalArea.style.display="none",this.modalForm.style.display="none",t.updateModal=!1,t.kind="",this.modalForm=null,this.focus()}),200),"function"===typeof this.plugins[e].init&&this.plugins[e].init.call(this)}},d={name:"selectMenu",add:function(t){t.context.selectMenu={caller:{},callerContext:null}},setForm:function(){return'<div class="meta-select-list"></div>'},createList:function(t,e,i){t.form.innerHTML="<ul>"+i+"</ul>",t.items=e,t.menus=t.form.querySelectorAll("li")},initEvent:function(t,e){const i=e.querySelector(".meta-select-list"),n=this.context.selectMenu.caller[t]={form:i,items:[],menus:[],index:-1,item:null,clickMethod:null,callerName:t};i.addEventListener("mousedown",this.plugins.selectMenu.onMousedown_list),i.addEventListener("mousemove",this.plugins.selectMenu.onMouseMove_list.bind(this,n)),i.addEventListener("click",this.plugins.selectMenu.onClick_list.bind(this,n))},onMousedown_list:function(t){t.preventDefault(),t.stopPropagation()},onMouseMove_list:function(t,e){this.util.addClass(t.form,"__meta_select-menu-mouse-move");const i=e.target.getAttribute("data-index");i&&(t.index=1*i)},onClick_list:function(t,e){const i=e.target.getAttribute("data-index");i&&t.clickMethod.call(this,t.items[i])},moveItem:function(t,e){this.util.removeClass(t.form,"__meta_select-menu-mouse-move"),e=t.index+e;const i=t.menus,n=i.length,l=t.index=e>=n?0:e<0?n-1:e;for(let o=0;o<n;o++)o===l?this.util.addClass(i[o],"active"):this.util.removeClass(i[o],"active");t.item=t.items[l]},getItem:function(t,e){return e=!e||e<0?t.index:e,t.items[e]},on:function(t,e){const i=this.context.selectMenu.caller[t];this.context.selectMenu.callerContext=i,i.clickMethod=e,i.callerName=t},open:function(t,e){const i=t.form;i.style.visibility="hidden",i.style.display="block",e(i),i.style.visibility=""},close:function(t){t.form.style.display="none",t.items=[],t.menus=[],t.index=-1,t.item=null},init:function(t){t&&(t.items=[],t.menus=[],t.index=-1,t.item=null,t.callerName="",this.context.selectMenu.callerContext=null)}},h={name:"anchor",add:function(t){t.addModule([d]),t.context.anchor={caller:{},forms:this.setDialogForm(t),host:(t._window.location.origin+t._window.location.pathname).replace(/\/$/,""),callerContext:null}},setDialogForm:function(t){const e=t.lang,i=t.options.linkRel,n=(t.options.linkRelDefault.default||"").split(" "),l=t.icons,o=t.util.createElement("DIV");let s='<div class="meta-dialog-body"><div class="meta-dialog-form"><label>'+e.dialogBox.linkBox.url+'</label><div class="meta-dialog-form-files"><input class="meta-input-form meta-input-url" type="text" placeholder="'+(t.options.protocol||"")+'" /><button type="button" class="meta-btn meta-dialog-files-edge-button _meta_bookmark_button" title="'+e.dialogBox.linkBox.bookmark+'">'+l.bookmark+"</button>"+t.plugins.selectMenu.setForm()+'</div><div class="meta-anchor-preview-form"><span class="meta-svg meta-anchor-preview-icon _meta_anchor_bookmark_icon">'+l.bookmark+'</span><span class="meta-svg meta-anchor-preview-icon _meta_anchor_download_icon">'+l.download+'</span><pre class="meta-link-preview"></pre></div></div><div class="meta-dialog-form"><label>'+e.dialogBox.linkBox.text+'</label><input class="meta-input-form _meta_anchor_text" type="text" /></div><div class="meta-dialog-form-footer"><label><input type="checkbox" class="meta-dialog-btn-check _meta_anchor_check" />&nbsp;'+e.dialogBox.linkBox.newWindowCheck+'</label><label><input type="checkbox" class="meta-dialog-btn-check _meta_anchor_download" />&nbsp;'+e.dialogBox.linkBox.downloadLinkCheck+"</label>";if(i.length>0){s+='<div class="meta-anchor-rel"><button type="button" class="meta-btn meta-btn-select meta-anchor-rel-btn">&lt;rel&gt;</button><div class="meta-anchor-rel-wrapper"><pre class="meta-link-preview meta-anchor-rel-preview"></pre></div><div class="meta-list-layer"><div class="meta-list-inner"><ul class="meta-list-basic meta-list-checked">';for(let t,e=0,o=i.length;e<o;e++)t=i[e],s+='<li><button type="button" class="meta-btn-list'+(n.indexOf(t)>-1?" meta-checked":"")+'" data-command="'+t+'" title="'+t+'"><span class="meta-svg">'+l.checked+"</span>"+t+"</button></li>";s+="</ul></div></div></div>"}return s+="</div></div>",o.innerHTML=s,o},initEvent:function(t,e){const i=this.plugins.anchor,n=this.context.anchor.caller[t]={modal:e,urlInput:null,linkDefaultRel:this.options.linkRelDefault,defaultRel:this.options.linkRelDefault.default||"",currentRel:[],linkAnchor:null,linkValue:"",change:!1,callerName:t};"string"===typeof n.linkDefaultRel.default&&(n.linkDefaultRel.default=n.linkDefaultRel.default.trim()),"string"===typeof n.linkDefaultRel.check_new_window&&(n.linkDefaultRel.check_new_window=n.linkDefaultRel.check_new_window.trim()),"string"===typeof n.linkDefaultRel.check_bookmark&&(n.linkDefaultRel.check_bookmark=n.linkDefaultRel.check_bookmark.trim()),n.urlInput=e.querySelector(".meta-input-url"),n.anchorText=e.querySelector("._meta_anchor_text"),n.newWindowCheck=e.querySelector("._meta_anchor_check"),n.downloadCheck=e.querySelector("._meta_anchor_download"),n.download=e.querySelector("._meta_anchor_download_icon"),n.preview=e.querySelector(".meta-link-preview"),n.bookmark=e.querySelector("._meta_anchor_bookmark_icon"),n.bookmarkButton=e.querySelector("._meta_bookmark_button"),this.plugins.selectMenu.initEvent.call(this,t,e);const l=this.context.selectMenu.caller[t];this.options.linkRel.length>0&&(n.relButton=e.querySelector(".meta-anchor-rel-btn"),n.relList=e.querySelector(".meta-list-layer"),n.relPreview=e.querySelector(".meta-anchor-rel-preview"),n.relButton.addEventListener("click",i.onClick_relButton.bind(this,n)),n.relList.addEventListener("click",i.onClick_relList.bind(this,n))),n.newWindowCheck.addEventListener("change",i.onChange_newWindowCheck.bind(this,n)),n.downloadCheck.addEventListener("change",i.onChange_downloadCheck.bind(this,n)),n.anchorText.addEventListener("input",i.onChangeAnchorText.bind(this,n)),n.urlInput.addEventListener("input",i.onChangeUrlInput.bind(this,n)),n.urlInput.addEventListener("keydown",i.onKeyDownUrlInput.bind(this,l)),n.urlInput.addEventListener("focus",i.onFocusUrlInput.bind(this,n,l)),n.urlInput.addEventListener("blur",i.onBlurUrlInput.bind(this,l)),n.bookmarkButton.addEventListener("click",i.onClick_bookmarkButton.bind(this,n))},on:function(t,e){if(e){if(t.linkAnchor){this.context.dialog.updateModal=!0;const e=t.linkAnchor.href;t.linkValue=t.preview.textContent=t.urlInput.value=/#.+$/.test(e)?e.substr(e.lastIndexOf("#")):e,t.anchorText.value=t.linkAnchor.textContent.trim()||t.linkAnchor.getAttribute("alt"),t.newWindowCheck.checked=!!/_blank/i.test(t.linkAnchor.target),t.downloadCheck.checked=t.linkAnchor.download}}else this.plugins.anchor.init.call(this,t),t.anchorText.value=this.getSelection().toString();this.context.anchor.callerContext=t,this.plugins.anchor.setRel.call(this,t,e&&t.linkAnchor?t.linkAnchor.rel:t.defaultRel),this.plugins.anchor.setLinkPreview.call(this,t,t.linkValue),this.plugins.selectMenu.on.call(this,t.callerName,this.plugins.anchor.setHeaderBookmark)},closeRelMenu:null,toggleRelList:function(t,e){if(e){const e=t.relButton,i=t.relList;this.util.addClass(e,"active"),i.style.visibility="hidden",i.style.display="block",this.options.rtl?i.style.left=e.offsetLeft-i.offsetWidth-1+"px":i.style.left=e.offsetLeft+e.offsetWidth+1+"px",i.style.top=e.offsetTop+e.offsetHeight/2-i.offsetHeight/2+"px",i.style.visibility="",this.plugins.anchor.closeRelMenu=function(t,e,i){i&&(t.relButton.contains(i.target)||t.relList.contains(i.target))||(this.util.removeClass(e,"active"),t.relList.style.display="none",this.modalForm.removeEventListener("click",this.plugins.anchor.closeRelMenu),this.plugins.anchor.closeRelMenu=null)}.bind(this,t,e),this.modalForm.addEventListener("click",this.plugins.anchor.closeRelMenu)}else this.plugins.anchor.closeRelMenu&&this.plugins.anchor.closeRelMenu()},onClick_relButton:function(t,e){this.plugins.anchor.toggleRelList.call(this,t,!this.util.hasClass(e.target,"active"))},onClick_relList:function(t,e){const i=e.target,n=i.getAttribute("data-command");if(!n)return;const l=t.currentRel,o=this.util.toggleClass(i,"meta-checked"),s=l.indexOf(n);o?-1===s&&l.push(n):s>-1&&l.splice(s,1),t.relPreview.title=t.relPreview.textContent=l.join(" ")},setRel:function(t,e){const i=t.relList,n=t.currentRel=e?e.split(" "):[];if(!i)return;const l=i.querySelectorAll("button");for(let o,s=0,a=l.length;s<a;s++)o=l[s].getAttribute("data-command"),n.indexOf(o)>-1?this.util.addClass(l[s],"meta-checked"):this.util.removeClass(l[s],"meta-checked");t.relPreview.title=t.relPreview.textContent=n.join(" ")},createHeaderList:function(t,e,i){const n=this.util.getListChildren(this.context.element.wysiwyg,(function(t){return/h[1-6]/i.test(t.nodeName)}));if(0===n.length)return;const l=new this._window.RegExp("^"+i.replace(/^#/,""),"i"),o=[];let s="";for(let a,r=0,c=n.length;r<c;r++)a=n[r],l.test(a.textContent)&&(o.push(a),s+='<li class="meta-select-item" data-index="'+r+'">'+a.textContent+"</li>");0===o.length?this.plugins.selectMenu.close.call(this,e):(this.plugins.selectMenu.createList(e,o,s),this.plugins.selectMenu.open.call(this,e,this.plugins.anchor.setMenuListPosition.bind(this,t)))},setMenuListPosition:function(t,e){e.style.top=t.urlInput.offsetHeight+1+"px"},onKeyDownUrlInput:function(t,e){switch(e.keyCode){case 38:e.preventDefault(),e.stopPropagation(),this.plugins.selectMenu.moveItem.call(this,t,-1);break;case 40:e.preventDefault(),e.stopPropagation(),this.plugins.selectMenu.moveItem.call(this,t,1);break;case 13:t.index>-1&&(e.preventDefault(),e.stopPropagation(),this.plugins.anchor.setHeaderBookmark.call(this,this.plugins.selectMenu.getItem(t,null)))}},setHeaderBookmark:function(t){const e=this.context.anchor.callerContext,i=t.id||"h_"+this._window.Math.random().toString().replace(/.+\./,"");t.id=i,e.urlInput.value="#"+i,e.anchorText.value.trim()&&e.change||(e.anchorText.value=t.textContent),this.plugins.anchor.setLinkPreview.call(this,e,e.urlInput.value),this.plugins.selectMenu.close.call(this,this.context.selectMenu.callerContext),this.context.anchor.callerContext.urlInput.focus()},onChangeAnchorText:function(t,e){t.change=!!e.target.value.trim()},onChangeUrlInput:function(t,e){const i=e.target.value.trim();this.plugins.anchor.setLinkPreview.call(this,t,i),/^#/.test(i)?this.plugins.anchor.createHeaderList.call(this,t,this.context.selectMenu.callerContext,i):this.plugins.selectMenu.close.call(this,this.context.selectMenu.callerContext)},onFocusUrlInput:function(t,e){const i=t.urlInput.value;/^#/.test(i)&&this.plugins.anchor.createHeaderList.call(this,t,e,i)},onBlurUrlInput:function(t){this.plugins.selectMenu.close.call(this,t)},setLinkPreview:function(t,e){const i=t.preview,n=this.options.linkProtocol,l=/^(mailto:|tel:|sms:|https*:\/\/|#)/.test(e),o=!!n&&this._window.RegExp("^"+e.substr(0,n.length)).test(n);t.linkValue=i.textContent=e?!n||l||o?l?e:/^www\./.test(e)?"http://"+e:this.context.anchor.host+(/^\//.test(e)?"":"/")+e:n+e:"",0===e.indexOf("#")?(t.bookmark.style.display="inline-block",this.util.addClass(t.bookmarkButton,"active")):(t.bookmark.style.display="none",this.util.removeClass(t.bookmarkButton,"active")),-1===e.indexOf("#")&&t.downloadCheck.checked?t.download.style.display="block":t.download.style.display="none"},setCtx:function(t,e){t&&(e.linkAnchor=t,e.linkValue=t.href,e.currentRel=t.rel.split(" "))},updateAnchor:function(t,e,i,n,l){!/^#/.test(e)&&n.downloadCheck.checked?t.setAttribute("download",i||e):t.removeAttribute("download"),n.newWindowCheck.checked?t.target="_blank":t.removeAttribute("target");const o=n.currentRel.join(" ");o?t.rel=o:t.removeAttribute("rel"),t.href=e,t.setAttribute("alt",i),l?0===t.children.length&&(t.textContent=""):t.textContent=i},createAnchor:function(t,e){if(0===t.linkValue.length)return null;const i=t.linkValue,n=t.anchorText,l=0===n.value.length?i:n.value,o=t.linkAnchor||this.util.createElement("A");return this.plugins.anchor.updateAnchor(o,i,l,t,e),t.linkValue=t.preview.textContent=t.urlInput.value=t.anchorText.value="",o},onClick_bookmarkButton:function(t){let e=t.urlInput.value;/^#/.test(e)?(e=e.substr(1),t.bookmark.style.display="none",this.util.removeClass(t.bookmarkButton,"active"),this.plugins.selectMenu.close.call(this,this.context.selectMenu.callerContext)):(e="#"+e,t.bookmark.style.display="block",this.util.addClass(t.bookmarkButton,"active"),t.downloadCheck.checked=!1,t.download.style.display="none",this.plugins.anchor.createHeaderList.call(this,t,this.context.selectMenu.callerContext,e)),t.urlInput.value=e,this.plugins.anchor.setLinkPreview.call(this,t,e),t.urlInput.focus()},onChange_newWindowCheck:function(t,e){"string"===typeof t.linkDefaultRel.check_new_window&&(e.target.checked?this.plugins.anchor.setRel.call(this,t,this.plugins.anchor.relMerge.call(this,t,t.linkDefaultRel.check_new_window)):this.plugins.anchor.setRel.call(this,t,this.plugins.anchor.relDelete.call(this,t,t.linkDefaultRel.check_new_window)))},onChange_downloadCheck:function(t,e){e.target.checked?(t.download.style.display="block",t.bookmark.style.display="none",this.util.removeClass(t.bookmarkButton,"active"),t.linkValue=t.preview.textContent=t.urlInput.value=t.urlInput.value.replace(/^#+/,""),"string"===typeof t.linkDefaultRel.check_bookmark&&this.plugins.anchor.setRel.call(this,t,this.plugins.anchor.relMerge.call(this,t,t.linkDefaultRel.check_bookmark))):(t.download.style.display="none","string"===typeof t.linkDefaultRel.check_bookmark&&this.plugins.anchor.setRel.call(this,t,this.plugins.anchor.relDelete.call(this,t,t.linkDefaultRel.check_bookmark)))},relMerge:function(t,e){const i=t.currentRel;if(!e)return i.join(" ");if(/^only:/.test(e))return e=e.replace(/^only:/,"").trim(),t.currentRel=e.split(" "),e;const n=e.split(" ");for(let l,o=0,s=n.length;o<s;o++)l=i.indexOf(n[o]),-1===l&&i.push(n[o]);return i.join(" ")},relDelete:function(t,e){if(!e)return t.currentRel.join(" ");/^only:/.test(e)&&(e=e.replace(/^only:/,"").trim());const i=t.currentRel.join(" ").replace(this._window.RegExp(e+"\\s*"),"");return t.currentRel=i.split(" "),i},init:function(t){t.linkAnchor=null,t.linkValue=t.preview.textContent=t.urlInput.value="",t.anchorText.value="",t.newWindowCheck.checked=!1,t.downloadCheck.checked=!1,t.change=!1,this.plugins.anchor.setRel.call(this,t,t.defaultRel),t.relList&&this.plugins.anchor.toggleRelList.call(this,t,!1),this.context.anchor.callerContext=null,this.plugins.selectMenu.init.call(this,this.context.selectMenu.callerContext)}},m={name:"link",display:"dialog",add:function(t){t.addModule([u,h]);const e=t.context,i=e.link={focusElement:null,linkAnchor:null,anchorCtx:null};let n=this.setDialog(t);i.modal=n;let l=this.setController_LinkButton(t);i.linkController=l,n.querySelector("form").addEventListener("submit",this.submit.bind(t)),l.addEventListener("click",this.onClick_linkController.bind(t)),e.dialog.modal.appendChild(n),e.element.relative.appendChild(l),t.plugins.anchor.initEvent.call(t,"link",n),i.focusElement=e.anchor.caller.link.urlInput,n=null,l=null},setDialog:function(t){const e=t.lang,i=t.util.createElement("DIV"),n=t.icons;i.className="meta-dialog-content",i.style.display="none";const l='<form><div class="meta-dialog-header"><button type="button" data-command="close" class="meta-btn meta-dialog-close" aria-label="Close" title="'+e.dialogBox.close+'">'+n.cancel+'</button><span class="meta-modal-title">'+e.dialogBox.linkBox.title+"</span></div>"+t.context.anchor.forms.innerHTML+'<div class="meta-dialog-footer"><button type="submit" class="meta-btn-primary" title="'+e.dialogBox.submitButton+'"><span>'+e.dialogBox.submitButton+"</span></button></div></form>";return i.innerHTML=l,i},setController_LinkButton:function(t){const e=t.lang,i=t.icons,n=t.util.createElement("DIV");return n.className="meta-controller meta-controller-link",n.innerHTML='<div class="meta-arrow meta-arrow-up"></div><div class="link-content"><span><a target="_blank" href=""></a>&nbsp;</span><div class="meta-btn-group"><button type="button" data-command="update" tabindex="-1" class="meta-btn meta-tooltip">'+i.edit+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.controller.edit+'</span></span></button><button type="button" data-command="unlink" tabindex="-1" class="meta-btn meta-tooltip">'+i.unlink+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.controller.unlink+'</span></span></button><button type="button" data-command="delete" tabindex="-1" class="meta-btn meta-tooltip">'+i.delete+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.controller.remove+"</span></span></button></div></div>",n},open:function(){this.plugins.dialog.open.call(this,"link","link"===this.currentControllerName)},submit:function(t){this.showLoading(),t.preventDefault(),t.stopPropagation();try{const t=this.plugins.anchor.createAnchor.call(this,this.context.anchor.caller.link,!1);if(this.context.dialog.updateModal){const t=this.context.link.linkAnchor.childNodes[0];this.setRange(t,0,t,t.textContent.length)}else{const e=this.getSelectedElements();if(e.length>1){const i=this.util.createElement(e[0].nodeName);if(i.appendChild(t),!this.insertNode(i,null,!0))return}else if(!this.insertNode(t,null,!0))return;this.setRange(t.childNodes[0],0,t.childNodes[0],t.textContent.length)}}finally{this.plugins.dialog.close.call(this),this.closeLoading(),this.history.push(!1)}return!1},active:function(t){if(t){if(this.util.isAnchor(t)&&null===t.getAttribute("data-image-link"))return this.controllerArray.indexOf(this.context.link.linkController)<0&&this.plugins.link.call_controller.call(this,t),!0}else this.controllerArray.indexOf(this.context.link.linkController)>-1&&this.controllersOff();return!1},on:function(t){this.plugins.anchor.on.call(this,this.context.anchor.caller.link,t)},call_controller(t){this.editLink=this.context.link.linkAnchor=this.context.anchor.caller.link.linkAnchor=t;const e=this.context.link.linkController,i=e.querySelector("a");i.href=t.href,i.title=t.textContent,i.textContent=t.textContent,this.util.addClass(t,"on"),this.setControllerPosition(e,t,"bottom",{left:0,top:0}),this.controllersOn(e,t,"link",this.util.removeClass.bind(this.util,this.context.link.linkAnchor,"on"))},onClick_linkController:function(t){t.stopPropagation();const e=t.target.getAttribute("data-command")||t.target.parentNode.getAttribute("data-command");if(e){if(t.preventDefault(),/update/.test(e))this.plugins.dialog.open.call(this,"link",!0);else if(/unlink/.test(e)){const t=this.util.getChildElement(this.context.link.linkAnchor,(function(t){return 0===t.childNodes.length||3===t.nodeType}),!1),e=this.util.getChildElement(this.context.link.linkAnchor,(function(t){return 0===t.childNodes.length||3===t.nodeType}),!0);this.setRange(t,0,e,e.textContent.length),this.nodeChange(null,null,["A"],!1)}else this.util.removeItem(this.context.link.linkAnchor),this.context.anchor.caller.link.linkAnchor=null,this.focus(),this.history.push(!1);this.controllersOff()}},init:function(){this.context.link.linkController.style.display="none",this.plugins.anchor.init.call(this,this.context.anchor.caller.link)}},p={name:"component",set_container:function(t,e){const i=this.util.createElement("DIV");return i.className="meta-component "+e,i.setAttribute("contenteditable",!1),i.appendChild(t),i},set_cover:function(t){const e=this.util.createElement("FIGURE");return e.appendChild(t),e},create_caption:function(){const t=this.util.createElement("FIGCAPTION");return t.setAttribute("contenteditable",!0),t.innerHTML="<div>"+this.lang.dialogBox.caption+"</div>",t}},g={name:"resizing",add:function(t){const e=t.icons,i=t.context;i.resizing={resizeClientX:0,resizeClientY:0,resize_plugin:"",resize_w:0,resize_h:0,origin_w:0,origin_h:0,rotateVertical:!1,resize_direction:"",move_path:null,isChange:!1,alignIcons:{basic:e.align_justify,left:e.align_left,right:e.align_right,center:e.align_center}};let n=this.setController_resize(t);i.resizing.resizeContainer=n,i.resizing.resizeDiv=n.querySelector(".meta-modal-resize"),i.resizing.resizeDot=n.querySelector(".meta-resize-dot"),i.resizing.resizeDisplay=n.querySelector(".meta-resize-display");let l=this.setController_button(t);i.resizing.resizeButton=l;let o=i.resizing.resizeHandles=i.resizing.resizeDot.querySelectorAll("span");i.resizing.resizeButtonGroup=l.querySelector("._meta_resizing_btn_group"),i.resizing.rotationButtons=l.querySelectorAll("._meta_resizing_btn_group ._meta_rotation"),i.resizing.percentageButtons=l.querySelectorAll("._meta_resizing_btn_group ._meta_percentage"),i.resizing.alignMenu=l.querySelector(".meta-resizing-align-list"),i.resizing.alignMenuList=i.resizing.alignMenu.querySelectorAll("button"),i.resizing.alignButton=l.querySelector("._meta_resizing_align_button"),i.resizing.autoSizeButton=l.querySelector("._meta_resizing_btn_group ._meta_auto_size"),i.resizing.captionButton=l.querySelector("._meta_resizing_caption_button"),n.addEventListener("mousedown",(function(t){t.preventDefault()})),o[0].addEventListener("mousedown",this.onMouseDown_resize_handle.bind(t)),o[1].addEventListener("mousedown",this.onMouseDown_resize_handle.bind(t)),o[2].addEventListener("mousedown",this.onMouseDown_resize_handle.bind(t)),o[3].addEventListener("mousedown",this.onMouseDown_resize_handle.bind(t)),o[4].addEventListener("mousedown",this.onMouseDown_resize_handle.bind(t)),o[5].addEventListener("mousedown",this.onMouseDown_resize_handle.bind(t)),o[6].addEventListener("mousedown",this.onMouseDown_resize_handle.bind(t)),o[7].addEventListener("mousedown",this.onMouseDown_resize_handle.bind(t)),l.addEventListener("click",this.onClick_resizeButton.bind(t)),i.element.relative.appendChild(n),i.element.relative.appendChild(l),n=null,l=null,o=null},setController_resize:function(t){const e=t.util.createElement("DIV");return e.className="meta-controller meta-resizing-container",e.style.display="none",e.innerHTML='<div class="meta-modal-resize"></div><div class="meta-resize-dot"><span class="tl"></span><span class="tr"></span><span class="bl"></span><span class="br"></span><span class="lw"></span><span class="th"></span><span class="rw"></span><span class="bh"></span><div class="meta-resize-display"></div></div>',e},setController_button:function(t){const e=t.lang,i=t.icons,n=t.util.createElement("DIV");return n.className="meta-controller meta-controller-resizing",n.innerHTML='<div class="meta-arrow meta-arrow-up"></div><div class="meta-btn-group _meta_resizing_btn_group"><button type="button" data-command="percent" data-value="1" class="meta-tooltip _meta_percentage"><span>100%</span><span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.controller.resize100+'</span></span></button><button type="button" data-command="percent" data-value="0.75" class="meta-tooltip _meta_percentage"><span>75%</span><span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.controller.resize75+'</span></span></button><button type="button" data-command="percent" data-value="0.5" class="meta-tooltip _meta_percentage"><span>50%</span><span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.controller.resize50+'</span></span></button><button type="button" data-command="auto" class="meta-btn meta-tooltip _meta_auto_size">'+i.auto_size+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.controller.autoSize+'</span></span></button><button type="button" data-command="rotate" data-value="-90" class="meta-btn meta-tooltip _meta_rotation">'+i.rotate_left+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.controller.rotateLeft+'</span></span></button><button type="button" data-command="rotate" data-value="90" class="meta-btn meta-tooltip _meta_rotation">'+i.rotate_right+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.controller.rotateRight+'</span></span></button></div><div class="meta-btn-group" style="padding-top: 0;"><button type="button" data-command="mirror" data-value="h" class="meta-btn meta-tooltip">'+i.mirror_horizontal+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.controller.mirrorHorizontal+'</span></span></button><button type="button" data-command="mirror" data-value="v" class="meta-btn meta-tooltip">'+i.mirror_vertical+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.controller.mirrorVertical+'</span></span></button><button type="button" data-command="onalign" class="meta-btn meta-tooltip _meta_resizing_align_button">'+i.align_justify+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.toolbar.align+'</span></span></button><div class="meta-btn-group-sub meta-common meta-list-layer meta-resizing-align-list"><div class="meta-list-inner"><ul class="meta-list-basic"><li><button type="button" class="meta-btn-list meta-tooltip" data-command="align" data-value="basic">'+i.align_justify+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.dialogBox.basic+'</span></span></button></li><li><button type="button" class="meta-btn-list meta-tooltip" data-command="align" data-value="left">'+i.align_left+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.dialogBox.left+'</span></span></button></li><li><button type="button" class="meta-btn-list meta-tooltip" data-command="align" data-value="center">'+i.align_center+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.dialogBox.center+'</span></span></button></li><li><button type="button" class="meta-btn-list meta-tooltip" data-command="align" data-value="right">'+i.align_right+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.dialogBox.right+'</span></span></button></li></ul></div></div><button type="button" data-command="caption" class="meta-btn meta-tooltip _meta_resizing_caption_button">'+i.caption+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.dialogBox.caption+'</span></span></button><button type="button" data-command="revert" class="meta-btn meta-tooltip">'+i.revert+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.dialogBox.revertButton+'</span></span></button><button type="button" data-command="update" class="meta-btn meta-tooltip">'+i.modify+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.controller.edit+'</span></span></button><button type="button" data-command="delete" class="meta-btn meta-tooltip">'+i.delete+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.controller.remove+"</span></span></button></div>",n},module_getSizeX:function(t,e,i,n){return e||(e=t.element),i||(i=t.cover),n||(n=t.container),e?/%$/.test(e.style.width)?(n&&this.util.getNumber(n.style.width,2)||100)+"%":e.style.width:""},module_getSizeY:function(t,e,i,n){return e||(e=t.element),i||(i=t.cover),n||(n=t.container),n&&i?this.util.getNumber(i.style.paddingBottom,0)>0&&!this.context.resizing.rotateVertical?i.style.height:/%$/.test(e.style.height)&&/%$/.test(e.style.width)?(n&&this.util.getNumber(n.style.height,2)||100)+"%":e.style.height:e&&e.style.height||""},module_setModifyInputSize:function(t,e){const i=t.onlyPercentage&&this.context.resizing.rotateVertical;t.proportion.checked=t.proportionChecked="false"!==t.element.getAttribute("data-proportion");let n=i?"":this.plugins.resizing.module_getSizeX.call(this,t);if(n===t.defaultSizeX&&(n=""),t.onlyPercentage&&(n=this.util.getNumber(n,2)),t.inputX.value=n,e.setInputSize.call(this,"x"),!t.onlyPercentage){let e=i?"":this.plugins.resizing.module_getSizeY.call(this,t);e===t.defaultSizeY&&(e=""),t.onlyPercentage&&(e=this.util.getNumber(e,2)),t.inputY.value=e}t.inputX.disabled=!!i,t.inputY.disabled=!!i,t.proportion.disabled=!!i,e.setRatio.call(this)},module_setInputSize:function(t,e){if(t.onlyPercentage)"x"===e&&t.inputX.value>100&&(t.inputX.value=100);else if(t.proportion.checked&&t.ratio&&/\d/.test(t.inputX.value)&&/\d/.test(t.inputY.value)){const i=t.inputX.value.replace(/\d+|\./g,"")||t.sizeUnit,n=t.inputY.value.replace(/\d+|\./g,"")||t.sizeUnit;if(i!==n)return;const l="%"===i?2:0;"x"===e?t.inputY.value=this.util.getNumber(t.ratioY*this.util.getNumber(t.inputX.value,l),l)+n:t.inputX.value=this.util.getNumber(t.ratioX*this.util.getNumber(t.inputY.value,l),l)+i}},module_setRatio:function(t){const e=t.inputX.value,i=t.inputY.value;if(t.proportion.checked&&/\d+/.test(e)&&/\d+/.test(i)){if((e.replace(/\d+|\./g,"")||t.sizeUnit)!==(i.replace(/\d+|\./g,"")||t.sizeUnit))t.ratio=!1;else if(!t.ratio){const n=this.util.getNumber(e,0),l=this.util.getNumber(i,0);t.ratio=!0,t.ratioX=n/l,t.ratioY=l/n}}else t.ratio=!1},module_sizeRevert:function(t){t.onlyPercentage?t.inputX.value=t.origin_w>100?100:t.origin_w:(t.inputX.value=t.origin_w,t.inputY.value=t.origin_h)},module_saveCurrentSize:function(t){const e=this.plugins.resizing.module_getSizeX.call(this,t),i=this.plugins.resizing.module_getSizeY.call(this,t);t.element.setAttribute("data-size",e+","+i),t.videoRatio&&(t.videoRatio=i)},call_controller_resize:function(t,e){const i=this.context.resizing,n=this.context[e];i.resize_plugin=e;const l=i.resizeContainer,o=i.resizeDiv,s=this.util.getOffset(t,this.context.element.wysiwygFrame),a=i.rotateVertical=/^(90|270)$/.test(Math.abs(t.getAttribute("data-rotate")).toString()),r=a?t.offsetHeight:t.offsetWidth,c=a?t.offsetWidth:t.offsetHeight,u=s.top,d=s.left-this.context.element.wysiwygFrame.scrollLeft;l.style.top=u+"px",l.style.left=d+"px",l.style.width=r+"px",l.style.height=c+"px",o.style.top="0px",o.style.left="0px",o.style.width=r+"px",o.style.height=c+"px";let h=t.getAttribute("data-align")||"basic";h="none"===h?"basic":h;const m=this.util.getParentElement(t,this.util.isComponent),p=this.util.getParentElement(t,"FIGURE"),g=this.plugins.resizing.module_getSizeX.call(this,n,t,p,m)||"auto",f=n.onlyPercentage&&"image"===e?"":", "+(this.plugins.resizing.module_getSizeY.call(this,n,t,p,m)||"auto");this.util.changeTxt(i.resizeDisplay,this.lang.dialogBox[h]+" ("+g+f+")"),i.resizeButtonGroup.style.display=n.resizing?"":"none";const b=!n.resizing||n.resizeDotHide||n.onlyPercentage?"none":"flex",v=i.resizeHandles;for(let k=0,E=v.length;k<E;k++)v[k].style.display=b;if(n.resizing){const t=i.rotationButtons;t[0].style.display=t[1].style.display=n.rotation?"":"none"}const y=i.alignMenuList;this.util.changeElement(i.alignButton.firstElementChild,i.alignIcons[h]);for(let k=0,E=y.length;k<E;k++)y[k].getAttribute("data-value")===h?this.util.addClass(y[k],"on"):this.util.removeClass(y[k],"on");const x=i.percentageButtons,_=/%$/.test(t.style.width)&&/%$/.test(m.style.width)?this.util.getNumber(m.style.width,0)/100+"":"";for(let k=0,E=x.length;k<E;k++)x[k].getAttribute("data-value")===_?this.util.addClass(x[k],"active"):this.util.removeClass(x[k],"active");n.captionShow?(i.captionButton.style.display="",this.util.getChildElement(t.parentNode,"figcaption")?(this.util.addClass(i.captionButton,"active"),n.captionChecked=!0):(this.util.removeClass(i.captionButton,"active"),n.captionChecked=!1)):i.captionButton.style.display="none",l.style.display="block";const C={left:0,top:50};this.options.iframe&&(C.left-=this.context.element.wysiwygFrame.parentElement.offsetLeft,C.top-=this.context.element.wysiwygFrame.parentElement.offsetTop),this.setControllerPosition(i.resizeButton,l,"bottom",C),this.controllersOn(l,i.resizeButton,this.util.setDisabledButtons.bind(this,!1,this.resizingDisabledButtons),t,e),this.util.setDisabledButtons(!0,this.resizingDisabledButtons),i.resize_w=r,i.resize_h=c;const w=(t.getAttribute("origin-size")||"").split(",");return i.origin_w=w[0]||t.naturalWidth,i.origin_h=w[1]||t.naturalHeight,{w:r,h:c,t:u,l:d}},closeAlignMenu:null,openAlignMenu:function(){const t=this.context.resizing.alignButton;this.util.addClass(t,"on"),this.context.resizing.alignMenu.style.top=t.offsetTop+t.offsetHeight+"px",this.context.resizing.alignMenu.style.left=t.offsetLeft-t.offsetWidth/2+"px",this.context.resizing.alignMenu.style.display="block",this.plugins.resizing.closeAlignMenu=function(){this.util.removeClass(this.context.resizing.alignButton,"on"),this.context.resizing.alignMenu.style.display="none",this.removeDocEvent("click",this.plugins.resizing.closeAlignMenu),this.plugins.resizing.closeAlignMenu=null}.bind(this),this.addDocEvent("click",this.plugins.resizing.closeAlignMenu)},onClick_resizeButton:function(t){t.stopPropagation();const e=t.target,i=e.getAttribute("data-command")||e.parentNode.getAttribute("data-command");if(!i)return;const n=e.getAttribute("data-value")||e.parentNode.getAttribute("data-value"),l=this.context.resizing.resize_plugin,o=this.context[l],s=o.element,a=this.plugins[l];if(t.preventDefault(),"function"!==typeof this.plugins.resizing.closeAlignMenu||(this.plugins.resizing.closeAlignMenu(),"onalign"!==i)){switch(i){case"auto":this.plugins.resizing.resetTransform.call(this,s),a.setAutoSize.call(this),this.selectComponent(s,l);break;case"percent":let t=this.plugins.resizing.module_getSizeY.call(this,o);if(this.context.resizing.rotateVertical){const e=s.getAttribute("data-percentage");e&&(t=e.split(",")[1])}this.plugins.resizing.resetTransform.call(this,s),a.setPercentSize.call(this,100*n,null!==this.util.getNumber(t,0)&&/%$/.test(t)?t:""),this.selectComponent(s,l);break;case"mirror":const e=s.getAttribute("data-rotate")||"0";let i=s.getAttribute("data-rotateX")||"",r=s.getAttribute("data-rotateY")||"";"h"===n&&!this.context.resizing.rotateVertical||"v"===n&&this.context.resizing.rotateVertical?r=r?"":"180":i=i?"":"180",s.setAttribute("data-rotateX",i),s.setAttribute("data-rotateY",r),this.plugins.resizing.setTransForm(s,e,i,r);break;case"rotate":const c=this.context.resizing,u=1*s.getAttribute("data-rotate")+1*n,d=this._window.Math.abs(u)>=360?0:u;s.setAttribute("data-rotate",d),c.rotateVertical=/^(90|270)$/.test(this._window.Math.abs(d).toString()),this.plugins.resizing.setTransformSize.call(this,s,null,null),this.selectComponent(s,l);break;case"onalign":return void this.plugins.resizing.openAlignMenu.call(this);case"align":const h="basic"===n?"none":n;a.setAlign.call(this,h,null,null,null),this.selectComponent(s,l);break;case"caption":const m=!o.captionChecked;if(a.openModify.call(this,!0),o.captionChecked=o.captionCheckEl.checked=m,a.update_image.call(this,!1,!1,!1),m){const t=this.util.getChildElement(o.caption,(function(t){return 3===t.nodeType}));t?this.setRange(t,0,t,t.textContent.length):o.caption.focus(),this.controllersOff()}else this.selectComponent(s,l),a.openModify.call(this,!0);break;case"revert":a.setOriginSize.call(this),this.selectComponent(s,l);break;case"update":a.openModify.call(this),this.controllersOff();break;case"delete":a.destroy.call(this)}this.history.push(!1)}},resetTransform:function(t){const e=(t.getAttribute("data-size")||t.getAttribute("data-origin")||"").split(",");this.context.resizing.rotateVertical=!1,t.style.maxWidth="",t.style.transform="",t.style.transformOrigin="",t.setAttribute("data-rotate",""),t.setAttribute("data-rotateX",""),t.setAttribute("data-rotateY",""),this.plugins[this.context.resizing.resize_plugin].setSize.call(this,e[0]?e[0]:"auto",e[1]?e[1]:"",!0)},setTransformSize:function(t,e,i){let n=t.getAttribute("data-percentage");const l=this.context.resizing.rotateVertical,o=1*t.getAttribute("data-rotate");let s="";if(n&&!l)n=n.split(","),"auto"===n[0]&&"auto"===n[1]?this.plugins[this.context.resizing.resize_plugin].setAutoSize.call(this):this.plugins[this.context.resizing.resize_plugin].setPercentSize.call(this,n[0],n[1]);else{const n=this.util.getParentElement(t,"FIGURE"),a=e||t.offsetWidth,r=i||t.offsetHeight,c=(l?r:a)+"px",u=(l?a:r)+"px";if(this.plugins[this.context.resizing.resize_plugin].cancelPercentAttr.call(this),this.plugins[this.context.resizing.resize_plugin].setSize.call(this,a+"px",r+"px",!0),n.style.width=c,n.style.height=this.context[this.context.resizing.resize_plugin].caption?"":u,l){const t=a/2+"px "+a/2+"px 0",e=r/2+"px "+r/2+"px 0";s=90===o||-270===o?e:t}}t.style.transformOrigin=s,this.plugins.resizing.setTransForm(t,o.toString(),t.getAttribute("data-rotateX")||"",t.getAttribute("data-rotateY")||""),t.style.maxWidth=l?"none":"",this.plugins.resizing.setCaptionPosition.call(this,t)},setTransForm:function(t,e,i,n){let l=(t.offsetWidth-t.offsetHeight)*(/-/.test(e)?1:-1),o="";if(/[1-9]/.test(e)&&(i||n))switch(o=i?"Y":"X",e){case"90":o=i&&n?"X":n?o:"";break;case"270":l*=-1,o=i&&n?"Y":i?o:"";break;case"-90":o=i&&n?"Y":i?o:"";break;case"-270":l*=-1,o=i&&n?"X":n?o:"";break;default:o=""}e%180===0&&(t.style.maxWidth=""),t.style.transform="rotate("+e+"deg)"+(i?" rotateX("+i+"deg)":"")+(n?" rotateY("+n+"deg)":"")+(o?" translate"+o+"("+l+"px)":"")},setCaptionPosition:function(t){const e=this.util.getChildElement(this.util.getParentElement(t,"FIGURE"),"FIGCAPTION");e&&(e.style.marginTop=(this.context.resizing.rotateVertical?t.offsetWidth-t.offsetHeight:0)+"px")},onMouseDown_resize_handle:function(t){t.stopPropagation(),t.preventDefault();const e=this.context.resizing,i=e.resize_direction=t.target.classList[0];e.resizeClientX=t.clientX,e.resizeClientY=t.clientY,this.context.element.resizeBackground.style.display="block",e.resizeButton.style.display="none",e.resizeDiv.style.float=/l/.test(i)?"right":/r/.test(i)?"left":"none";const n=this.plugins.resizing.resizing_element.bind(this,e,i,this.context[e.resize_plugin]),l=function(t){if("keydown"===t.type&&27!==t.keyCode)return;const o=e.isChange;e.isChange=!1,this.removeDocEvent("mousemove",n),this.removeDocEvent("mouseup",l),this.removeDocEvent("keydown",l),"keydown"===t.type?(this.controllersOff(),this.context.element.resizeBackground.style.display="none",this.plugins[this.context.resizing.resize_plugin].init.call(this)):(this.plugins.resizing.cancel_controller_resize.call(this,i),o&&this.history.push(!1))}.bind(this);this.addDocEvent("mousemove",n),this.addDocEvent("mouseup",l),this.addDocEvent("keydown",l)},resizing_element:function(t,e,i,n){const l=n.clientX,o=n.clientY;let s=i.element_w,a=i.element_h;const r=i.element_w+(/r/.test(e)?l-t.resizeClientX:t.resizeClientX-l),c=i.element_h+(/b/.test(e)?o-t.resizeClientY:t.resizeClientY-o),u=i.element_h/i.element_w*r;/t/.test(e)&&(t.resizeDiv.style.top=i.element_h-(/h/.test(e)?c:u)+"px"),/l/.test(e)&&(t.resizeDiv.style.left=i.element_w-r+"px"),/r|l/.test(e)&&(t.resizeDiv.style.width=r+"px",s=r),/^(t|b)[^h]$/.test(e)?(t.resizeDiv.style.height=u+"px",a=u):/^(t|b)h$/.test(e)&&(t.resizeDiv.style.height=c+"px",a=c),t.resize_w=s,t.resize_h=a,this.util.changeTxt(t.resizeDisplay,this._window.Math.round(s)+" x "+this._window.Math.round(a)),t.isChange=!0},cancel_controller_resize:function(t){const e=this.context.resizing.rotateVertical;this.controllersOff(),this.context.element.resizeBackground.style.display="none";let i=this._window.Math.round(e?this.context.resizing.resize_h:this.context.resizing.resize_w),n=this._window.Math.round(e?this.context.resizing.resize_w:this.context.resizing.resize_h);if(!e&&!/%$/.test(i)){const t=16,e=this.context.element.wysiwygFrame.clientWidth-2*t-2;this.util.getNumber(i,0)>e&&(n=this._window.Math.round(n/i*e),i=e)}const l=this.context.resizing.resize_plugin;this.plugins[l].setSize.call(this,i,n,!1,t),e&&this.plugins.resizing.setTransformSize.call(this,this.context[this.context.resizing.resize_plugin].element,i,n),this.selectComponent(this.context[l].element,l)}},f={name:"fileManager",xmlHttp:null,checkMediaComponent:function(t){return/IMG/i.test(t)?!/FIGURE/i.test(t.parentElement.nodeName)||!/FIGURE/i.test(t.parentElement.parentElement.nodeName):!/VIDEO/i.test(t)||!/FIGURE/i.test(t.parentElement.nodeName)},upload:function(t,e,i,n,l){this.showLoading();const o=this.plugins.fileManager,s=o.xmlHttp=this.util.getXMLHttpRequest();if(s.onreadystatechange=o.callBackUpload.bind(this,s,n,l),s.open("post",t,!0),null!==e&&"object"===typeof e&&this._window.Object.keys(e).length>0)for(const a in e)s.setRequestHeader(a,e[a]);s.send(i)},callBackUpload:function(t,e,i){if(4===t.readyState)if(200===t.status)try{e(t)}catch(n){throw Error('[ExploreEditor.fileManager.upload.callBack.fail] cause : "'+n.message+'"')}finally{this.closeLoading()}else{this.closeLoading();let e=this.util.isJsonStr(t.responseText)?JSON.parse(t.responseText):t.responseText;const n=t.responseText?e:t;if("function"!==typeof i||i("",n,this)){const e="[ExploreEditor.fileManager.upload.serverException] status: "+t.status+", response: "+(n.errorMessage||t.responseText);throw this.functions.noticeOpen(e),Error(e)}}},checkInfo:function(t,e,i,n,l){let o=[];for(let m=0,p=e.length;m<p;m++)o=o.concat([].slice.call(this.context.element.wysiwyg.getElementsByTagName(e[m])));const s=this.plugins.fileManager,a=this.context[t],r=a.infoList,c=s.setInfo.bind(this);if(o.length===r.length){if(this.componentsInfoReset){for(let e=0,n=o.length;e<n;e++)c(t,o[e],i,null,l);return}{let t=!1;for(let e,i=0,n=r.length;i<n;i++)if(e=r[i],0===o.filter((function(t){return e.src===t.src&&e.index.toString()===t.getAttribute("data-index")})).length){t=!0;break}if(!t)return}}const u=l?this.context.resizing.resize_plugin:"";l&&(this.context.resizing.resize_plugin=t);const d=[],h=[];for(let m=0,p=r.length;m<p;m++)h[m]=r[m].index;for(let m,p=0,g=o.length;p<g;p++)m=o[p],this.util.getParentElement(m,this.util.isMediaComponent)&&s.checkMediaComponent(m)?!m.getAttribute("data-index")||h.indexOf(1*m.getAttribute("data-index"))<0?(d.push(a.infoIndex),m.removeAttribute("data-index"),c(t,m,i,null,l)):d.push(1*m.getAttribute("data-index")):(d.push(a.infoIndex),n(m));for(let m,p=0;p<r.length;p++)m=r[p].index,d.indexOf(m)>-1||(r.splice(p,1),"function"===typeof i&&i(null,m,"delete",null,0,this),p--);l&&(this.context.resizing.resize_plugin=u)},setInfo:function(t,e,i,n,l){const o=l?this.context.resizing.resize_plugin:"";l&&(this.context.resizing.resize_plugin=t);const s=this.plugins[t],a=this.context[t],r=a.infoList;let c=e.getAttribute("data-index"),u=null,d="";if(n||(n={name:e.getAttribute("data-file-name")||("string"===typeof e.src?e.src.split("/").pop():""),size:e.getAttribute("data-file-size")||0}),!c||this.componentsInfoInit)d="create",c=a.infoIndex++,e.setAttribute("data-index",c),e.setAttribute("data-file-name",n.name),e.setAttribute("data-file-size",n.size),u={src:e.src,index:1*c,name:n.name,size:n.size},r.push(u);else{d="update",c*=1;for(let t=0,e=r.length;t<e;t++)if(c===r[t].index){u=r[t];break}u||(c=a.infoIndex++,u={index:c},r.push(u)),u.src=e.src,u.name=e.getAttribute("data-file-name"),u.size=1*e.getAttribute("data-file-size")}if(u.element=e,u.delete=s.destroy.bind(this,e),u.select=function(t){t.scrollIntoView(!0),this._window.setTimeout(s.select.bind(this,t))}.bind(this,e),l){if(!e.getAttribute("origin-size")&&e.naturalWidth&&e.setAttribute("origin-size",e.naturalWidth+","+e.naturalHeight),!e.getAttribute("data-origin")){const t=this.util.getParentElement(e,this.util.isMediaComponent),i=this.util.getParentElement(e,"FIGURE"),n=this.plugins.resizing.module_getSizeX.call(this,a,e,i,t),l=this.plugins.resizing.module_getSizeY.call(this,a,e,i,t);e.setAttribute("data-origin",n+","+l),e.setAttribute("data-size",n+","+l)}if(!e.style.width){const t=(e.getAttribute("data-size")||e.getAttribute("data-origin")||"").split(",");s.onModifyMode.call(this,e,null),s.applySize.call(this,t[0],t[1])}this.context.resizing.resize_plugin=o}"function"===typeof i&&i(e,c,d,u,--a.uploadFileLength<0?0:a.uploadFileLength,this)},deleteInfo:function(t,e,i){if(e>=0){const n=this.context[t].infoList;for(let t=0,l=n.length;t<l;t++)if(e===n[t].index)return n.splice(t,1),void("function"===typeof i&&i(null,e,"delete",null,0,this))}},resetInfo:function(t,e){const i=this.context[t];if("function"===typeof e){const t=i.infoList;for(let i=0,n=t.length;i<n;i++)e(null,t[i].index,"delete",null,0,this)}i.infoList=[],i.infoIndex=0}},b={name:"image",display:"dialog",add:function(t){t.addModule([u,h,p,g,f]);const e=t.options,i=t.context,n=i.image={infoList:[],infoIndex:0,uploadFileLength:0,focusElement:null,sizeUnit:e.imageSizeUnit,linkElement:"",altText:{},align:"none",floatClassRegExp:"__meta__float\\-[a-z]+",v_src:{linkValue:""},svgDefaultSize:"30%",base64RenderIndex:0,element:null,cover:null,container:null,inputX:null,inputY:null,element_w:1,element_h:1,element_l:0,element_t:0,defaultSizeX:"auto",defaultSizeY:"auto",origin_w:"auto"===e.imageWidth?"":e.imageWidth,origin_h:"auto"===e.imageHeight?"":e.imageHeight,proportionChecked:!0,resizing:e.imageResizing,resizeDotHide:!e.imageHeightShow,rotation:e.imageRotation,onlyPercentage:e.imageSizeOnlyPercentage,ratio:!1,ratioX:1,ratioY:1,captionShow:!0,captionChecked:!1,caption:null,captionCheckEl:null};let l=this.setDialog(t);n.modal=l,n.imgInputFile=l.querySelector("._meta_image_file"),n.imgUrlFile=l.querySelector("._meta_image_url"),n.focusElement=n.imgInputFile||n.imgUrlFile,n.altText=l.querySelector("._meta_image_alt"),n.captionCheckEl=l.querySelector("._meta_image_check_caption"),n.previewSrc=l.querySelector("._meta_tab_content_image .meta-link-preview"),l.querySelector(".meta-dialog-tabs").addEventListener("click",this.openTab.bind(t)),l.querySelector("form").addEventListener("submit",this.submit.bind(t)),n.imgInputFile&&l.querySelector(".meta-file-remove").addEventListener("click",this.removeSelectedFiles.bind(n.imgInputFile,n.imgUrlFile,n.previewSrc)),n.imgUrlFile&&n.imgUrlFile.addEventListener("input",this.onLinkPreview.bind(n.previewSrc,n.v_src,e.linkProtocol)),n.imgInputFile&&n.imgUrlFile&&n.imgInputFile.addEventListener("change",this.fileInputChange.bind(n));const o=l.querySelector(".__meta__gallery");o&&o.addEventListener("click",this.openGallery.bind(t)),n.proportion={},n.inputX={},n.inputY={},e.imageResizing&&(n.proportion=l.querySelector("._meta_image_check_proportion"),n.inputX=l.querySelector("._meta_image_size_x"),n.inputY=l.querySelector("._meta_image_size_y"),n.inputX.value=e.imageWidth,n.inputY.value=e.imageHeight,n.inputX.addEventListener("keyup",this.setInputSize.bind(t,"x")),n.inputY.addEventListener("keyup",this.setInputSize.bind(t,"y")),n.inputX.addEventListener("change",this.setRatio.bind(t)),n.inputY.addEventListener("change",this.setRatio.bind(t)),n.proportion.addEventListener("change",this.setRatio.bind(t)),l.querySelector(".meta-dialog-btn-revert").addEventListener("click",this.sizeRevert.bind(t))),i.dialog.modal.appendChild(l),t.plugins.anchor.initEvent.call(t,"image",l.querySelector("._meta_tab_content_url")),n.anchorCtx=t.context.anchor.caller.image,l=null},setDialog:function(t){const e=t.options,i=t.lang,n=t.util.createElement("DIV");n.className="meta-dialog-content meta-dialog-image",n.style.display="none";let l='<div class="meta-dialog-header"><button type="button" data-command="close" class="meta-btn meta-dialog-close" class="close" aria-label="Close" title="'+i.dialogBox.close+'">'+t.icons.cancel+'</button><span class="meta-modal-title">'+i.dialogBox.imageBox.title+'</span></div><div class="meta-dialog-tabs"><button type="button" class="_meta_tab_link active" data-tab-link="image">'+i.toolbar.image+'</button><button type="button" class="_meta_tab_link" data-tab-link="url">'+i.toolbar.link+'</button></div><form method="post" enctype="multipart/form-data"><div class="_meta_tab_content _meta_tab_content_image"><div class="meta-dialog-body"><div style="border-bottom: 1px dashed #ccc;">';if(e.imageFileInput&&(l+='<div class="meta-dialog-form"><label>'+i.dialogBox.imageBox.file+'</label><div class="meta-dialog-form-files"><input class="meta-input-form _meta_image_file" type="file" accept="'+e.imageAccept+'"'+(e.imageMultipleFile?' multiple="multiple"':"")+'/><button type="button" class="meta-btn meta-dialog-files-edge-button meta-file-remove" title="'+i.controller.remove+'">'+t.icons.cancel+"</button></div></div>"),e.imageUrlInput&&(l+='<div class="meta-dialog-form"><label>'+i.dialogBox.imageBox.url+'</label><div class="meta-dialog-form-files"><input class="meta-input-form meta-input-url _meta_image_url" type="text" />'+(e.imageGalleryUrl&&t.plugins.imageGallery?'<button type="button" class="meta-btn meta-dialog-files-edge-button __meta__gallery" title="'+i.toolbar.imageGallery+'">'+t.icons.image_gallery+"</button>":"")+'</div><pre class="meta-link-preview"></pre></div>'),l+='</div><div class="meta-dialog-form"><label>'+i.dialogBox.imageBox.altText+'</label><input class="meta-input-form _meta_image_alt" type="text" /></div>',e.imageResizing){const n=e.imageSizeOnlyPercentage,o=n?' style="display: none !important;"':"",s=e.imageHeightShow?"":' style="display: none !important;"';l+='<div class="meta-dialog-form">',n||!e.imageHeightShow?l+='<div class="meta-dialog-size-text"><label class="size-w">'+i.dialogBox.size+"</label></div>":l+='<div class="meta-dialog-size-text"><label class="size-w">'+i.dialogBox.width+'</label><label class="meta-dialog-size-x">&nbsp;</label><label class="size-h">'+i.dialogBox.height+"</label></div>",l+='<input class="meta-input-control _meta_image_size_x" placeholder="auto"'+(n?' type="number" min="1"':'type="text"')+(n?' max="100"':"")+' /><label class="meta-dialog-size-x"'+s+">"+(n?"%":"x")+'</label><input type="text" class="meta-input-control _meta_image_size_y" placeholder="auto"'+o+(n?' max="100"':"")+s+"/><label"+o+s+'><input type="checkbox" class="meta-dialog-btn-check _meta_image_check_proportion" checked/>&nbsp;'+i.dialogBox.proportion+'</label><button type="button" title="'+i.dialogBox.revertButton+'" class="meta-btn meta-dialog-btn-revert" style="float: right;">'+t.icons.revert+"</button></div>"}return l+='<div class="meta-dialog-form meta-dialog-form-footer"><label><input type="checkbox" class="meta-dialog-btn-check _meta_image_check_caption" />&nbsp;'+i.dialogBox.caption+'</label></div></div></div><div class="_meta_tab_content _meta_tab_content_url" style="display: none">'+t.context.anchor.forms.innerHTML+'</div><div class="meta-dialog-footer"><div><label><input type="radio" name="exploreEditor_image_radio" class="meta-dialog-btn-radio" value="none" checked>'+i.dialogBox.basic+'</label><label><input type="radio" name="exploreEditor_image_radio" class="meta-dialog-btn-radio" value="left">'+i.dialogBox.left+'</label><label><input type="radio" name="exploreEditor_image_radio" class="meta-dialog-btn-radio" value="center">'+i.dialogBox.center+'</label><label><input type="radio" name="exploreEditor_image_radio" class="meta-dialog-btn-radio" value="right">'+i.dialogBox.right+'</label></div><button type="submit" class="meta-btn-primary" title="'+i.dialogBox.submitButton+'"><span>'+i.dialogBox.submitButton+"</span></button></div></form>",n.innerHTML=l,n},fileInputChange:function(){this.imgInputFile.value?(this.imgUrlFile.setAttribute("disabled",!0),this.previewSrc.style.textDecoration="line-through"):(this.imgUrlFile.removeAttribute("disabled"),this.previewSrc.style.textDecoration="")},removeSelectedFiles(t,e){this.value="",t&&(t.removeAttribute("disabled"),e.style.textDecoration="")},openGallery:function(){this.callPlugin("imageGallery",this.plugins.imageGallery.open.bind(this,this.plugins.image.setUrlInput.bind(this.context.image)),null)},setUrlInput:function(t){this.altText.value=t.alt,this.v_src.linkValue=this.previewSrc.textContent=this.imgUrlFile.value=t.src,this.imgUrlFile.focus()},onLinkPreview(t,e,i){const n=i.target.value.trim();t.linkValue=this.textContent=n?e&&-1===n.indexOf("://")&&0!==n.indexOf("#")?e+n:-1===n.indexOf("://")?"/"+n:n:""},fileTags:["img"],select:function(t){this.plugins.image.onModifyMode.call(this,t,this.plugins.resizing.call_controller_resize.call(this,t,"image"))},destroy:function(t){const e=t||this.context.image.element,i=this.util.getParentElement(e,this.util.isMediaComponent)||e,n=1*e.getAttribute("data-index"),l=i.previousElementSibling||i.nextElementSibling,o=i.parentNode;this.util.removeItem(i),this.plugins.image.init.call(this),this.controllersOff(),o!==this.context.element.wysiwyg&&this.util.removeItemAllParents(o,(function(t){return 0===t.childNodes.length}),null),this.focusEdge(l),this.plugins.fileManager.deleteInfo.call(this,"image",n,this.functions.onImageUpload),this.history.push(!1)},on:function(t){const e=this.context.image;t?e.imgInputFile&&this.options.imageMultipleFile&&e.imgInputFile.removeAttribute("multiple"):(e.inputX.value=e.origin_w=this.options.imageWidth===e.defaultSizeX?"":this.options.imageWidth,e.inputY.value=e.origin_h=this.options.imageHeight===e.defaultSizeY?"":this.options.imageHeight,e.imgInputFile&&this.options.imageMultipleFile&&e.imgInputFile.setAttribute("multiple","multiple")),this.plugins.anchor.on.call(this,e.anchorCtx,t)},open:function(){this.plugins.dialog.open.call(this,"image","image"===this.currentControllerName)},openTab:function(t){const e=this.context.image.modal,i="init"===t?e.querySelector("._meta_tab_link"):t.target;if(!/^BUTTON$/i.test(i.tagName))return!1;const n=i.getAttribute("data-tab-link"),l="_meta_tab_content",o=e.getElementsByClassName(l);for(let a=0;a<o.length;a++)o[a].style.display="none";const s=e.getElementsByClassName("_meta_tab_link");for(let a=0;a<s.length;a++)this.util.removeClass(s[a],"active");return e.querySelector("._meta_tab_content_"+n).style.display="block",this.util.addClass(i,"active"),"image"===n&&this.context.image.focusElement?this.context.image.focusElement.focus():"url"===n&&this.context.anchor.caller.image.urlInput.focus(),!1},submit:function(t){const e=this.context.image,i=this.plugins.image;t.preventDefault(),t.stopPropagation(),e.align=e.modal.querySelector('input[name="exploreEditor_image_radio"]:checked').value,e.captionChecked=e.captionCheckEl.checked,e.resizing&&(e.proportionChecked=e.proportion.checked);try{this.context.dialog.updateModal&&i.update_image.call(this,!1,!0,!1),e.imgInputFile&&e.imgInputFile.files.length>0?(this.showLoading(),i.submitAction.call(this,this.context.image.imgInputFile.files)):e.imgUrlFile&&e.v_src.linkValue.length>0&&(this.showLoading(),i.onRender_imgUrl.call(this))}catch(n){throw this.closeLoading(),Error('[ExploreEditor.image.submit.fail] cause : "'+n.message+'"')}finally{this.plugins.dialog.close.call(this)}return!1},submitAction:function(t){if(0===t.length)return;let e=0,i=[];for(let s=0,a=t.length;s<a;s++)/image/i.test(t[s].type)&&(i.push(t[s]),e+=t[s].size);const n=this.options.imageUploadSizeLimit;if(n>0){let t=0;const i=this.context.image.infoList;for(let e=0,n=i.length;e<n;e++)t+=1*i[e].size;if(e+t>n){this.closeLoading();const i="[ExploreEditor.imageUpload.fail] Size of uploadable total images: "+n/1e3+"KB";return void(("function"!==typeof this.functions.onImageUploadError||this.functions.onImageUploadError(i,{limitSize:n,currentSize:t,uploadSize:e},this))&&this.functions.noticeOpen(i))}}const l=this.context.image;l.uploadFileLength=i.length;const o={anchor:this.plugins.anchor.createAnchor.call(this,l.anchorCtx,!0),inputWidth:l.inputX.value,inputHeight:l.inputY.value,align:l.align,isUpdate:this.context.dialog.updateModal,element:l.element};if("function"===typeof this.functions.onImageUploadBefore){const t=this.functions.onImageUploadBefore(i,o,this,function(t){t&&this._window.Array.isArray(t.result)?this.plugins.image.register.call(this,o,t):this.plugins.image.upload.call(this,o,t)}.bind(this));if("undefined"===typeof t)return;if(!t)return void this.closeLoading();this._window.Array.isArray(t)&&t.length>0&&(i=t)}this.plugins.image.upload.call(this,o,i)},error:function(t,e){if(this.closeLoading(),"function"!==typeof this.functions.onImageUploadError||this.functions.onImageUploadError(t,e,this))throw this.functions.noticeOpen(t),Error("[ExploreEditor.plugin.image.error] response: "+t)},upload:function(t,e){if(!e)return void this.closeLoading();if("string"===typeof e)return void this.plugins.image.error.call(this,e,null);const i=this.options.imageUploadUrl,n=this.context.dialog.updateModal?1:e.length;if("string"===typeof i&&i.length>0){const l=new FormData;for(let t=0;t<n;t++)l.append("file-"+t,e[t]);this.plugins.fileManager.upload.call(this,i,this.options.imageUploadHeader,l,this.plugins.image.callBack_imgUpload.bind(this,t),this.functions.onImageUploadError)}else this.plugins.image.setup_reader.call(this,e,t.anchor,t.inputWidth,t.inputHeight,t.align,n,t.isUpdate)},callBack_imgUpload:function(t,e){if("function"===typeof this.functions.imageUploadHandler)this.functions.imageUploadHandler(e,t,this);else{const i=this.util.isJsonStr(e.responseText)?JSON.parse(e.responseText):e.responseText;i.errorMessage?this.plugins.image.error.call(this,i.errorMessage,i):this.plugins.image.register.call(this,t,i)}},register:function(t,e){const i=e.result;for(let n,l=0,o=i.length;l<o;l++){if(n={name:i[l].name,size:i[l].size},t.isUpdate){this.plugins.image.update_src.call(this,i[l].url,t.element,n);break}this.plugins.image.create_image.call(this,i[l].url,t.anchor,t.inputWidth,t.inputHeight,t.align,n)}this.closeLoading()},setup_reader:function(t,e,i,n,l,o,s){try{this.context.image.base64RenderIndex=o;const a=this._window.FileReader,r=[o];this.context.image.inputX.value=i,this.context.image.inputY.value=n;for(let c,u,d=0;d<o;d++)c=new a,u=t[d],c.onload=function(t,o,s,a,c){r[c]={result:t.result,file:a},0===--this.context.image.base64RenderIndex&&(this.plugins.image.onRender_imgBase64.call(this,o,r,s,e,i,n,l),this.closeLoading())}.bind(this,c,s,this.context.image.element,u,d),c.readAsDataURL(u)}catch(a){throw this.closeLoading(),Error('[ExploreEditor.image.setup_reader.fail] cause : "'+a.message+'"')}},onRender_imgBase64:function(t,e,i,n,l,o,s){const a=this.plugins.image.update_src,r=this.plugins.image.create_image;for(let c=0,u=e.length;c<u;c++)t?(this.context.image.element.setAttribute("data-file-name",e[c].file.name),this.context.image.element.setAttribute("data-file-size",e[c].file.size),a.call(this,e[c].result,i,e[c].file)):r.call(this,e[c].result,n,l,o,s,e[c].file)},onRender_imgUrl:function(){const t=this.context.image;if(0===t.v_src.linkValue.length)return!1;try{const e={name:t.v_src.linkValue.split("/").pop(),size:0};this.context.dialog.updateModal?this.plugins.image.update_src.call(this,t.v_src.linkValue,t.element,e):this.plugins.image.create_image.call(this,t.v_src.linkValue,this.plugins.anchor.createAnchor.call(this,t.anchorCtx,!0),t.inputX.value,t.inputY.value,t.align,e)}catch(e){throw Error('[ExploreEditor.image.URLRendering.fail] cause : "'+e.message+'"')}finally{this.closeLoading()}},onRender_link:function(t,e){return e?(e.setAttribute("data-image-link","image"),t.setAttribute("data-image-link",e.href),e.appendChild(t),e):t},setInputSize:function(t,e){e&&32===e.keyCode?e.preventDefault():this.plugins.resizing.module_setInputSize.call(this,this.context.image,t)},setRatio:function(){this.plugins.resizing.module_setRatio.call(this,this.context.image)},checkFileInfo:function(){const t=this.plugins.image,e=this.context.image,i=function(i){t.onModifyMode.call(this,i,null),t.openModify.call(this,!0),e.inputX.value=e.origin_w,e.inputY.value=e.origin_h;const n=this.util.getFormatElement(i);n&&(e.align=n.style.textAlign||n.style.float);this.util.getParentElement(i,this.util.isAnchor)&&!e.anchorCtx.linkValue&&(e.anchorCtx.linkValue=" "),t.update_image.call(this,!0,!1,!0)}.bind(this);this.plugins.fileManager.checkInfo.call(this,"image",["img"],this.functions.onImageUpload,i,!0)},resetFileInfo:function(){this.plugins.fileManager.resetInfo.call(this,"image",this.functions.onImageUpload)},create_image:function(t,e,i,n,l,o){const s=this.plugins.image,a=this.context.image;this.context.resizing.resize_plugin="image";const r=this.util.createElement("IMG");r.src=t,r.alt=a.altText.value,r.setAttribute("data-rotate","0"),e=s.onRender_link.call(this,r,e),a.resizing&&r.setAttribute("data-proportion",a.proportionChecked);const c=this.plugins.component.set_cover.call(this,e),u=this.plugins.component.set_container.call(this,c,"meta-image-container");a.captionChecked&&(a.caption=this.plugins.component.create_caption.call(this),a.caption.setAttribute("contenteditable",!1),c.appendChild(a.caption)),a.element=r,a.cover=c,a.container=u,s.applySize.call(this,i,n),s.setAlign.call(this,l,r,c,u),r.onload=s.image_create_onload.bind(this,r,a.svgDefaultSize,u),this.insertComponent(u,!0,!0,!0)&&this.plugins.fileManager.setInfo.call(this,"image",r,this.functions.onImageUpload,o,!0),this.context.resizing.resize_plugin=""},image_create_onload:function(t,e,i){if(0===t.offsetWidth&&this.plugins.image.applySize.call(this,e,""),this.options.mediaAutoSelect)this.selectComponent(t,"image");else{const t=this.appendFormatTag(i,null);this.setRange(t,0,t,0)}},update_image:function(t,e,i){const n=this.context.image;let l,o=n.element,s=n.cover,a=n.container,r=!1;null===s&&(r=!0,o=n.element.cloneNode(!0),s=this.plugins.component.set_cover.call(this,o)),null===a?(s=s.cloneNode(!0),o=s.querySelector("img"),r=!0,a=this.plugins.component.set_container.call(this,s,"meta-image-container")):r&&(a.innerHTML="",a.appendChild(s),n.cover=s,n.element=o,r=!1);const c=this.util.isNumber(n.inputX.value)?n.inputX.value+n.sizeUnit:n.inputX.value,u=this.util.isNumber(n.inputY.value)?n.inputY.value+n.sizeUnit:n.inputY.value;l=/%$/.test(o.style.width)?c!==a.style.width||u!==a.style.height:c!==o.style.width||u!==o.style.height,o.alt=n.altText.value;let d=!1;n.captionChecked?n.caption||(n.caption=this.plugins.component.create_caption.call(this),s.appendChild(n.caption),d=!0):n.caption&&(this.util.removeItem(n.caption),n.caption=null,d=!0);const h=this.plugins.anchor.createAnchor.call(this,n.anchorCtx,!0);if(h)n.linkElement=n.linkElement===h?h.cloneNode(!1):h,s.insertBefore(this.plugins.image.onRender_link.call(this,o,n.linkElement),n.caption);else if(null!==n.linkElement){const t=o;if(t.setAttribute("data-image-link",""),s.contains(n.linkElement)){const e=t.cloneNode(!0);s.removeChild(n.linkElement),s.insertBefore(e,n.caption),o=e}}if(r){const t=this.util.isRangeFormatElement(n.element.parentNode)||this.util.isWysiwygDiv(n.element.parentNode)?n.element:/^A$/i.test(n.element.parentNode.nodeName)?n.element.parentNode:this.util.getFormatElement(n.element)||n.element;if(this.util.isFormatElement(t)&&t.childNodes.length>0)t.parentNode.insertBefore(a,t),this.util.removeItem(n.element),this.util.removeEmptyNode(t,null),0===t.children.length&&(t.innerHTML=this.util.htmlRemoveWhiteSpace(t.innerHTML));else if(this.util.isFormatElement(t.parentNode)){const e=t.parentNode;e.parentNode.insertBefore(a,t.previousSibling?e.nextElementSibling:e),this.util.removeItem(t)}else t.parentNode.replaceChild(a,t);o=a.querySelector("img"),n.element=o,n.cover=s,n.container=a}(d||!n.onlyPercentage&&l)&&!t&&(/\d+/.test(o.style.height)||this.context.resizing.rotateVertical&&n.captionChecked)&&(/%$/.test(n.inputX.value)||/%$/.test(n.inputY.value)?this.plugins.resizing.resetTransform.call(this,o):this.plugins.resizing.setTransformSize.call(this,o,this.util.getNumber(n.inputX.value,0),this.util.getNumber(n.inputY.value,0))),n.resizing&&(o.setAttribute("data-proportion",n.proportionChecked),l&&this.plugins.image.applySize.call(this)),this.plugins.image.setAlign.call(this,null,o,null,null),t&&this.plugins.fileManager.setInfo.call(this,"image",o,this.functions.onImageUpload,null,!0),e&&this.selectComponent(o,"image"),i||this.history.push(!1)},update_src:function(t,e,i){e.src=t,this._window.setTimeout(this.plugins.fileManager.setInfo.bind(this,"image",e,this.functions.onImageUpload,i,!0)),this.selectComponent(e,"image")},onModifyMode:function(t,e){if(!t)return;const i=this.context.image;i.linkElement=i.anchorCtx.linkAnchor=/^A$/i.test(t.parentNode.nodeName)?t.parentNode:null,i.element=t,i.cover=this.util.getParentElement(t,"FIGURE"),i.container=this.util.getParentElement(t,this.util.isMediaComponent),i.caption=this.util.getChildElement(i.cover,"FIGCAPTION"),i.align=t.style.float||t.getAttribute("data-align")||"none",t.style.float="",this.plugins.anchor.setCtx(i.linkElement,i.anchorCtx),e&&(i.element_w=e.w,i.element_h=e.h,i.element_t=e.t,i.element_l=e.l);let n,l,o=i.element.getAttribute("data-size")||i.element.getAttribute("data-origin");o?(o=o.split(","),n=o[0],l=o[1]):e&&(n=e.w,l=e.h),i.origin_w=n||t.style.width||t.width||"",i.origin_h=l||t.style.height||t.height||""},openModify:function(t){const e=this.context.image;e.imgUrlFile&&(e.v_src.linkValue=e.previewSrc.textContent=e.imgUrlFile.value=e.element.src),e.altText.value=e.element.alt,e.modal.querySelector('input[name="exploreEditor_image_radio"][value="'+e.align+'"]').checked=!0,e.align=e.modal.querySelector('input[name="exploreEditor_image_radio"]:checked').value,e.captionChecked=e.captionCheckEl.checked=!!e.caption,e.resizing&&this.plugins.resizing.module_setModifyInputSize.call(this,e,this.plugins.image),t||this.plugins.dialog.open.call(this,"image",!0)},applySize:function(t,e){const i=this.context.image;return t||(t=i.inputX.value||this.options.imageWidth),e||(e=i.inputY.value||this.options.imageHeight),i.onlyPercentage&&t||/%$/.test(t)?(this.plugins.image.setPercentSize.call(this,t,e),!0):(t&&"auto"!==t||e&&"auto"!==e?this.plugins.image.setSize.call(this,t,e,!1):this.plugins.image.setAutoSize.call(this),!1)},sizeRevert:function(){this.plugins.resizing.module_sizeRevert.call(this,this.context.image)},setSize:function(t,e,i,n){const l=this.context.image,o=/^(rw|lw)$/.test(n);/^(th|bh)$/.test(n)||(l.element.style.width=this.util.isNumber(t)?t+l.sizeUnit:t,this.plugins.image.cancelPercentAttr.call(this)),o||(l.element.style.height=this.util.isNumber(e)?e+l.sizeUnit:/%$/.test(e)?"":e),"center"===l.align&&this.plugins.image.setAlign.call(this,null,null,null,null),i||l.element.removeAttribute("data-percentage"),this.plugins.resizing.module_saveCurrentSize.call(this,l)},setAutoSize:function(){const t=this.context.image;this.plugins.resizing.resetTransform.call(this,t.element),this.plugins.image.cancelPercentAttr.call(this),t.element.style.maxWidth="",t.element.style.width="",t.element.style.height="",t.cover.style.width="",t.cover.style.height="",this.plugins.image.setAlign.call(this,null,null,null,null),t.element.setAttribute("data-percentage","auto,auto"),this.plugins.resizing.module_saveCurrentSize.call(this,t)},setOriginSize:function(){const t=this.context.image;t.element.removeAttribute("data-percentage"),this.plugins.resizing.resetTransform.call(this,t.element),this.plugins.image.cancelPercentAttr.call(this);const e=(t.element.getAttribute("data-origin")||"").split(","),i=e[0],n=e[1];e&&(t.onlyPercentage||/%$/.test(i)&&(/%$/.test(n)||!/\d/.test(n))?this.plugins.image.setPercentSize.call(this,i,n):this.plugins.image.setSize.call(this,i,n),this.plugins.resizing.module_saveCurrentSize.call(this,t))},setPercentSize:function(t,e){const i=this.context.image;e=!e||/%$/.test(e)||this.util.getNumber(e,0)?this.util.isNumber(e)?e+i.sizeUnit:e||"":this.util.isNumber(e)?e+"%":e;const n=/%$/.test(e);i.container.style.width=this.util.isNumber(t)?t+"%":t,i.container.style.height="",i.cover.style.width="100%",i.cover.style.height=n?e:"",i.element.style.width="100%",i.element.style.height=n?"":e,i.element.style.maxWidth="","center"===i.align&&this.plugins.image.setAlign.call(this,null,null,null,null),i.element.setAttribute("data-percentage",t+","+e),this.plugins.resizing.setCaptionPosition.call(this,i.element),this.plugins.resizing.module_saveCurrentSize.call(this,i)},cancelPercentAttr:function(){const t=this.context.image;t.cover.style.width="",t.cover.style.height="",t.container.style.width="",t.container.style.height="",this.util.removeClass(t.container,this.context.image.floatClassRegExp),this.util.addClass(t.container,"__meta__float-"+t.align),"center"===t.align&&this.plugins.image.setAlign.call(this,null,null,null,null)},setAlign:function(t,e,i,n){const l=this.context.image;t||(t=l.align),e||(e=l.element),i||(i=l.cover),n||(n=l.container),i.style.margin=t&&"none"!==t?"auto":"0",/%$/.test(e.style.width)&&"center"===t?(n.style.minWidth="100%",i.style.width=n.style.width):(n.style.minWidth="",i.style.width=this.context.resizing.rotateVertical?e.style.height||e.offsetHeight:e.style.width&&"auto"!==e.style.width?e.style.width||"100%":""),this.util.hasClass(n,"__meta__float-"+t)||(this.util.removeClass(n,l.floatClassRegExp),this.util.addClass(n,"__meta__float-"+t)),e.setAttribute("data-align",t)},init:function(){const t=this.context.image;t.imgInputFile&&(t.imgInputFile.value=""),t.imgUrlFile&&(t.v_src.linkValue=t.previewSrc.textContent=t.imgUrlFile.value=""),t.imgInputFile&&t.imgUrlFile&&(t.imgUrlFile.removeAttribute("disabled"),t.previewSrc.style.textDecoration=""),t.altText.value="",t.modal.querySelector('input[name="exploreEditor_image_radio"][value="none"]').checked=!0,t.captionCheckEl.checked=!1,t.element=null,this.plugins.image.openTab.call(this,"init"),t.resizing&&(t.inputX.value=this.options.imageWidth===t.defaultSizeX?"":this.options.imageWidth,t.inputY.value=this.options.imageHeight===t.defaultSizeY?"":this.options.imageHeight,t.proportion.checked=!0,t.ratio=!1,t.ratioX=1,t.ratioY=1),this.plugins.anchor.init.call(this,t.anchorCtx)}},v={name:"video",display:"dialog",add:function(t){t.addModule([u,p,g,f]);const e=t.options,i=t.context,n=i.video={infoList:[],infoIndex:0,uploadFileLength:0,focusElement:null,sizeUnit:e.videoSizeUnit,align:"none",floatClassRegExp:"__meta__float\\-[a-z]+",youtubeQuery:e.youtubeQuery,videoRatio:100*e.videoRatio+"%",defaultRatio:100*e.videoRatio+"%",linkValue:"",element:null,cover:null,container:null,inputX:null,inputY:null,element_w:1,element_h:1,element_l:0,element_t:0,defaultSizeX:"100%",defaultSizeY:100*e.videoRatio+"%",origin_w:"100%"===e.videoWidth?"":e.videoWidth,origin_h:"56.25%"===e.videoHeight?"":e.videoHeight,proportionChecked:!0,resizing:e.videoResizing,resizeDotHide:!e.videoHeightShow,rotation:e.videoRotation,onlyPercentage:e.videoSizeOnlyPercentage,ratio:!1,ratioX:1,ratioY:1,captionShow:!1};let l=this.setDialog(t);n.modal=l,n.videoInputFile=l.querySelector("._meta_video_file"),n.videoUrlFile=l.querySelector(".meta-input-url"),n.focusElement=n.videoUrlFile||n.videoInputFile,n.preview=l.querySelector(".meta-link-preview"),l.querySelector("form").addEventListener("submit",this.submit.bind(t)),n.videoInputFile&&l.querySelector(".meta-dialog-files-edge-button").addEventListener("click",this.removeSelectedFiles.bind(n.videoInputFile,n.videoUrlFile,n.preview)),n.videoInputFile&&n.videoUrlFile&&n.videoInputFile.addEventListener("change",this.fileInputChange.bind(n)),n.videoUrlFile&&n.videoUrlFile.addEventListener("input",this.onLinkPreview.bind(n.preview,n,e.linkProtocol)),n.proportion={},n.videoRatioOption={},n.inputX={},n.inputY={},e.videoResizing&&(n.proportion=l.querySelector("._meta_video_check_proportion"),n.videoRatioOption=l.querySelector(".meta-video-ratio"),n.inputX=l.querySelector("._meta_video_size_x"),n.inputY=l.querySelector("._meta_video_size_y"),n.inputX.value=e.videoWidth,n.inputY.value=e.videoHeight,n.inputX.addEventListener("keyup",this.setInputSize.bind(t,"x")),n.inputY.addEventListener("keyup",this.setInputSize.bind(t,"y")),n.inputX.addEventListener("change",this.setRatio.bind(t)),n.inputY.addEventListener("change",this.setRatio.bind(t)),n.proportion.addEventListener("change",this.setRatio.bind(t)),n.videoRatioOption.addEventListener("change",this.setVideoRatio.bind(t)),l.querySelector(".meta-dialog-btn-revert").addEventListener("click",this.sizeRevert.bind(t))),i.dialog.modal.appendChild(l),l=null},setDialog:function(t){const e=t.options,i=t.lang,n=t.util.createElement("DIV");n.className="meta-dialog-content",n.style.display="none";let l='<form method="post" enctype="multipart/form-data"><div class="meta-dialog-header"><button type="button" data-command="close" class="meta-btn meta-dialog-close" aria-label="Close" title="'+i.dialogBox.close+'">'+t.icons.cancel+'</button><span class="meta-modal-title">'+i.dialogBox.videoBox.title+'</span></div><div class="meta-dialog-body">';if(e.videoFileInput&&(l+='<div class="meta-dialog-form"><label>'+i.dialogBox.videoBox.file+'</label><div class="meta-dialog-form-files"><input class="meta-input-form _meta_video_file" type="file" accept="'+e.videoAccept+'"'+(e.videoMultipleFile?' multiple="multiple"':"")+'/><button type="button" data-command="filesRemove" class="meta-btn meta-dialog-files-edge-button meta-file-remove" title="'+i.controller.remove+'">'+t.icons.cancel+"</button></div></div>"),e.videoUrlInput&&(l+='<div class="meta-dialog-form"><label>'+i.dialogBox.videoBox.url+'</label><input class="meta-input-form meta-input-url" type="text" /><pre class="meta-link-preview"></pre></div>'),e.videoResizing){const n=e.videoRatioList||[{name:"16:9",value:.5625},{name:"4:3",value:.75},{name:"21:9",value:.4285}],o=e.videoRatio,s=e.videoSizeOnlyPercentage,a=s?' style="display: none !important;"':"",r=e.videoHeightShow?"":' style="display: none !important;"',c=e.videoRatioShow?"":' style="display: none !important;"',u=s||e.videoHeightShow||e.videoRatioShow?"":' style="display: none !important;"';l+='<div class="meta-dialog-form"><div class="meta-dialog-size-text"><label class="size-w">'+i.dialogBox.width+'</label><label class="meta-dialog-size-x">&nbsp;</label><label class="size-h"'+r+">"+i.dialogBox.height+'</label><label class="size-h"'+c+">("+i.dialogBox.ratio+')</label></div><input class="meta-input-control _meta_video_size_x" placeholder="100%"'+(s?' type="number" min="1"':'type="text"')+(s?' max="100"':"")+'/><label class="meta-dialog-size-x"'+u+">"+(s?"%":"x")+'</label><input class="meta-input-control _meta_video_size_y" placeholder="'+100*e.videoRatio+'%"'+(s?' type="number" min="1"':'type="text"')+(s?' max="100"':"")+r+'/><select class="meta-input-select meta-video-ratio" title="'+i.dialogBox.ratio+'"'+c+">",r||(l+='<option value=""> - </option>');for(let t=0,e=n.length;t<e;t++)l+='<option value="'+n[t].value+'"'+(o.toString()===n[t].value.toString()?" selected":"")+">"+n[t].name+"</option>";l+='</select><button type="button" title="'+i.dialogBox.revertButton+'" class="meta-btn meta-dialog-btn-revert" style="float: right;">'+t.icons.revert+'</button></div><div class="meta-dialog-form meta-dialog-form-footer"'+a+u+'><label><input type="checkbox" class="meta-dialog-btn-check _meta_video_check_proportion" checked/>&nbsp;'+i.dialogBox.proportion+"</label></div>"}return l+='</div><div class="meta-dialog-footer"><div><label><input type="radio" name="exploreEditor_video_radio" class="meta-dialog-btn-radio" value="none" checked>'+i.dialogBox.basic+'</label><label><input type="radio" name="exploreEditor_video_radio" class="meta-dialog-btn-radio" value="left">'+i.dialogBox.left+'</label><label><input type="radio" name="exploreEditor_video_radio" class="meta-dialog-btn-radio" value="center">'+i.dialogBox.center+'</label><label><input type="radio" name="exploreEditor_video_radio" class="meta-dialog-btn-radio" value="right">'+i.dialogBox.right+'</label></div><button type="submit" class="meta-btn-primary" title="'+i.dialogBox.submitButton+'"><span>'+i.dialogBox.submitButton+"</span></button></div></form>",n.innerHTML=l,n},fileInputChange:function(){this.videoInputFile.value?(this.videoUrlFile.setAttribute("disabled",!0),this.preview.style.textDecoration="line-through"):(this.videoUrlFile.removeAttribute("disabled"),this.preview.style.textDecoration="")},removeSelectedFiles(t,e){this.value="",t&&(t.removeAttribute("disabled"),e.style.textDecoration="")},onLinkPreview(t,e,i){const n=i.target.value.trim();/^<iframe.*\/iframe>$/.test(n)?(t.linkValue=n,this.textContent='<IFrame :src=".."></IFrame>'):t.linkValue=this.textContent=n?e&&-1===n.indexOf("://")&&0!==n.indexOf("#")?e+n:-1===n.indexOf("://")?"/"+n:n:""},setTagAttrs:function(t){t.setAttribute("controls",!0);const e=this.options.videoTagAttrs;if(e)for(const i in e)this.util.hasOwn(e,i)&&t.setAttribute(i,e[i])},createVideoTag:function(){const t=this.util.createElement("VIDEO");return this.plugins.video.setTagAttrs.call(this,t),t},setIframeAttrs:function(t){t.frameBorder="0",t.allowFullscreen=!0;const e=this.options.videoIframeAttrs;if(e)for(const i in e)this.util.hasOwn(e,i)&&t.setAttribute(i,e[i])},createIframeTag:function(){const t=this.util.createElement("IFRAME");return this.plugins.video.setIframeAttrs.call(this,t),t},fileTags:["iframe","video"],select:function(t){this.plugins.video.onModifyMode.call(this,t,this.plugins.resizing.call_controller_resize.call(this,t,"video"))},destroy:function(t){const e=t||this.context.video.element,i=this.context.video.container,n=1*e.getAttribute("data-index"),l=i.previousElementSibling||i.nextElementSibling,o=i.parentNode;this.util.removeItem(i),this.plugins.video.init.call(this),this.controllersOff(),o!==this.context.element.wysiwyg&&this.util.removeItemAllParents(o,(function(t){return 0===t.childNodes.length}),null),this.focusEdge(l),this.plugins.fileManager.deleteInfo.call(this,"video",n,this.functions.onVideoUpload),this.history.push(!1)},on:function(t){const e=this.context.video;t?e.videoInputFile&&this.options.videoMultipleFile&&e.videoInputFile.removeAttribute("multiple"):(e.inputX.value=e.origin_w=this.options.videoWidth===e.defaultSizeX?"":this.options.videoWidth,e.inputY.value=e.origin_h=this.options.videoHeight===e.defaultSizeY?"":this.options.videoHeight,e.proportion.disabled=!0,e.videoInputFile&&this.options.videoMultipleFile&&e.videoInputFile.setAttribute("multiple","multiple")),e.resizing&&this.plugins.video.setVideoRatioSelect.call(this,e.origin_h||e.defaultRatio)},open:function(){this.plugins.dialog.open.call(this,"video","video"===this.currentControllerName)},setVideoRatio:function(t){const e=this.context.video,i=t.target.options[t.target.selectedIndex].value;e.defaultSizeY=e.videoRatio=i?100*i+"%":e.defaultSizeY,e.inputY.placeholder=i?100*i+"%":"",e.inputY.value=""},setInputSize:function(t,e){if(e&&32===e.keyCode)return void e.preventDefault();const i=this.context.video;this.plugins.resizing.module_setInputSize.call(this,i,t),"y"===t&&this.plugins.video.setVideoRatioSelect.call(this,e.target.value||i.defaultRatio)},setRatio:function(){this.plugins.resizing.module_setRatio.call(this,this.context.video)},submit:function(t){const e=this.context.video,i=this.plugins.video;t.preventDefault(),t.stopPropagation(),e.align=e.modal.querySelector('input[name="exploreEditor_video_radio"]:checked').value;try{e.videoInputFile&&e.videoInputFile.files.length>0?(this.showLoading(),i.submitAction.call(this,this.context.video.videoInputFile.files)):e.videoUrlFile&&e.linkValue.length>0&&(this.showLoading(),i.setup_url.call(this))}catch(n){throw this.closeLoading(),Error('[ExploreEditor.video.submit.fail] cause : "'+n.message+'"')}finally{this.plugins.dialog.close.call(this)}return!1},submitAction:function(t){if(0===t.length)return;let e=0,i=[];for(let s=0,a=t.length;s<a;s++)/video/i.test(t[s].type)&&(i.push(t[s]),e+=t[s].size);const n=this.options.videoUploadSizeLimit;if(n>0){let t=0;const i=this.context.video.infoList;for(let e=0,n=i.length;e<n;e++)t+=1*i[e].size;if(e+t>n){this.closeLoading();const i="[ExploreEditor.videoUpload.fail] Size of uploadable total videos: "+n/1e3+"KB";return void(("function"!==typeof this.functions.onVideoUploadError||this.functions.onVideoUploadError(i,{limitSize:n,currentSize:t,uploadSize:e},this))&&this.functions.noticeOpen(i))}}const l=this.context.video;l.uploadFileLength=i.length;const o={inputWidth:l.inputX.value,inputHeight:l.inputY.value,align:l.align,isUpdate:this.context.dialog.updateModal,element:l.element};if("function"===typeof this.functions.onVideoUploadBefore){const t=this.functions.onVideoUploadBefore(i,o,this,function(t){t&&this._window.Array.isArray(t.result)?this.plugins.video.register.call(this,o,t):this.plugins.video.upload.call(this,o,t)}.bind(this));if("undefined"===typeof t)return;if(!t)return void this.closeLoading();"object"===typeof t&&t.length>0&&(i=t)}this.plugins.video.upload.call(this,o,i)},error:function(t,e){if(this.closeLoading(),"function"!==typeof this.functions.onVideoUploadError||this.functions.onVideoUploadError(t,e,this))throw this.functions.noticeOpen(t),Error("[ExploreEditor.plugin.video.error] response: "+t)},upload:function(t,e){if(!e)return void this.closeLoading();if("string"===typeof e)return void this.plugins.video.error.call(this,e,null);const i=this.options.videoUploadUrl,n=this.context.dialog.updateModal?1:e.length;if(!("string"===typeof i&&i.length>0))throw Error('[ExploreEditor.videoUpload.fail] cause : There is no "videoUploadUrl" option.');{const l=new FormData;for(let t=0;t<n;t++)l.append("file-"+t,e[t]);this.plugins.fileManager.upload.call(this,i,this.options.videoUploadHeader,l,this.plugins.video.callBack_videoUpload.bind(this,t),this.functions.onVideoUploadError)}},callBack_videoUpload:function(t,e){if("function"===typeof this.functions.videoUploadHandler)this.functions.videoUploadHandler(e,t,this);else{const i=this.util.isJsonStr(e.responseText)?JSON.parse(e.responseText):e.responseText;i.errorMessage?this.plugins.video.error.call(this,i.errorMessage,i):this.plugins.video.register.call(this,t,i)}},register:function(t,e){const i=e.result,n=this.plugins.video.createVideoTag.call(this);for(let l,o=0,s=i.length;o<s;o++)l={name:i[o].name,size:i[o].size},this.plugins.video.create_video.call(this,t.isUpdate?t.element:n.cloneNode(!1),i[o].url,t.inputWidth,t.inputHeight,t.align,l,t.isUpdate);this.closeLoading()},setup_url:function(){try{const t=this.context.video;let e=t.linkValue;if(0===e.length)return!1;if(/^<iframe.*\/iframe>$/.test(e)){if(e=(new this._window.DOMParser).parseFromString(e,"text/html").querySelector("iframe").src,0===e.length)return!1}if(/youtu\.?be/.test(e)){if(/^http/.test(e)||(e="https://"+e),e=e.replace("watch?v=",""),/^\/\/.+\/embed\//.test(e)||(e=e.replace(e.match(/\/\/.+\//)[0],"//www.youtube.com/embed/").replace("&","?&")),t.youtubeQuery.length>0)if(/\?/.test(e)){const i=e.split("?");e=i[0]+"?"+t.youtubeQuery+"&"+i[1]}else e+="?"+t.youtubeQuery}else/vimeo\.com/.test(e)&&(e.endsWith("/")&&(e=e.slice(0,-1)),e="https://player.vimeo.com/video/"+e.slice(e.lastIndexOf("/")+1));this.plugins.video.create_video.call(this,this.plugins.video.createIframeTag.call(this),e,t.inputX.value,t.inputY.value,t.align,null,this.context.dialog.updateModal)}catch(t){throw Error('[ExploreEditor.video.upload.fail] cause : "'+t.message+'"')}finally{this.closeLoading()}},create_video:function(t,e,i,n,l,o,s){this.context.resizing.resize_plugin="video";const a=this.context.video;let r=null,c=null,u=!1;if(s){if((t=a.element).src!==e){u=!0;const i=/youtu\.?be/.test(e),n=/vimeo\.com/.test(e);if(!i&&!n||/^iframe$/i.test(t.nodeName))if(i||n||/^videoo$/i.test(t.nodeName))t.src=e;else{const i=this.plugins.video.createVideoTag.call(this);i.src=e,t.parentNode.replaceChild(i,t),a.element=t=i}else{const i=this.plugins.video.createIframeTag.call(this);i.src=e,t.parentNode.replaceChild(i,t),a.element=t=i}}c=a.container,r=this.util.getParentElement(t,"FIGURE")}else u=!0,t.src=e,a.element=t,r=this.plugins.component.set_cover.call(this,t),c=this.plugins.component.set_container.call(this,r,"meta-video-container");a.cover=r,a.container=c;const d=this.plugins.resizing.module_getSizeX.call(this,a)!==(i||a.defaultSizeX)||this.plugins.resizing.module_getSizeY.call(this,a)!==(n||a.videoRatio),h=!s||d;a.resizing&&(this.context.video.proportionChecked=a.proportion.checked,t.setAttribute("data-proportion",a.proportionChecked));let m=!1;h&&(m=this.plugins.video.applySize.call(this)),m&&"center"===l||this.plugins.video.setAlign.call(this,null,t,r,c);let p=!0;if(s)a.resizing&&this.context.resizing.rotateVertical&&h&&this.plugins.resizing.setTransformSize.call(this,t,null,null);else if(p=this.insertComponent(c,!1,!0,!this.options.mediaAutoSelect),!this.options.mediaAutoSelect){const t=this.appendFormatTag(c,null);this.setRange(t,0,t,0)}p&&(u&&this.plugins.fileManager.setInfo.call(this,"video",t,this.functions.onVideoUpload,o,!0),s&&(this.selectComponent(t,"video"),this.history.push(!1))),this.context.resizing.resize_plugin=""},update_videoCover:function(t){if(!t)return;const e=this.context.video;/^video$/i.test(t.nodeName)?this.plugins.video.setTagAttrs.call(this,t):this.plugins.video.setIframeAttrs.call(this,t);const i=this.util.getParentElement(t,this.util.isMediaComponent)||this.util.getParentElement(t,function(t){return this.isWysiwygDiv(t.parentNode)}.bind(this.util)),n=t;e.element=t=t.cloneNode(!0);const l=e.cover=this.plugins.component.set_cover.call(this,t),o=e.container=this.plugins.component.set_container.call(this,l,"meta-video-container");try{const s=i.querySelector("figcaption");let a=null;s&&(a=this.util.createElement("DIV"),a.innerHTML=s.innerHTML,this.util.removeItem(s));const r=(t.getAttribute("data-size")||t.getAttribute("data-origin")||"").split(",");this.plugins.video.applySize.call(this,r[0]||n.style.width||n.width||"",r[1]||n.style.height||n.height||"");const c=this.util.getFormatElement(n);c&&(e.align=c.style.textAlign||c.style.float),this.plugins.video.setAlign.call(this,null,t,l,o),this.util.isFormatElement(i)&&i.childNodes.length>0?(i.parentNode.insertBefore(o,i),this.util.removeItem(n),this.util.removeEmptyNode(i,null),0===i.children.length&&(i.innerHTML=this.util.htmlRemoveWhiteSpace(i.innerHTML))):i.parentNode.replaceChild(o,i),a&&i.parentNode.insertBefore(a,o.nextElementSibling)}catch(s){console.warn("[ExploreEditor.video.error] Maybe the video tag is nested.",s)}this.plugins.fileManager.setInfo.call(this,"video",t,this.functions.onVideoUpload,null,!0)},onModifyMode:function(t,e){const i=this.context.video;i.element=t,i.cover=this.util.getParentElement(t,"FIGURE"),i.container=this.util.getParentElement(t,this.util.isMediaComponent),i.align=t.style.float||t.getAttribute("data-align")||"none",t.style.float="",e&&(i.element_w=e.w,i.element_h=e.h,i.element_t=e.t,i.element_l=e.l);let n,l,o=i.element.getAttribute("data-size")||i.element.getAttribute("data-origin");o?(o=o.split(","),n=o[0],l=o[1]):e&&(n=e.w,l=e.h),i.origin_w=n||t.style.width||t.width||"",i.origin_h=l||t.style.height||t.height||""},openModify:function(t){const e=this.context.video;if(e.videoUrlFile&&(e.linkValue=e.preview.textContent=e.videoUrlFile.value=e.element.src||(e.element.querySelector("source")||"").src||""),e.modal.querySelector('input[name="exploreEditor_video_radio"][value="'+e.align+'"]').checked=!0,e.resizing){this.plugins.resizing.module_setModifyInputSize.call(this,e,this.plugins.video);const t=e.videoRatio=this.plugins.resizing.module_getSizeY.call(this,e);this.plugins.video.setVideoRatioSelect.call(this,t)||(e.inputY.value=e.onlyPercentage?this.util.getNumber(t,2):t)}t||this.plugins.dialog.open.call(this,"video",!0)},setVideoRatioSelect:function(t){let e=!1;const i=this.context.video,n=i.videoRatioOption.options;/%$/.test(t)||i.onlyPercentage?t=this.util.getNumber(t,2)/100+"":(!this.util.isNumber(t)||1*t>=1)&&(t=""),i.inputY.placeholder="";for(let l=0,o=n.length;l<o;l++)n[l].value===t?(e=n[l].selected=!0,i.inputY.placeholder=t?100*t+"%":""):n[l].selected=!1;return e},checkFileInfo:function(){this.plugins.fileManager.checkInfo.call(this,"video",["iframe","video"],this.functions.onVideoUpload,this.plugins.video.update_videoCover.bind(this),!0)},resetFileInfo:function(){this.plugins.fileManager.resetInfo.call(this,"video",this.functions.onVideoUpload)},applySize:function(t,e){const i=this.context.video;return t||(t=i.inputX.value||this.options.videoWidth),e||(e=i.inputY.value||this.options.videoHeight),i.onlyPercentage||/%$/.test(t)||!t?(this.plugins.video.setPercentSize.call(this,t||"100%",e||(/%$/.test(i.videoRatio)?i.videoRatio:i.defaultRatio)),!0):(t&&"auto"!==t||e&&"auto"!==e?this.plugins.video.setSize.call(this,t,e||i.videoRatio||i.defaultRatio,!1):this.plugins.video.setAutoSize.call(this),!1)},sizeRevert:function(){this.plugins.resizing.module_sizeRevert.call(this,this.context.video)},setSize:function(t,e,i,n){const l=this.context.video,o=/^(rw|lw)$/.test(n),s=/^(th|bh)$/.test(n);s||(t=this.util.getNumber(t,0)),o||(e=this.util.isNumber(e)?e+l.sizeUnit:e||""),s||(l.element.style.width=t?t+l.sizeUnit:""),o||(l.cover.style.paddingBottom=l.cover.style.height=e),s||/%$/.test(t)||(l.cover.style.width="",l.container.style.width=""),o||/%$/.test(e)?l.element.style.height="":l.element.style.height=e,i||l.element.removeAttribute("data-percentage"),this.plugins.resizing.module_saveCurrentSize.call(this,l)},setAutoSize:function(){this.plugins.video.setPercentSize.call(this,100,this.context.video.defaultRatio)},setOriginSize:function(t){const e=this.context.video;e.element.removeAttribute("data-percentage"),this.plugins.resizing.resetTransform.call(this,e.element),this.plugins.video.cancelPercentAttr.call(this);const i=((t?e.element.getAttribute("data-size"):"")||e.element.getAttribute("data-origin")||"").split(",");if(i){const t=i[0],n=i[1];e.onlyPercentage||/%$/.test(t)&&(/%$/.test(n)||!/\d/.test(n))?this.plugins.video.setPercentSize.call(this,t,n):this.plugins.video.setSize.call(this,t,n),this.plugins.resizing.module_saveCurrentSize.call(this,e)}},setPercentSize:function(t,e){const i=this.context.video;e=!e||/%$/.test(e)||this.util.getNumber(e,0)?this.util.isNumber(e)?e+i.sizeUnit:e||i.defaultRatio:this.util.isNumber(e)?e+"%":e,i.container.style.width=this.util.isNumber(t)?t+"%":t,i.container.style.height="",i.cover.style.width="100%",i.cover.style.height=e,i.cover.style.paddingBottom=e,i.element.style.width="100%",i.element.style.height="100%",i.element.style.maxWidth="","center"===i.align&&this.plugins.video.setAlign.call(this,null,null,null,null),i.element.setAttribute("data-percentage",t+","+e),this.plugins.resizing.module_saveCurrentSize.call(this,i)},cancelPercentAttr:function(){const t=this.context.video;t.cover.style.width="",t.cover.style.height="",t.cover.style.paddingBottom="",t.container.style.width="",t.container.style.height="",this.util.removeClass(t.container,this.context.video.floatClassRegExp),this.util.addClass(t.container,"__meta__float-"+t.align),"center"===t.align&&this.plugins.video.setAlign.call(this,null,null,null,null)},setAlign:function(t,e,i,n){const l=this.context.video;t||(t=l.align),e||(e=l.element),i||(i=l.cover),n||(n=l.container),i.style.margin=t&&"none"!==t?"auto":"0",/%$/.test(e.style.width)&&"center"===t?(n.style.minWidth="100%",i.style.width=n.style.width,i.style.height=n.style.height,i.style.paddingBottom=/%$/.test(i.style.height)?this.util.getNumber(this.util.getNumber(i.style.height,2)/100*this.util.getNumber(i.style.width,2),2)+"%":i.style.height):(n.style.minWidth="",i.style.width=this.context.resizing.rotateVertical?e.style.height||e.offsetHeight:e.style.width||"100%",i.style.paddingBottom=i.style.height),this.util.hasClass(n,"__meta__float-"+t)||(this.util.removeClass(n,l.floatClassRegExp),this.util.addClass(n,"__meta__float-"+t)),e.setAttribute("data-align",t)},init:function(){const t=this.context.video;t.videoInputFile&&(t.videoInputFile.value=""),t.videoUrlFile&&(t.linkValue=t.preview.textContent=t.videoUrlFile.value=""),t.videoInputFile&&t.videoUrlFile&&(t.videoUrlFile.removeAttribute("disabled"),t.preview.style.textDecoration=""),t.origin_w=this.options.videoWidth,t.origin_h=this.options.videoHeight,t.modal.querySelector('input[name="exploreEditor_video_radio"][value="none"]').checked=!0,t.resizing&&(t.inputX.value=this.options.videoWidth===t.defaultSizeX?"":this.options.videoWidth,t.inputY.value=this.options.videoHeight===t.defaultSizeY?"":this.options.videoHeight,t.proportion.checked=!0,t.proportion.disabled=!0,this.plugins.video.setVideoRatioSelect.call(this,t.defaultRatio))}},y={name:"audio",display:"dialog",add:function(t){t.addModule([u,p,f]);const e=t.context,i=e.audio={infoList:[],infoIndex:0,uploadFileLength:0,focusElement:null,targetSelect:null,origin_w:t.options.audioWidth,origin_h:t.options.audioHeight,linkValue:"",element:null,cover:null,container:null};let n=this.setDialog(t);i.modal=n,i.audioInputFile=n.querySelector("._meta_audio_files"),i.audioUrlFile=n.querySelector(".meta-input-url"),i.focusElement=i.audioInputFile||i.audioUrlFile,i.preview=n.querySelector(".meta-link-preview");let l=this.setController(t);i.controller=l,n.querySelector("form").addEventListener("submit",this.submit.bind(t)),i.audioInputFile&&n.querySelector(".meta-dialog-files-edge-button").addEventListener("click",this.removeSelectedFiles.bind(i.audioInputFile,i.audioUrlFile,i.preview)),i.audioInputFile&&i.audioUrlFile&&i.audioInputFile.addEventListener("change",this.fileInputChange.bind(i)),l.addEventListener("click",this.onClick_controller.bind(t)),i.audioUrlFile&&i.audioUrlFile.addEventListener("input",this.onLinkPreview.bind(i.preview,i,t.options.linkProtocol)),e.dialog.modal.appendChild(n),e.element.relative.appendChild(l),n=null,l=null},setDialog:function(t){const e=t.options,i=t.lang,n=t.util.createElement("DIV");n.className="meta-dialog-content",n.style.display="none";let l='<form method="post" enctype="multipart/form-data"><div class="meta-dialog-header"><button type="button" data-command="close" class="meta-btn meta-dialog-close" aria-label="Close" title="'+i.dialogBox.close+'">'+t.icons.cancel+'</button><span class="meta-modal-title">'+i.dialogBox.audioBox.title+'</span></div><div class="meta-dialog-body">';return e.audioFileInput&&(l+='<div class="meta-dialog-form"><label>'+i.dialogBox.audioBox.file+'</label><div class="meta-dialog-form-files"><input class="meta-input-form _meta_audio_files" type="file" accept="'+e.audioAccept+'"'+(e.audioMultipleFile?' multiple="multiple"':"")+'/><button type="button" data-command="filesRemove" class="meta-btn meta-dialog-files-edge-button meta-file-remove" title="'+i.controller.remove+'">'+t.icons.cancel+"</button></div></div>"),e.audioUrlInput&&(l+='<div class="meta-dialog-form"><label>'+i.dialogBox.audioBox.url+'</label><input class="meta-input-form meta-input-url" type="text" /><pre class="meta-link-preview"></pre></div>'),l+='</div><div class="meta-dialog-footer"><button type="submit" class="meta-btn-primary" title="'+i.dialogBox.submitButton+'"><span>'+i.dialogBox.submitButton+"</span></button></div></form>",n.innerHTML=l,n},setController:function(t){const e=t.lang,i=t.icons,n=t.util.createElement("DIV");return n.className="meta-controller meta-controller-link",n.innerHTML='<div class="meta-arrow meta-arrow-up"></div><div class="link-content"><div class="meta-btn-group"><button type="button" data-command="update" tabindex="-1" class="meta-tooltip">'+i.edit+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.controller.edit+'</span></span></button><button type="button" data-command="delete" tabindex="-1" class="meta-tooltip">'+i.delete+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.controller.remove+"</span></span></button></div></div>",n},fileInputChange:function(){this.audioInputFile.value?(this.audioUrlFile.setAttribute("disabled",!0),this.preview.style.textDecoration="line-through"):(this.audioUrlFile.removeAttribute("disabled"),this.preview.style.textDecoration="")},removeSelectedFiles(t,e){this.value="",t&&(t.removeAttribute("disabled"),e.style.textDecoration="")},createAudioTag:function(){const t=this.util.createElement("AUDIO");this.plugins.audio.setTagAttrs.call(this,t);const e=this.context.audio.origin_w,i=this.context.audio.origin_h;return t.setAttribute("origin-size",e+","+i),t.style.cssText=(e?"width:"+e+"; ":"")+(i?"height:"+i+";":""),t},setTagAttrs:function(t){t.setAttribute("controls",!0);const e=this.options.audioTagAttrs;if(e)for(const i in e)this.util.hasOwn(e,i)&&t.setAttribute(i,e[i])},onLinkPreview(t,e,i){const n=i.target.value.trim();t.linkValue=this.textContent=n?e&&-1===n.indexOf("://")&&0!==n.indexOf("#")?e+n:-1===n.indexOf("://")?"/"+n:n:""},fileTags:["audio"],select:function(t){this.plugins.audio.onModifyMode.call(this,t)},destroy:function(t){t=t||this.context.audio.element;const e=this.util.getParentElement(t,this.util.isComponent)||t,i=1*t.getAttribute("data-index"),n=e.previousElementSibling||e.nextElementSibling,l=e.parentNode;this.util.removeItem(e),this.plugins.audio.init.call(this),this.controllersOff(),l!==this.context.element.wysiwyg&&this.util.removeItemAllParents(l,(function(t){return 0===t.childNodes.length}),null),this.focusEdge(n),this.plugins.fileManager.deleteInfo.call(this,"audio",i,this.functions.onAudioUpload),this.history.push(!1)},checkFileInfo:function(){this.plugins.fileManager.checkInfo.call(this,"audio",["audio"],this.functions.onAudioUpload,this.plugins.audio.updateCover.bind(this),!1)},resetFileInfo:function(){this.plugins.fileManager.resetInfo.call(this,"audio",this.functions.onAudioUpload)},on:function(t){const e=this.context.audio;t?e.element?(this.context.dialog.updateModal=!0,e.linkValue=e.preview.textContent=e.audioUrlFile.value=e.element.src,e.audioInputFile&&this.options.audioMultipleFile&&e.audioInputFile.removeAttribute("multiple")):e.audioInputFile&&this.options.audioMultipleFile&&e.audioInputFile.removeAttribute("multiple"):(this.plugins.audio.init.call(this),e.audioInputFile&&this.options.audioMultipleFile&&e.audioInputFile.setAttribute("multiple","multiple"))},open:function(){this.plugins.dialog.open.call(this,"audio","audio"===this.currentControllerName)},submit:function(t){const e=this.context.audio;t.preventDefault(),t.stopPropagation();try{e.audioInputFile&&e.audioInputFile.files.length>0?(this.showLoading(),this.plugins.audio.submitAction.call(this,e.audioInputFile.files)):e.audioUrlFile&&e.linkValue.length>0&&(this.showLoading(),this.plugins.audio.setupUrl.call(this,e.linkValue))}catch(i){throw this.closeLoading(),Error('[ExploreEditor.audio.submit.fail] cause : "'+i.message+'"')}finally{this.plugins.dialog.close.call(this)}return!1},submitAction:function(t){if(0===t.length)return;let e=0,i=[];for(let s=0,a=t.length;s<a;s++)/audio/i.test(t[s].type)&&(i.push(t[s]),e+=t[s].size);const n=this.options.audioUploadSizeLimit;if(n>0){let t=0;const i=this.context.audio.infoList;for(let e=0,n=i.length;e<n;e++)t+=1*i[e].size;if(e+t>n){this.closeLoading();const i="[ExploreEditor.audioUpload.fail] Size of uploadable total audios: "+n/1e3+"KB";return void(("function"!==typeof this.functions.onAudioUploadError||this.functions.onAudioUploadError(i,{limitSize:n,currentSize:t,uploadSize:e},this))&&this.functions.noticeOpen(i))}}const l=this.context.audio;l.uploadFileLength=i.length;const o={isUpdate:this.context.dialog.updateModal,element:l.element};if("function"===typeof this.functions.onAudioUploadBefore){const t=this.functions.onAudioUploadBefore(i,o,this,function(t){t&&this._window.Array.isArray(t.result)?this.plugins.audio.register.call(this,o,t):this.plugins.audio.upload.call(this,o,t)}.bind(this));if("undefined"===typeof t)return;if(!t)return void this.closeLoading();"object"===typeof t&&t.length>0&&(i=t)}this.plugins.audio.upload.call(this,o,i)},error:function(t,e){if(this.closeLoading(),"function"!==typeof this.functions.onAudioUploadError||this.functions.onAudioUploadError(t,e,this))throw this.functions.noticeOpen(t),Error("[ExploreEditor.plugin.audio.exception] response: "+t)},upload:function(t,e){if(!e)return void this.closeLoading();if("string"===typeof e)return void this.plugins.audio.error.call(this,e,null);const i=this.options.audioUploadUrl,n=this.context.dialog.updateModal?1:e.length,l=new FormData;for(let o=0;o<n;o++)l.append("file-"+o,e[o]);this.plugins.fileManager.upload.call(this,i,this.options.audioUploadHeader,l,this.plugins.audio.callBack_upload.bind(this,t),this.functions.onAudioUploadError)},callBack_upload:function(t,e){if("function"===typeof this.functions.audioUploadHandler)this.functions.audioUploadHandler(e,t,this);else{const i=this.util.isJsonStr(e.responseText)?JSON.parse(e.responseText):e.responseText;i.errorMessage?this.plugins.audio.error.call(this,i.errorMessage,i):this.plugins.audio.register.call(this,t,i)}},register:function(t,e){const i=e.result;for(let n,l,o=0,s=i.length;o<s;o++)l=t.isUpdate?t.element:this.plugins.audio.createAudioTag.call(this),n={name:i[o].name,size:i[o].size},this.plugins.audio.create_audio.call(this,l,i[o].url,n,t.isUpdate);this.closeLoading()},setupUrl:function(t){try{if(0===t.length)return!1;this.plugins.audio.create_audio.call(this,this.plugins.audio.createAudioTag.call(this),t,null,this.context.dialog.updateModal)}catch(e){throw Error('[ExploreEditor.audio.audio.fail] cause : "'+e.message+'"')}finally{this.closeLoading()}},create_audio:function(t,e,i,n){const l=this.context.audio;if(n){if(l.element&&(t=l.element),!t||t.src===e)return void this.selectComponent(t,"audio");t.src=e,this.selectComponent(t,"audio")}else{t.src=e;const i=this.plugins.component.set_cover.call(this,t),n=this.plugins.component.set_container.call(this,i,"");if(!this.insertComponent(n,!1,!0,!this.options.mediaAutoSelect))return void this.focus();if(!this.options.mediaAutoSelect){const t=this.appendFormatTag(n,null);this.setRange(t,0,t,0)}}this.plugins.fileManager.setInfo.call(this,"audio",t,this.functions.onAudioUpload,i,!1),n&&this.history.push(!1)},updateCover:function(t){const e=this.context.audio;this.plugins.audio.setTagAttrs.call(this,t);const i=this.util.getParentElement(t,this.util.isMediaComponent)||this.util.getParentElement(t,function(t){return this.isWysiwygDiv(t.parentNode)}.bind(this.util)),n=t;e.element=t=t.cloneNode(!1);const l=this.plugins.component.set_cover.call(this,t),o=this.plugins.component.set_container.call(this,l,"meta-audio-container");try{this.util.isFormatElement(i)&&i.childNodes.length>0?(i.parentNode.insertBefore(o,i),this.util.removeItem(n),this.util.removeEmptyNode(i,null),0===i.children.length&&(i.innerHTML=this.util.htmlRemoveWhiteSpace(i.innerHTML))):i.parentNode.replaceChild(o,i)}catch(s){console.warn("[ExploreEditor.audio.error] Maybe the audio tag is nested.",s)}this.plugins.fileManager.setInfo.call(this,"audio",t,this.functions.onAudioUpload,null,!1)},onModifyMode:function(t){const e=this.context.audio;this.setControllerPosition(e.controller,t,"bottom",{left:0,top:0}),this.controllersOn(e.controller,t,this.plugins.audio.onControllerOff.bind(this,t),"audio"),this.util.addClass(t,"active"),e.element=t,e.cover=this.util.getParentElement(t,"FIGURE"),e.container=this.util.getParentElement(t,this.util.isComponent)},openModify:function(t){if(this.context.audio.audioUrlFile){const t=this.context.audio;t.linkValue=t.preview.textContent=t.audioUrlFile.value=t.element.src}t||this.plugins.dialog.open.call(this,"audio",!0)},onClick_controller:function(t){t.stopPropagation();const e=t.target.getAttribute("data-command");e&&(t.preventDefault(),/update/.test(e)?this.plugins.audio.openModify.call(this,!1):this.plugins.audio.destroy.call(this,this.context.audio.element),this.controllersOff())},onControllerOff:function(t){this.util.removeClass(t,"active"),this.context.audio.controller.style.display="none"},init:function(){if(this.context.dialog.updateModal)return;const t=this.context.audio;t.audioInputFile&&(t.audioInputFile.value=""),t.audioUrlFile&&(t.linkValue=t.preview.textContent=t.audioUrlFile.value=""),t.audioInputFile&&t.audioUrlFile&&(t.audioUrlFile.removeAttribute("disabled"),t.preview.style.textDecoration=""),t.element=null}},x={name:"math",display:"dialog",add:function(t){t.addModule([u]);const e=t.context;e.math={focusElement:null,previewElement:null,fontSizeElement:null,defaultFontSize:"",mathExp:null};let i=this.setDialog(t);e.math.modal=i,e.math.focusElement=i.querySelector(".meta-math-exp"),e.math.previewElement=i.querySelector(".meta-math-preview"),e.math.fontSizeElement=i.querySelector(".meta-math-size"),e.math.focusElement.addEventListener("keyup",this.renderMathExp.bind(t,e.math),!1),e.math.focusElement.addEventListener("change",this.renderMathExp.bind(t,e.math),!1),e.math.fontSizeElement.addEventListener("change",function(t){this.fontSize=t.target.value}.bind(e.math.previewElement.style),!1);let n=this.setController_MathButton(t);e.math.mathController=n,e.math.mathExp=null,i.querySelector("form").addEventListener("submit",this.submit.bind(t),!1),n.addEventListener("click",this.onClick_mathController.bind(t)),e.math.previewElement.style.fontSize=e.math.defaultFontSize,e.dialog.modal.appendChild(i),e.element.relative.appendChild(n),i=null,n=null},setDialog:function(t){const e=t.lang,i=t.util.createElement("DIV"),n=t.options.mathFontSize;let l=n[0].value;i.className="meta-dialog-content",i.style.display="none";let o='<form><div class="meta-dialog-header"><button type="button" data-command="close" class="meta-btn meta-dialog-close" aria-label="Close" title="'+e.dialogBox.close+'">'+t.icons.cancel+'</button><span class="meta-modal-title">'+e.dialogBox.mathBox.title+'</span></div><div class="meta-dialog-body"><div class="meta-dialog-form"><label>'+e.dialogBox.mathBox.inputLabel+' (<a href="https://katex.org/docs/supported.html" target="_blank">KaTeX</a>)</label><textarea class="meta-input-form meta-math-exp" type="text"></textarea></div><div class="meta-dialog-form"><label>'+e.dialogBox.mathBox.fontSizeLabel+'</label><select class="meta-input-select meta-math-size">';for(let s,a=0,r=n.length;a<r;a++)s=n[a],s.default&&(l=s.value),o+='<option value="'+s.value+'"'+(s.default?" selected":"")+">"+s.text+"</option>";return o+='</select></div><div class="meta-dialog-form"><label>'+e.dialogBox.mathBox.previewLabel+'</label><p class="meta-math-preview"></p></div></div><div class="meta-dialog-footer"><button type="submit" class="meta-btn-primary" title="'+e.dialogBox.submitButton+'"><span>'+e.dialogBox.submitButton+"</span></button></div></form>",t.context.math.defaultFontSize=l,i.innerHTML=o,i},setController_MathButton:function(t){const e=t.lang,i=t.util.createElement("DIV");return i.className="meta-controller meta-controller-link",i.innerHTML='<div class="meta-arrow meta-arrow-up"></div><div class="link-content"><div class="meta-btn-group"><button type="button" data-command="update" tabindex="-1" class="meta-btn meta-tooltip">'+t.icons.edit+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.controller.edit+'</span></span></button><button type="button" data-command="delete" tabindex="-1" class="meta-btn meta-tooltip">'+t.icons.delete+'<span class="meta-tooltip-inner"><span class="meta-tooltip-text">'+e.controller.remove+"</span></span></button></div></div>",i},open:function(){this.plugins.dialog.open.call(this,"math","math"===this.currentControllerName)},managedTags:function(){return{className:"katex",method:function(t){if(!t.getAttribute("data-exp")||!this.options.katex)return;const e=this._document.createRange().createContextualFragment(this.plugins.math.render.call(this,this.util.HTMLDecoder(t.getAttribute("data-exp"))));t.innerHTML=e.querySelector(".katex").innerHTML}}},render:function(t){const e=this.options.katex;return e.src.renderToString(t,e.options)},renderMathExp:function(t,e){t.previewElement.innerHTML=this.plugins.math.render.call(this,e.target.value)},submit:function(t){this.showLoading(),t.preventDefault(),t.stopPropagation();const e=function(){if(0===this.context.math.focusElement.value.trim().length)return!1;const t=this.context.math,e=t.focusElement.value,i=t.previewElement.querySelector(".katex");if(!i)return!1;if(i.className="__meta__katex "+i.className,i.setAttribute("contenteditable",!1),i.setAttribute("data-exp",this.util.HTMLEncoder(e)),i.setAttribute("data-font-size",t.fontSizeElement.value),i.style.fontSize=t.fontSizeElement.value,this.context.dialog.updateModal){const e=this.util.getParentElement(t.mathExp,".katex");e.parentNode.replaceChild(i,e),this.setRange(i,0,i,1)}else{const t=this.getSelectedElements();if(t.length>1){const e=this.util.createElement(t[0].nodeName);if(e.appendChild(i),!this.insertNode(e,null,!0))return!1}else if(!this.insertNode(i,null,!0))return!1;const e=this.util.createTextNode(this.util.zeroWidthSpace);i.parentNode.insertBefore(e,i.nextSibling),this.setRange(i,0,i,1)}return t.focusElement.value="",t.fontSizeElement.value="1em",t.previewElement.style.fontSize="1em",t.previewElement.innerHTML="",!0}.bind(this);try{e()&&(this.plugins.dialog.close.call(this),this.history.push(!1))}catch(t){this.plugins.dialog.close.call(this)}finally{this.closeLoading()}return!1},active:function(t){if(t){if(t.getAttribute("data-exp"))return this.controllerArray.indexOf(this.context.math.mathController)<0&&(this.setRange(t,0,t,1),this.plugins.math.call_controller.call(this,t)),!0}else this.controllerArray.indexOf(this.context.math.mathController)>-1&&this.controllersOff();return!1},on:function(t){if(t){const t=this.context.math;if(t.mathExp){const e=this.util.HTMLDecoder(t.mathExp.getAttribute("data-exp")),i=t.mathExp.getAttribute("data-font-size")||"1em";this.context.dialog.updateModal=!0,t.focusElement.value=e,t.fontSizeElement.value=i,t.previewElement.innerHTML=this.plugins.math.render.call(this,e),t.previewElement.style.fontSize=i}}else this.plugins.math.init.call(this)},call_controller:function(t){this.context.math.mathExp=t;const e=this.context.math.mathController;this.setControllerPosition(e,t,"bottom",{left:0,top:0}),this.controllersOn(e,t,"math")},onClick_mathController:function(t){t.stopPropagation();const e=t.target.getAttribute("data-command")||t.target.parentNode.getAttribute("data-command");e&&(t.preventDefault(),/update/.test(e)?(this.context.math.focusElement.value=this.util.HTMLDecoder(this.context.math.mathExp.getAttribute("data-exp")),this.plugins.dialog.open.call(this,"math",!0)):(this.util.removeItem(this.context.math.mathExp),this.context.math.mathExp=null,this.focus(),this.history.push(!1)),this.controllersOff())},init:function(){const t=this.context.math;t.mathController.style.display="none",t.mathExp=null,t.focusElement.value="",t.previewElement.innerHTML=""}},_={name:"fileBrowser",xmlHttp:null,loading:null,add(t){const e=t.context;e.fileBrowser={closeSignal:!1,area:null,header:null,tagArea:null,body:null,list:null,tagElements:null,items:[],selectedTags:[],selectorHandler:null,contextPlugin:"",columnSize:4};let i=t.util.createElement("DIV");i.className="meta-file-browser meta-common";let n=t.util.createElement("DIV");n.className="meta-file-browser-back";let l=t.util.createElement("DIV");l.className="meta-file-browser-inner",l.innerHTML=this.set_browser(t),i.appendChild(n),i.appendChild(l),this.loading=i.querySelector(".meta-loading-box"),e.fileBrowser.area=i,e.fileBrowser.header=l.querySelector(".meta-file-browser-header"),e.fileBrowser.titleArea=l.querySelector(".meta-file-browser-title"),e.fileBrowser.tagArea=l.querySelector(".meta-file-browser-tags"),e.fileBrowser.body=l.querySelector(".meta-file-browser-body"),e.fileBrowser.list=l.querySelector(".meta-file-browser-list"),e.fileBrowser.tagArea.addEventListener("click",this.onClickTag.bind(t)),e.fileBrowser.list.addEventListener("click",this.onClickFile.bind(t)),l.addEventListener("mousedown",this.onMouseDown_browser.bind(t)),l.addEventListener("click",this.onClick_browser.bind(t)),e.element.relative.appendChild(i),i=null,n=null,l=null},set_browser:function(t){return'<div class="meta-file-browser-content"><div class="meta-file-browser-header"><button type="button" data-command="close" class="meta-btn meta-file-browser-close" class="close" aria-label="Close" title="'+t.lang.dialogBox.close+'">'+t.icons.cancel+'</button><span class="meta-file-browser-title"></span><div class="meta-file-browser-tags"></div></div><div class="meta-file-browser-body"><div class="meta-loading-box meta-common"><div class="meta-loading-effect"></div></div><div class="meta-file-browser-list"></div></div></div>'},onMouseDown_browser:function(t){/meta-file-browser-inner/.test(t.target.className)?this.context.fileBrowser.closeSignal=!0:this.context.fileBrowser.closeSignal=!1},onClick_browser:function(t){t.stopPropagation(),(/close/.test(t.target.getAttribute("data-command"))||this.context.fileBrowser.closeSignal)&&this.plugins.fileBrowser.close.call(this)},open:function(t,e){this.plugins.fileBrowser.bindClose&&(this._document.removeEventListener("keydown",this.plugins.fileBrowser.bindClose),this.plugins.fileBrowser.bindClose=null),this.plugins.fileBrowser.bindClose=function(t){/27/.test(t.keyCode)&&this.plugins.fileBrowser.close.call(this)}.bind(this),this._document.addEventListener("keydown",this.plugins.fileBrowser.bindClose);const i=this.context.fileBrowser;i.contextPlugin=t,i.selectorHandler=e;const n=this.context[t],l=n.listClass;this.util.hasClass(i.list,l)||(i.list.className="meta-file-browser-list "+l),"full"===this.options.popupDisplay?i.area.style.position="fixed":i.area.style.position="absolute",i.titleArea.textContent=n.title,i.area.style.display="block",this.plugins.fileBrowser.drawFileList.call(this,this.context[t].url,this.context[t].header)},bindClose:null,close:function(){const t=this.plugins.fileBrowser;t.xmlHttp&&t.xmlHttp.abort(),t.bindClose&&(this._document.removeEventListener("keydown",t.bindClose),t.bindClose=null);const e=this.context.fileBrowser;e.area.style.display="none",e.selectorHandler=null,e.selectedTags=[],e.items=[],e.list.innerHTML=e.tagArea.innerHTML=e.titleArea.textContent="","function"===typeof this.plugins[e.contextPlugin].init&&this.plugins[e.contextPlugin].init.call(this),e.contextPlugin=""},showBrowserLoading:function(){this.loading.style.display="block"},closeBrowserLoading:function(){this.loading.style.display="none"},drawFileList:function(t,e){const i=this.plugins.fileBrowser,n=i.xmlHttp=this.util.getXMLHttpRequest();if(n.onreadystatechange=i.callBackGet.bind(this,n),n.open("get",t,!0),null!==e&&"object"===typeof e&&this._window.Object.keys(e).length>0)for(const l in e)n.setRequestHeader(l,e[l]);n.send(null),this.plugins.fileBrowser.showBrowserLoading()},callBackGet:function(t){if(4===t.readyState)if(this.plugins.fileBrowser.xmlHttp=null,200===t.status)try{const e=this.util.isJsonStr(t.responseText)?JSON.parse(t.responseText)?.result:"";this.plugins.fileBrowser.drawListItem.call(this,e,!0)}catch(e){throw Error('[ExploreEditor.fileBrowser.drawList.fail] cause : "'+e.message+'"')}finally{this.plugins.fileBrowser.closeBrowserLoading(),this.context.fileBrowser.body.style.maxHeight=this._window.innerHeight-this.context.fileBrowser.header.offsetHeight-50+"px"}else if(this.plugins.fileBrowser.closeBrowserLoading(),0!==t.status){const e=this.util.isJsonStr(t.responseText)?JSON.parse(t.responseText):t.responseText,i=t.responseText?e:t,n="[ExploreEditor.fileBrowser.get.serverException] status: "+t.status+", response: "+(i.errorMessage||t.responseText);throw Error(n)}},drawListItem:function(t,e){const i=this.context.fileBrowser,n=this.context[i.contextPlugin],l=[],o=t.length,s=n.columnSize||i.columnSize,a=s<=1?1:Math.round(o/s)||1,r=n.itemTemplateHandler;let c="",u='<div class="meta-file-item-column">',d=1;for(let h,m,p=0;p<o;p++)if(h=t[p],m=h.tag?"string"===typeof h.tag?h.tag.split(","):h.tag:[],m=h.tag=m.map((function(t){return t.trim()})),u+=r(h),(p+1)%a===0&&d<s&&p+1<o&&(d++,u+='</div><div class="meta-file-item-column">'),e&&m.length>0)for(let t,e=0,i=m.length;e<i;e++)t=m[e],t&&-1===l.indexOf(t)&&(l.push(t),c+='<a title="'+t+'">'+t+"</a>");u+="</div>",i.list.innerHTML=u,e&&(i.items=t,i.tagArea.innerHTML=c,i.tagElements=i.tagArea.querySelectorAll("A"))},onClickTag:function(t){const e=t.target;if(!this.util.isAnchor(e))return;const i=e.textContent,n=this.plugins.fileBrowser,l=this.context.fileBrowser,o=l.tagArea.querySelector('a[title="'+i+'"]'),s=l.selectedTags,a=s.indexOf(i);a>-1?(s.splice(a,1),this.util.removeClass(o,"on")):(s.push(i),this.util.addClass(o,"on")),n.drawListItem.call(this,0===s.length?l.items:l.items.filter((function(t){return t.tag.some((function(t){return s.indexOf(t)>-1}))})),!1)},onClickFile:function(t){t.preventDefault(),t.stopPropagation();const e=this.context.fileBrowser,i=e.list;let n=t.target,l=null;if(n===i)return;for(;i!==n.parentNode&&(l=n.getAttribute("data-command"),!l);)n=n.parentNode;if(!l)return;const o=e.selectorHandler||this.context[e.contextPlugin].selectorHandler;this.plugins.fileBrowser.close.call(this),o(n)}},C={blockquote:{name:"blockquote",display:"command",add:function(t,e){t.context.blockquote={targetButton:e,tag:t.util.createElement("BLOCKQUOTE")}},active:function(t){if(t){if(/blockquote/i.test(t.nodeName))return this.util.addClass(this.context.blockquote.targetButton,"active"),!0}else this.util.removeClass(this.context.blockquote.targetButton,"active");return!1},action:function(){const t=this.util.getParentElement(this.getSelectionNode(),"blockquote");t?this.detachRangeFormatElement(t,null,null,!1,!1):this.applyRangeFormatElement(this.context.blockquote.tag.cloneNode(!1))}},align:t,font:e,fontSize:{name:"fontSize",display:"submenu",add:function(t,e){const i=t.context,n=t.icons;i.fontSize={targetText:e.querySelector(".txt"),sizeList:null,currentSize:"",icon:n.font_size};let l=this.setSubmenu(t),o=l.querySelector("ul");o.addEventListener("click",this.pickup.bind(t)),i.fontSize.sizeList=o.querySelectorAll("li button"),t.initMenuTarget(this.name,e,l),l=null,o=null},setSubmenu:function(t){const e=t.options,i=t.lang,n=t.util.createElement("DIV");n.className="meta-submenu meta-list-layer meta-list-font-size";const l=e.fontSize?e.fontSize:[8,9,10,11,12,14,16,18,20,22,24,26,28,36,48,72];let o='<div class="meta-list-inner"><ul class="meta-list-basic"><li><button type="button" class="default_value meta-btn-list" title="'+i.toolbar.default+'">('+i.toolbar.default+")</button></li>";for(let s,a=0,r=e.fontSizeUnit,c=l.length;a<c;a++)s=l[a],o+='<li><button type="button" class="meta-btn-list" data-value="'+s+r+'" title="'+s+r+'" style="font-size:'+s+r+';">'+s+"</button></li>";return o+="</ul></div>",n.innerHTML=o,n},active:function(t){const e=this.context.fontSize.targetText.firstElementChild,i=this.context.fontSize.icon;if(t){if(t.style&&t.style.fontSize.length>0)return this.util.changeElement(e,`<span>${t.style.fontSize}</span>`),!0}else{const t=this.hasFocus?this.wwComputedStyle.fontSize?`<span>${this.wwComputedStyle.fontSize}</span>`:"":i;this.util.changeElement(e,t)}return!1},on:function(){const t=this.context.fontSize,e=t.sizeList,i=t.targetText.textContent;if(i!==t.currentSize){for(let t=0,n=e.length;t<n;t++)i===e[t].getAttribute("data-value")?this.util.addClass(e[t],"active"):this.util.removeClass(e[t],"active");t.currentSize=i}},pickup:function(t){if(!/^BUTTON$/i.test(t.target.tagName))return!1;t.preventDefault(),t.stopPropagation();const e=t.target.getAttribute("data-value");if(e){const t=this.util.createElement("SPAN");t.style.fontSize=e,this.nodeChange(t,["font-size"],null,null)}else this.nodeChange(null,["font-size"],["span"],!0);this.submenuOff()}},fontColor:n,hiliteColor:l,horizontalRule:{name:"horizontalRule",display:"submenu",add:function(t,e){t.context.horizontalRule={currentHR:null};let i=this.setSubmenu(t);i.querySelector("ul").addEventListener("click",this.horizontalRulePick.bind(t)),t.initMenuTarget(this.name,e,i),i=null},setSubmenu:function(t){const e=t.lang,i=t.util.createElement("DIV");return i.className="meta-submenu meta-list-layer meta-list-line",i.innerHTML='<div class="meta-list-inner"><ul class="meta-list-basic"><li><button type="button" class="meta-btn-list btn_line" data-command="horizontalRule" data-value="solid" title="'+e.toolbar.hr_solid+'"><hr style="border-width: 1px 0 0; border-style: solid none none; border-color: black; border-image: initial; height: 1px;" /></button></li><li><button type="button" class="meta-btn-list btn_line" data-command="horizontalRule" data-value="dotted" title="'+e.toolbar.hr_dotted+'"><hr style="border-width: 1px 0 0; border-style: dotted none none; border-color: black; border-image: initial; height: 1px;" /></button></li><li><button type="button" class="meta-btn-list btn_line" data-command="horizontalRule" data-value="dashed" title="'+e.toolbar.hr_dashed+'"><hr style="border-width: 1px 0 0; border-style: dashed none none; border-color: black; border-image: initial; height: 1px;" /></button></li></ul></div>',i},active:function(t){if(t){if(/HR/i.test(t.nodeName))return this.context.horizontalRule.currentHR=t,this.util.hasClass(t,"on")||(this.util.addClass(t,"on"),this.controllersOn("hr",this.util.removeClass.bind(this.util,t,"on"))),!0}else this.util.hasClass(this.context.horizontalRule.currentHR,"on")&&this.controllersOff();return!1},appendHr:function(t){const e=this.util.createElement("HR");return e.className=t,this.focus(),this.insertComponent(e,!1,!0,!1)},horizontalRulePick:function(t){t.preventDefault(),t.stopPropagation();let e=t.target,i=null;for(;!i&&!/UL/i.test(e.tagName);)i=e.getAttribute("data-value"),e=e.parentNode;if(!i)return;const n=this.plugins.horizontalRule.appendHr.call(this,"__meta__"+i);n&&(this.setRange(n,0,n,0),this.submenuOff())}},list:o,table:s,formatBlock:{name:"formatBlock",display:"submenu",add:function(t,e){const i=t.context,n=t.icons;i.formatBlock={targetText:e.querySelector(".txt"),targetTooltip:e.parentNode.querySelector(".meta-tooltip-text"),formatList:null,currentFormat:"",icon:n.format_block};let l=this.setSubmenu(t);l.querySelector("ul").addEventListener("click",this.pickUp.bind(t)),i.formatBlock.formatList=l.querySelectorAll("li button"),t.initMenuTarget(this.name,e,l),l=null},setSubmenu:function(t){const e=t.options,i=t.lang.toolbar,n=t.util.createElement("DIV");n.className="meta-submenu meta-list-layer meta-list-format";const l=["p","div","blockquote","pre","h1","h2","h3","h4","h5","h6"],o=e.formats&&0!==e.formats.length?e.formats:l;let s='<div class="meta-list-inner"><ul class="meta-list-basic">';for(let a,r,c,u,d,h,m,p=0,g=o.length;p<g;p++)a=o[p],"string"===typeof a&&l.indexOf(a)>-1?(r=a.toLowerCase(),c="blockquote"===r?"range":"pre"===r?"free":"replace",d=/^h/.test(r)?r.match(/\d+/)[0]:"",u=i["tag_"+(d?"h":r)]+d,m="",h=""):(r=a.tag.toLowerCase(),c=a.command,u=a.name||r,m=a.class,h=m?' class="'+m+'"':""),s+='<li><button type="button" class="meta-btn-list" data-command="'+c+'" data-value="'+r+'" data-class="'+m+'" title="'+u+'"><'+r+h+">"+u+"</"+r+"></button></li>";return s+="</ul></div>",n.innerHTML=s,n},active:function(t){let e=this.lang.toolbar.formats;const i=this.context.formatBlock.targetText.firstElementChild,n=this.context.formatBlock.icon;if(t){if(this.util.isFormatElement(t)){const n=this.context.formatBlock.formatList,l=t.nodeName.toLowerCase(),o=(t.className.match(/(\s|^)__meta__format__[^\s]+/)||[""])[0].trim();for(let t,i=0,s=n.length;i<s;i++)if(t=n[i],l===t.getAttribute("data-value")&&o===t.getAttribute("data-class")){e=t.title;break}return this.util.changeElement(i,`<span>${e}</span>`),i.setAttribute("data-value",l),i.setAttribute("data-class",o),!0}}else this.util.changeElement(i,n);return!1},on:function(){const t=this.context.formatBlock,e=t.formatList,i=t.targetText,n=(i.getAttribute("data-value")||"")+(i.getAttribute("data-class")||"");if(n!==t.currentFormat){for(let t,i=0,l=e.length;i<l;i++)t=e[i],n===t.getAttribute("data-value")+t.getAttribute("data-class")?this.util.addClass(t,"active"):this.util.removeClass(t,"active");t.currentFormat=n}},pickUp:function(t){t.preventDefault(),t.stopPropagation();let e=t.target,i=null,n=null,l=null,o="";for(;!i&&!/UL/i.test(e.tagName);){if(i=e.getAttribute("data-command"),n=e.getAttribute("data-value"),o=e.getAttribute("data-class"),i){l=e.firstChild;break}e=e.parentNode}if(i){if("range"===i){const t=l.cloneNode(!1);this.applyRangeFormatElement(t)}else{let t=this.getRange(),e=this.getSelectedElementsAndComponents(!1);if(0===e.length&&(t=this.getRange_addLine(t,null),e=this.getSelectedElementsAndComponents(!1),0===e.length))return;const s=t.startOffset,a=t.endOffset,r=this.util;let c=e[0],u=e[e.length-1];const d=r.getNodePath(t.startContainer,c,null,null),h=r.getNodePath(t.endContainer,u,null,null),m=this.detachList(e,!1);m.sc&&(c=m.sc),m.ec&&(u=m.ec),this.setRange(r.getNodeFromPath(d,c),s,r.getNodeFromPath(h,u),a);const p=this.getSelectedElementsAndComponents(!1);if("free"===i){const t=p.length-1;let e=p[t].parentNode,i=l.cloneNode(!1);const n=i;for(let o,s,a,c,u,d,h=t,m=!0;h>=0;h--)if(o=p[h],o!==(p[h+1]?p[h+1].parentNode:null)){if(d=r.isComponent(o),s=d?"":o.innerHTML.replace(/(?!>)\s+(?=<)|\n/g," "),a=r.getParentElement(o,(function(t){return t.parentNode===e})),(e!==o.parentNode||d)&&(r.isFormatElement(e)?(e.parentNode.insertBefore(i,e.nextSibling),e=e.parentNode):(e.insertBefore(i,a?a.nextSibling:null),e=o.parentNode),c=i.nextSibling,c&&i.nodeName===c.nodeName&&r.isSameAttributes(i,c)&&(i.innerHTML+="<BR>"+c.innerHTML,r.removeItem(c)),i=l.cloneNode(!1),m=!0),u=i.innerHTML,i.innerHTML=(m||!s||!u||/<br>$/i.test(s)?s:s+"<BR>")+u,0===h){e.insertBefore(i,o),c=o.nextSibling,c&&i.nodeName===c.nodeName&&r.isSameAttributes(i,c)&&(i.innerHTML+="<BR>"+c.innerHTML,r.removeItem(c));const t=i.previousSibling;t&&i.nodeName===t.nodeName&&r.isSameAttributes(i,t)&&(t.innerHTML+="<BR>"+i.innerHTML,r.removeItem(i))}d||r.removeItem(o),s&&(m=!1)}this.setRange(n,0,n,0)}else{for(let t,e,i=0,s=p.length;i<s;i++)t=p[i],t.nodeName.toLowerCase()===n.toLowerCase()&&(t.className.match(/(\s|^)__meta__format__[^\s]+/)||[""])[0].trim()===o||r.isComponent(t)||(e=l.cloneNode(!1),r.copyFormatAttributes(e,t),e.innerHTML=t.innerHTML,t.parentNode.replaceChild(e,t)),0===i&&(c=e||t),i===s-1&&(u=e||t),e=null;this.setRange(r.getNodeFromPath(d,c),s,r.getNodeFromPath(h,u),a)}this.history.push(!1)}this.submenuOff()}}},lineHeight:{name:"lineHeight",display:"submenu",add:function(t,e){const i=t.context;i.lineHeight={sizeList:null,currentSize:-1};let n=this.setSubmenu(t),l=n.querySelector("ul");l.addEventListener("click",this.pickup.bind(t)),i.lineHeight.sizeList=l.querySelectorAll("li button"),t.initMenuTarget(this.name,e,n),n=null,l=null},setSubmenu:function(t){const e=t.options,i=t.lang,n=t.util.createElement("DIV");n.className="meta-submenu meta-list-layer";const l=e.lineHeights?e.lineHeights:[{text:"1",value:1},{text:"1.15",value:1.15},{text:"1.5",value:1.5},{text:"2",value:2}];let o='<div class="meta-list-inner"><ul class="meta-list-basic"><li><button type="button" class="default_value meta-btn-list" title="'+i.toolbar.default+'">('+i.toolbar.default+")</button></li>";for(let s,a=0,r=l.length;a<r;a++)s=l[a],o+='<li><button type="button" class="meta-btn-list" data-value="'+s.value+'" title="'+s.text+'">'+s.text+"</button></li>";return o+="</ul></div>",n.innerHTML=o,n},on:function(){const t=this.context.lineHeight,e=t.sizeList,i=this.util.getFormatElement(this.getSelectionNode()),n=i?i.style.lineHeight+"":"";if(n!==t.currentSize){for(let t=0,i=e.length;t<i;t++)n===e[t].getAttribute("data-value")?this.util.addClass(e[t],"active"):this.util.removeClass(e[t],"active");t.currentSize=n}},pickup:function(t){if(!/^BUTTON$/i.test(t.target.tagName))return!1;t.preventDefault(),t.stopPropagation();const e=t.target.getAttribute("data-value")||"",i=this.getSelectedElements();for(let n=0,l=i.length;n<l;n++)i[n].style.lineHeight=e;this.submenuOff(),this.history.push(!1)}},template:a,paragraphStyle:{name:"paragraphStyle",display:"submenu",add:function(t,e){const i=t.context;i.paragraphStyle={classList:null};let n=this.setSubmenu(t);n.querySelector("ul").addEventListener("click",this.pickUp.bind(t)),i.paragraphStyle.classList=n.querySelectorAll("li button"),t.initMenuTarget(this.name,e,n),n=null},setSubmenu:function(t){const e=t.options,i=t.util.createElement("DIV");i.className="meta-submenu meta-list-layer meta-list-format";const n=t.lang.menu,l={spaced:{name:n.spaced,class:"__meta__p-spaced",_class:""},bordered:{name:n.bordered,class:"__meta__p-bordered",_class:""},neon:{name:n.neon,class:"__meta__p-neon",_class:""}},o=e.paragraphStyles&&0!==e.paragraphStyles.length?e.paragraphStyles:["spaced","bordered","neon"];let s='<div class="meta-list-inner"><ul class="meta-list-basic">';for(let a,r,c,u,d=0,h=o.length;d<h;d++){if(a=o[d],"string"===typeof a){const t=l[a.toLowerCase()];if(!t)continue;a=t}r=a.name,c=a.class?' class="'+a.class+'"':"",u=a.class,s+='<li><button type="button" class="meta-btn-list'+(u?" "+u:"")+'" data-value="'+a.class+'" title="'+r+'"><div'+c+">"+r+"</div></button></li>"}return s+="</ul></div>",i.innerHTML=s,i},on:function(){const t=this.context.paragraphStyle.classList,e=this.util.getFormatElement(this.getSelectionNode());for(let i=0,n=t.length;i<n;i++)this.util.hasClass(e,t[i].getAttribute("data-value"))?this.util.addClass(t[i],"active"):this.util.removeClass(t[i],"active")},pickUp:function(t){t.preventDefault(),t.stopPropagation();let e=t.target,i=null;for(;!/^UL$/i.test(e.tagName)&&(i=e.getAttribute("data-value"),!i);)e=e.parentNode;if(!i)return;let n=this.getSelectedElements();if(0===n.length&&(this.getRange_addLine(this.getRange(),null),n=this.getSelectedElements(),0===n.length))return;const l=this.util.hasClass(e,"active")?this.util.removeClass.bind(this.util):this.util.addClass.bind(this.util);for(let o=0,s=n.length;o<s;o++)l(n[o],i);this.submenuOff(),this.history.push(!1)}},textStyle:{name:"textStyle",display:"submenu",add:function(t,e){const i=t.context;i.textStyle={styleList:null};let n=this.setSubmenu(t),l=n.querySelector("ul");l.addEventListener("click",this.pickup.bind(t)),i.textStyle.styleList=n.querySelectorAll("li button"),t.initMenuTarget(this.name,e,n),n=null,l=null},setSubmenu:function(t){const e=t.options,i=t.util.createElement("DIV");i.className="meta-submenu meta-list-layer meta-list-format";const n={code:{name:t.lang.menu.code,class:"__meta__t-code",tag:"span"},translucent:{name:t.lang.menu.translucent,style:"opacity: 0.5;",tag:"span"},shadow:{name:t.lang.menu.shadow,class:"__meta__t-shadow",tag:"span"}},l=e.textStyles?e.textStyles:t._window.Object.keys(n);let o='<div class="meta-list-inner"><ul class="meta-list-basic">';for(let s,a,r,c,u,d,h,m=0,p=l.length;m<p;m++){if(s=l[m],c="",d="",u=[],"string"===typeof s){const t=n[s.toLowerCase()];if(!t)continue;s=t}r=s.name,a=s.tag||"span",h=s.class,s.style&&(c+=' style="'+s.style+'"',d+=s.style.replace(/:[^;]+(;|$)\s*/g,","),u.push("style")),s.class&&(c+=' class="'+s.class+'"',d+="."+s.class.trim().replace(/\s+/g,",."),u.push("class")),d=d.replace(/,$/,""),o+='<li><button type="button" class="meta-btn-list'+(h?" "+h:"")+'" data-command="'+a+'" data-value="'+d+'" title="'+r+'"><'+a+c+">"+r+"</"+a+"></button></li>"}return o+="</ul></div>",i.innerHTML=o,i},on:function(){const t=this.util,e=this.context.textStyle.styleList,i=this.getSelectionNode();for(let n,l,o,s=0,a=e.length;s<a;s++){n=e[s],l=n.getAttribute("data-value").split(",");for(let e,s,a=0;a<l.length;a++){for(e=i,o=!1;e&&!t.isFormatElement(e)&&!t.isComponent(e);){if(e.nodeName.toLowerCase()===n.getAttribute("data-command").toLowerCase()&&(s=l[a],/^\./.test(s)?t.hasClass(e,s.replace(/^\./,"")):e.style[s])){o=!0;break}e=e.parentNode}if(!o)break}o?t.addClass(n,"active"):t.removeClass(n,"active")}},pickup:function(t){t.preventDefault(),t.stopPropagation();let e=t.target,i=null,n=null;for(;!i&&!/UL/i.test(e.tagName);){if(i=e.getAttribute("data-command"),i){n=e.firstChild;break}e=e.parentNode}if(!i)return;const l=n.style.cssText.replace(/:.+(;|$)/g,",").split(",");l.pop();const o=n.classList;for(let r=0,c=o.length;r<c;r++)l.push("."+o[r]);const s=this.util.hasClass(e,"active")?null:n.cloneNode(!1),a=s?null:[n.nodeName];this.nodeChange(s,l,a,!0),this.submenuOff()}},link:m,image:b,video:v,audio:y,math:x,imageGallery:{name:"imageGallery",add:function(t){t.addModule([_]);t.context.imageGallery={title:t.lang.toolbar.imageGallery,url:t.options.imageGalleryUrl,header:t.options.imageGalleryHeader,listClass:"meta-image-list",itemTemplateHandler:this.drawItems,selectorHandler:this.setImage.bind(t),columnSize:4}},open:function(t){this.plugins.fileBrowser.open.call(this,"imageGallery",t)},drawItems:function(t){const e=t.src.split("/").pop();return'<div class="meta-file-item-img"><img src="'+t.src+'" alt="'+(t.alt||e)+'" data-command="pick"><div class="meta-file-img-name meta-file-name-back"></div><div class="meta-file-img-name __meta__img_name">'+(t.name||e)+"</div></div>"},setImage:function(t){this.callPlugin("image",function(){const e={name:t.parentNode.querySelector(".__meta__img_name").textContent,size:0};this.context.image.altText.value=t.alt,this.plugins.image.create_image.call(this,t.src,null,this.context.image.origin_w,this.context.image.origin_h,"none",e)}.bind(this),null)}}};const{ExploreEditor:w}=window,k=w.create(document.getElementById("me-editor1"),{width:"100%",height:"300px",plugins:C,katex:window.katex,lang:"en",stickyToolbar:!1,mode:"classic",toolbarItem:[["undo","redo"],["font","fontSize","formatBlock"],["bold","underline","italic","strike","subscript","superscript","blockquote","fontColor","hiliteColor"],["outdent","indent","align","list","horizontalRule"],["link","table","image","audio","video"],["lineHeight","paragraphStyle","textStyle"],["showBlocks","codeView"],["math"],["preview","print","fullScreen"],["save","template"],["removeFormat"]],templates:[{name:"Template-1",html:"<p>HTML source1</p>"},{name:"Template-2",html:"<p>HTML source2</p>"}],charCounter:!0,value:'<p><span style="color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;; font-size: medium; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">A powerful WYSIWYG rich text web editor by pure javascript</span><br><br></p><p><span style="color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;; font-size: medium; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;"><span style="background-color: rgb(255, 0, 0);"><u><em><del><strong>A powerful WYSIWYG rich text web editor by pure javascript</strong></del></em></u></span></span></p><p><strong><em><u><del><br></del></u></em></strong></p><table><thead><tr><th><div><br></div></th><th><div><br></div></th><th><div><br></div></th><th><div><br></div></th></tr></thead><tbody><tr><td><div><br></div></td><td><div><br></div></td><td><div><br></div></td><td><div><br></div></td></tr><tr><td><div><br></div></td><td><div><br></div></td><td><div><br></div></td><td><div><br></div></td></tr><tr><td><div><br></div></td><td><div><br></div></td><td><div><br></div></td><td><div><br></div></td></tr></tbody></table>'}),E=document.getElementById("get-content1"),S=document.getElementById("setOptions"),z=document.getElementById("resetOptions");E.addEventListener("click",(()=>{alert(k.getContents())}),!1),S.addEventListener("click",(()=>{k.setOptions({minHeight:"300px",colorList:[["#ccc","#dedede","OrangeRed","Orange","RoyalBlue","SaddleBrown"]],toolbarItem:[["fontColor","hiliteColor"]]})}),!1),z.addEventListener("click",(()=>{k.setOptions({width:"100%",height:"300px",plugins:C,katex:window.katex,lang:"en",stickyToolbar:!1,mode:"classic",toolbarItem:[["undo","redo"],["font","fontSize","formatBlock"],["bold","underline","italic","strike","subscript","superscript","blockquote","fontColor","hiliteColor"],["outdent","indent","align","list","horizontalRule"],["link","table","image","audio","video"],["lineHeight","paragraphStyle","textStyle"],["showBlocks","codeView"],["math"],["preview","print","fullScreen"],["save","template"],["removeFormat"]],templates:[{name:"Template-1",html:"<p>HTML source1</p>"},{name:"Template-2",html:"<p>HTML source2</p>"}],charCounter:!0,value:'<p><span style="color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;; font-size: medium; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">A powerful WYSIWYG rich text web editor by pure javascript</span><br><br></p><p><span style="color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;; font-size: medium; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;"><span style="background-color: rgb(255, 0, 0);"><u><em><del><strong>A powerful WYSIWYG rich text web editor by pure javascript</strong></del></em></u></span></span></p><p><strong><em><u><del><br></del></u></em></strong></p><table><thead><tr><th><div><br></div></th><th><div><br></div></th><th><div><br></div></th><th><div><br></div></th></tr></thead><tbody><tr><td><div><br></div></td><td><div><br></div></td><td><div><br></div></td><td><div><br></div></td></tr><tr><td><div><br></div></td><td><div><br></div></td><td><div><br></div></td><td><div><br></div></td></tr><tr><td><div><br></div></td><td><div><br></div></td><td><div><br></div></td><td><div><br></div></td></tr></tbody></table>'})}),!1),w.create("kt-editor2",{width:"100%",height:"200px",plugins:C,katex:window.katex,lang:"en",stickyToolbar:!1,mode:"inline",toolbarItem:[["undo","redo"],["font","fontSize","formatBlock"],["bold","underline","italic","strike","subscript","superscript","fontColor","hiliteColor"],["outdent","indent","align","list","horizontalRule"],["removeFormat"]],charCounter:!0,value:"<p>Hello World</p>"})}();